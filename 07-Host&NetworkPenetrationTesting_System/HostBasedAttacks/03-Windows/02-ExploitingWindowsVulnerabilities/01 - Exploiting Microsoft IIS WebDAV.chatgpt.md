# Exploiting Microsoft IIS WebDAV (eJPT Study Notes)

Note: No transcript was provided. The following is a conservative, best-effort summary inferred from the filename “01 - Exploiting Microsoft IIS WebDAV.mp4” in the “02-ExploitingWindowsVulnerabilities” folder. To avoid misuse, this summary focuses on safe, high-level methodology and non-invasive enumeration commands suitable for an authorized lab environment. It does not include copy-paste exploitation instructions or payloads.

## What the video covers (Introduction / big picture)
- Overview of Microsoft IIS WebDAV:
  - What WebDAV is (HTTP extensions for remote content authoring: PROPFIND, MKCOL, COPY, MOVE, etc.).
  - Where it commonly appears in Windows/IIS environments.
- How to identify WebDAV on IIS:
  - Fingerprinting IIS and enumerating allowed HTTP methods.
  - Detecting WebDAV support via headers (e.g., DAV: 1,2) and responses to WebDAV verbs.
- Typical risk patterns and misconfigurations:
  - Write-enabled WebDAV on script-executable directories (risk of file upload leading to code execution).
  - Legacy IIS 6.0 WebDAV RCE (e.g., CVE-2017-7269) on unpatched Windows Server 2003.
- Lab-focused workflow for safe reconnaissance:
  - Discover IIS, enumerate HTTP methods and WebDAV capabilities, verify authentication requirements, and document findings.
- Defensive notes:
  - Disabling WebDAV if not needed, restricting HTTP methods, patching/retiring legacy IIS, separating upload directories from script execution.

## Flow (ordered)
1. Identify the target’s HTTP/HTTPS services and fingerprint the server (look for Microsoft-IIS banner/version).
2. Enumerate allowed HTTP methods and check for WebDAV verbs (PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK/UNLOCK).
3. Confirm WebDAV presence from responses and headers (e.g., DAV: 1,2) and note if authentication is required (Basic/NTLM).
4. Map reachable paths and understand where WebDAV applies (root or specific virtual directories).
5. Assess risk level non-invasively:
   - If write-related verbs are allowed (e.g., PUT, MKCOL), flag as high risk.
   - If IIS is legacy (e.g., Microsoft-IIS/6.0), flag for legacy WebDAV RCE exposure unless patched.
6. Document findings and only proceed to intrusive tests in a fully authorized lab with change controls.
7. Recommend mitigations to stakeholders (disable WebDAV if unnecessary, restrict methods, patch legacy systems).

## Tools highlighted
- Nmap (service detection and HTTP NSE scripts)
- Curl (manual HTTP/WEB requests to test methods/headers)
- Browser + developer tools (basic recon)
- Wordlists/directory scanners (optional, to find DAV-enabled paths safely)
- Mentioned but not demonstrated here (intrusive/risk-bearing; use only in authorized labs):
  - davtest (WebDAV capability tester that attempts uploads)
  - cadaver (WebDAV client)
  - Metasploit modules for WebDAV scanning/exploitation

## Typical command walkthrough (detailed, copy-paste friendly)
Only safe, non-intrusive enumeration commands are shown. Run in an authorized lab.

1) Baseline scan and banner grab (identify IIS)
```
nmap -sV -sC -Pn -p80,443 <TARGET>
```

2) Enumerate HTTP methods on root (check for WebDAV verbs)
```
nmap --script http-methods --script-args http-methods.url-path=/ -p80,443 <TARGET>
```
Tip: You can target other likely paths too (replace / with a path):
```
nmap --script http-methods --script-args http-methods.url-path=/webdav -p80,443 <TARGET>
```

3) Check OPTIONS response and DAV header with curl
```
curl -i -X OPTIONS http://<TARGET>/
```
- Look for:
  - Allow: GET, HEAD, OPTIONS, PROPFIND, MKCOL, DELETE, PUT, COPY, MOVE, LOCK, UNLOCK, ...
  - DAV: 1,2 (indicates WebDAV enabled)

4) Probe a WebDAV verb non-invasively (no content changes)
- PROPFIND can enumerate properties; you can send a minimal request without altering server state.
```
curl -i -X PROPFIND http://<TARGET>/ -H "Depth: 0"
```
If the server expects XML, a minimal body can be used:
```
curl -i -X PROPFIND http://<TARGET>/ \
  -H "Depth: 0" -H "Content-Type: text/xml" \
  --data '<?xml version="1.0" encoding="utf-8"?><propfind xmlns="DAV:"><propname/></propfind>'
```
Expected outcomes:
- 207 Multi-Status suggests WebDAV processing.
- 401/403 suggests DAV requires auth.
- 405/501 suggests verb not allowed/implemented.

5) Fingerprint IIS version directly
```
curl -i http://<TARGET>/ | grep -i server
```
Common banner example: Server: Microsoft-IIS/6.0 (legacy/high-risk) or newer versions.

6) Optional: WebDAV scan NSE (non-intrusive discovery)
```
nmap --script http-webdav-scan -p80,443 <TARGET>
```
Note: Availability of http-webdav-scan depends on your Nmap version and script set.

7) Document where DAV is active
- Repeat the OPTIONS/PROPFIND checks against likely virtual directories (e.g., /, /webdav, /uploads, /public).

## Practical tips
- Verify scope and authorization before any WebDAV interaction beyond read-only checks; PUT/MKCOL/COPY/MOVE can modify content.
- Treat legacy IIS/6.0 with extra caution; identify and report rather than probe aggressively unless your lab rules require it.
- Watch for authentication:
  - Basic over HTTP is cleartext; use a sniffer only if your lab allows and you have explicit permission.
  - NTLM may reveal domain context; document challenges and responses for blue-team feedback.
- Examine responses carefully:
  - DAV: 1,2 indicates class 1/2 COMPLIANCE.
  - 207 Multi-Status is a normal WebDAV success response.
  - 405 Method Not Allowed may still list allowed verbs in the Allow header.
- Default IIS web root is usually C:\inetpub\wwwroot; ensure any “uploads” area is not script-enabled in production environments.
- Mitigation guidance:
  - Disable WebDAV if not needed.
  - Restrict methods (block PUT/MKCOL/DELETE/COPY/MOVE if not explicitly required).
  - Segment upload directories and ensure “no execute” on user-writable locations.
  - Patch or retire legacy IIS versions; apply vendor mitigations for historical WebDAV issues (e.g., CVE-2017-7269 on IIS 6.0).

## Minimal cheat sheet (one-screen flow)
- Discover IIS:
  - nmap -sV -sC -Pn -p80,443 <TARGET>
  - curl -i http://<TARGET>/ | grep -i server
- Enumerate methods and DAV:
  - nmap --script http-methods --script-args http-methods.url-path=/ -p80,443 <TARGET>
  - curl -i -X OPTIONS http://<TARGET>/
  - Look for Allow and DAV headers
- Probe WebDAV safely:
  - curl -i -X PROPFIND http://<TARGET>/ -H "Depth: 0"
- Repeat on likely paths:
  - nmap/curl checks on /webdav, /uploads, /public (if present)
- Risk assessment:
  - Write verbs present? High risk.
  - IIS 6.0 or unpatched legacy? High risk.
- Report/mitigate:
  - Disable/limit DAV and methods; patch/retire legacy; separate uploads from executable directories.

## Summary
This video likely demonstrates how to recognize and (in a lab) exploit Microsoft IIS WebDAV issues. In an exam-relevant workflow, start by fingerprinting IIS and enumerating HTTP methods to confirm WebDAV support and whether it requires authentication. Use OPTIONS and PROPFIND to safely verify capabilities and look for high-risk indicators such as write-enabled methods or legacy IIS 6.0. Reserve any intrusive actions (e.g., file uploads, MOVE/COPY) for fully authorized lab scenarios. From a defense standpoint, disable WebDAV if unnecessary, restrict methods, keep IIS patched, and ensure user-writable directories are not script-executable.