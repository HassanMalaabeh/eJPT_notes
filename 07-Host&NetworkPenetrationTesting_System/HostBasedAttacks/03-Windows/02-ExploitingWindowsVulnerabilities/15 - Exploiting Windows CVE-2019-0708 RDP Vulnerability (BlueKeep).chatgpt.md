# Exploiting Windows CVE-2019-0708 RDP Vulnerability (BlueKeep) — eJPT Study Notes

Note: No transcript was provided. The following is inferred conservatively from the filename and typical eJPT workflow. Commands focus on discovery and safe validation in a lab. Avoid running any exploit code against systems you do not own or have explicit permission to test.

## What the video covers (Introduction / big picture)
- BlueKeep (CVE-2019-0708) is a critical wormable pre-auth RCE vulnerability in Remote Desktop Services (RDS/TermService) affecting older Windows:
  - Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2008/2008 R2.
  - Windows 8/10 and Server 2012+ are not affected.
- Risk: Pre-authentication remote code execution over RDP (TCP/3389), often leading to full system compromise; many unpatched systems crashed by unstable exploits.
- Objective (eJPT context): Identify RDP, fingerprint the service, safely determine BlueKeep exposure, and understand mitigation. Any “exploit” demonstrations should be performed only in an isolated lab due to instability and ethical constraints.

## Flow (ordered)
1. Discover RDP (TCP/3389) hosts in scope.
2. Fingerprint RDP service and OS.
3. Enumerate RDP security settings (NLA, encryption).
4. Perform safe BlueKeep checks (scanner modules/tools).
5. Validate exposure and document risk.
6. Optional lab-only exploit discussion and stability caveats.
7. Recommend/verify mitigation (patching/NLA/restrictions).

## Tools highlighted
- Nmap with RDP scripts:
  - rdp-enum-encryption, rdp-ntlm-info
  - Optional: rdp-vuln-cve2019-0708 (if present in your Nmap version)
- Metasploit Framework:
  - RDP scanner and BlueKeep check modules (scanner-only usage recommended)
- rdpscan (BlueKeep detector by the Masscan author)
- xfreerdp (to probe NLA behavior in a lab)
- System utilities for patch verification (systeminfo / Get-HotFix) when credentials are available

## Typical command walkthrough (detailed, copy-paste friendly)

Replace placeholders like <TARGET>, <SUBNET>, <FILE> before running. Use only in a controlled environment.

- Install/update tooling (Kali/Debian):
```
sudo apt update
sudo apt install -y nmap metasploit-framework freerdp2-x11 build-essential git
```

1) Discover RDP in your scope
```
# Fast discovery of hosts with port 3389 open
sudo nmap -p 3389 --open -n -Pn 10.10.0.0/24 -oN rdp-open.txt
```

2) Fingerprint RDP and enumerate security
```
# Service/version detection with RDP scripts
sudo nmap -sV -p 3389 --script rdp-enum-encryption,rdp-ntlm-info <TARGET> -oN rdp-enum.txt
```
- Look for:
  - “NLA: Supported/Required” (NLA mitigates pre-auth RCE paths)
  - OS hints via NTLM information
  - If RDP Security (not TLS/NLA) is allowed, risk increases

3) Optional: Nmap BlueKeep script (if available in your Nmap build)
```
# Only if your nmap has this script; otherwise skip
sudo nmap -sV -p 3389 --script rdp-vuln-cve2019-0708 <TARGET> -oN rdp-bluekeep-nmap.txt
```
- If the script isn’t found, your Nmap version may not include it.

4) rdpscan (safe BlueKeep detector)
```
git clone https://github.com/robertdavidgraham/rdpscan.git
cd rdpscan
make
# Single host
./rdpscan <TARGET>
# Or a subnet
./rdpscan 10.10.0.0/24
```
- Output will flag likely vulnerable hosts; it’s designed to be a safe check.

5) Metasploit scanner modules (check-only usage)
```
msfconsole -q
# Basic RDP probe
use auxiliary/scanner/rdp/rdp_scanner
set RHOSTS <TARGET>
set RPORT 3389
run

# BlueKeep vulnerability scanner (non-exploit)
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
set RHOSTS <TARGET>
set RPORT 3389
run
```
- These modules report whether the target appears vulnerable without delivering an exploit.
- Do not run RCE modules against production systems; they are unstable and can crash hosts.

6) Probe NLA behavior with xfreerdp (lab only)
```
# Attempt NLA-negotiated connection (should fail fast without valid creds if NLA is required)
xfreerdp /v:<TARGET> /cert:ignore /sec:nla /u:test /p:test

# Attempt legacy security; if server accepts legacy RDP security, risk is higher
xfreerdp /v:<TARGET> /cert:ignore /sec:rdp /u:test /p:test
```

7) Mitigation verification (when you have credentials)
```
# Windows: list installed hotfixes (look for the May 2019 BlueKeep patch)
wmic qfe list brief | findstr /I 2019
# PowerShell alternative
powershell "Get-HotFix | Sort-Object InstalledOn | Select HotFixID,InstalledOn | Format-Table -Auto"
```
- Alternatively, check that Network Level Authentication is enforced in RDP settings and restrict RDP exposure.

## Practical tips
- BlueKeep exploits are notoriously crash-prone; snapshot VMs before any lab testing.
- NLA “Required” significantly mitigates pre-auth RCE paths; enable and enforce it.
- Many organizations move RDP off 3389—scan all TCP ports if you suspect non-standard ports.
- Rate-limit scans to avoid overwhelming fragile legacy systems.
- Validate OS version: BlueKeep affects older Windows families (XP/7/2003/2008/2008R2); Windows 8+ are not impacted.
- If using Metasploit, prefer scanner/check modules. Avoid running actual RCE modules outside a controlled lab.
- Remediation: patch (May 2019 updates), enable NLA, restrict RDP to VPN/allow-lists, and monitor Event Logs/Network IDS for RDP anomalies.

## Minimal cheat sheet (one-screen flow)
```
# 1) Find RDP
sudo nmap -p3389 --open -n -Pn <SUBNET> -oN rdp-open.txt

# 2) Fingerprint + NLA/crypto info
sudo nmap -sV -p3389 --script rdp-enum-encryption,rdp-ntlm-info <TARGET> -oN rdp-enum.txt

# 3) BlueKeep safe check (option A: Nmap, if present)
sudo nmap -sV -p3389 --script rdp-vuln-cve2019-0708 <TARGET> -oN rdp-bluekeep-nmap.txt

# 3) BlueKeep safe check (option B: rdpscan)
git clone https://github.com/robertdavidgraham/rdpscan.git && cd rdpscan && make
./rdpscan <TARGET>

# 4) Metasploit scanner (check-only)
msfconsole -q -x "use auxiliary/scanner/rdp/rdp_scanner; set RHOSTS <TARGET>; run; use auxiliary/scanner/rdp/cve_2019_0708_bluekeep; set RHOSTS <TARGET>; run; exit"

# 5) Mitigate/verify
# - Enable NLA, apply May 2019 patches, restrict RDP exposure
```

## Summary
- BlueKeep (CVE-2019-0708) is a pre-auth RCE in RDP on legacy Windows versions, historically wormable and highly dangerous.
- Safely confirm exposure by enumerating RDP, checking NLA and OS versions, and using dedicated scanner tools (Nmap scripts, rdpscan, Metasploit scanner modules).
- Avoid running unstable RCE exploit code outside a lab; it can crash systems.
- Mitigation should include patching, enforcing NLA, restricting RDP to trusted networks, and monitoring for suspicious RDP activity.

If the original video demonstrated full exploitation, replicate only in an isolated lab with explicit authorization. The commands above focus on safe identification and validation aligned with ethical testing practices.