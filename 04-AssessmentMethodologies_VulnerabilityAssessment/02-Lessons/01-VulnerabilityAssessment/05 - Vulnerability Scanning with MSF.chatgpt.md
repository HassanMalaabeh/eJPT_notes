# Vulnerability Scanning with MSF (Metasploit)

Note: No transcript was provided. The following is a conservative, exam-focused summary inferred from the filename and the “01-VulnerabilityAssessment” folder context. Module names and flags can vary slightly across MSF versions—use search when unsure.

## What the video covers (Introduction / big picture)
- Using Metasploit Framework (MSF) as a vulnerability scanning and evidence collection platform during a vulnerability assessment.
- Building and using MSF’s database (hosts, services, vulns, loot) to track targets.
- Integrating Nmap with MSF (db_nmap/import), then layering MSF auxiliary scanners for service/version detection and vulnerability checks.
- Pivoting from service discovery to specific vulnerability checks (e.g., MS17-010, BlueKeep, Heartbleed).
- Exporting results for reporting and lining up exploitation candidates.

## Flow (ordered)
1. Start PostgreSQL and MSF; confirm DB connectivity.
2. Create/select a workspace and enable logging/spooling.
3. Discover targets and services via db_nmap or by importing Nmap XML.
4. Review hosts/services tables; quickly filter by port/protocol.
5. Run auxiliary scanners for version checks (SMB/SSH/HTTP/RDP/etc.).
6. Run targeted vulnerability checks (e.g., smb_ms17_010, BlueKeep, Heartbleed).
7. Use MSF DB views (hosts/services/vulns/loot) to organize findings.
8. Export results; prepare exploitation with “check” before “exploit”.

## Tools highlighted
- Metasploit Framework (msfconsole)
  - Database-backed asset tracking: hosts, services, vulns, notes, loot
  - Auxiliary scanners: port/service/version/vulnerability checks
  - Exploit modules with “check” capability
- Nmap via MSF integration (db_nmap) or db_import
- PostgreSQL backing store for MSF

## Typical command walkthrough (detailed, copy-paste friendly)

Set variables for your lab before you start:
- Replace 192.168.56.0/24 with your target subnet.
- Replace output filenames/paths as needed.

Start services and MSF:
```
# Shell
sudo systemctl enable --now postgresql
msfconsole -q
```

Inside msfconsole: initialize workspace, logging, and verify DB
```
db_status
workspace -a VA
workspace VA
spool VA_msf.log
setg THREADS 32
setg VERBOSE true
```

Discover targets and services (choose one)

Option A: Run Nmap from inside MSF
```
# Fast top-1000 ports + versions + OS guess (common for initial pass)
db_nmap -sS -sV -O -Pn -T4 192.168.56.0/24

# (Optional) Full TCP sweep if needed
# db_nmap -sS -sV -O -Pn -T4 -p- 192.168.56.0/24
```

Option B: Import existing Nmap XML
```
db_import /path/to/nmap_results.xml
```

Inspect what you have
```
hosts
services
services -p 445
services -p 3389
services -p 80,443
```

Set global target scope (optional)
```
setg RHOSTS 192.168.56.0/24
```

Quick port scanning (if you didn’t rely on Nmap)
```
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.56.0/24
set PORTS 1-1000
set THREADS 200
run
```

Service/version enumeration examples

SMB
```
# Limit RHOSTS to hosts with TCP/445 open
services -p 445 -R

use auxiliary/scanner/smb/smb_version
run
```

SMB MS17-010 (EternalBlue) check
```
services -p 445 -R
use auxiliary/scanner/smb/smb_ms17_010
run
```

RDP and BlueKeep check
```
# RDP discover
services -p 3389 -R
use auxiliary/scanner/rdp/rdp_scanner
run

# BlueKeep (CVE-2019-0708) vulnerability check
services -p 3389 -R
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
run
```

HTTP/S enumeration
```
services -p 80,443 -R
use auxiliary/scanner/http/http_version
run
```

SSH and FTP version checks
```
# SSH
services -p 22 -R
use auxiliary/scanner/ssh/ssh_version
run

# FTP
services -p 21 -R
use auxiliary/scanner/ftp/ftp_version
run
```

Heartbleed (OpenSSL) check on HTTPS
```
services -p 443 -R
use auxiliary/scanner/ssl/openssl_heartbleed
# ACTION option may be available on some versions; SCAN is safe.
# show options
run
```

Pivot to exploit “check” (without exploitation) when appropriate
```
# Example: check MS17-010 exploitability (do not exploit in VA phase)
services -p 445 -R
search ms17_010
use exploit/windows/smb/ms17_010_eternalblue
show options
check
```

Review and export findings
```
vulns
hosts -o hosts.csv
services -o services.csv
vulns -o vulns.csv
loot
spool off
```

Workspace hygiene (optional)
```
# Create multiple workspaces per engagement/phase
workspace -a postscan
workspace postscan

# Delete a workspace if needed
# workspace -d VA
```

Helpful search patterns when you’re unsure of module names
```
search type:auxiliary scanner smb
search type:auxiliary rdp bluekeep
search type:auxiliary ssl heartbleed
search name:http_version type:auxiliary
```

## Practical tips
- Use services -p <port> -R or hosts -S <string> -R to quickly populate RHOSTS for the next module.
- Favor auxiliary scanners and exploit “check” over full exploitation during vulnerability assessment.
- Start with db_nmap top-1000 ports and escalate to deeper scans only where justified to save time.
- Use setg THREADS for performance; reduce THREADS for fragile networks.
- Spool output to keep a forensic log; export hosts/services/vulns for reporting.
- Module names vary—always confirm with search and show options before running.
- Some scanners improve results with credentials (e.g., SMBUser/SMBPass); if you have creds, set them.
- If db_status shows no connection, ensure PostgreSQL is running before msfconsole.

## Minimal cheat sheet (one-screen flow)
```
# Shell
sudo systemctl enable --now postgresql
msfconsole -q

# MSF (initialize)
db_status
workspace -a VA
workspace VA
spool VA_msf.log
setg THREADS 32
setg VERBOSE true

# Discovery
db_nmap -sS -sV -O -Pn -T4 192.168.56.0/24

# Triage
hosts
services

# SMB quick checks
services -p 445 -R
use auxiliary/scanner/smb/smb_version; run
use auxiliary/scanner/smb/smb_ms17_010; run

# RDP quick checks
services -p 3389 -R
use auxiliary/scanner/rdp/rdp_scanner; run
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep; run

# HTTP/HTTPS versioning
services -p 80,443 -R
use auxiliary/scanner/http/http_version; run

# Optional SSL Heartbleed
services -p 443 -R
use auxiliary/scanner/ssl/openssl_heartbleed; run

# Verify specific exploitability (no exploit)
services -p 445 -R
search ms17_010
use exploit/windows/smb/ms17_010_eternalblue
check

# Export
vulns
hosts -o hosts.csv
services -o services.csv
vulns -o vulns.csv
spool off
```

## Summary
This session demonstrates how to use Metasploit as a vulnerability assessment companion: organize targets in a workspace; feed MSF with discovery data via db_nmap or imports; enumerate services; run targeted auxiliary vulnerability scanners; verify exploitability with “check”; and export findings. The workflow keeps scanning structured, repeatable, and ready for the exploitation phase while preserving evidence for reporting.