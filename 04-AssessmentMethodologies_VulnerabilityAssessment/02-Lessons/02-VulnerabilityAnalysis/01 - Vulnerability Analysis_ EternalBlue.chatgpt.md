# Vulnerability Analysis: EternalBlue (MS17-010)

Note: No transcript was provided. The following is a conservative, eJPT-style summary inferred from the filename and context. It focuses on standard lab-safe techniques to identify MS17-010 (EternalBlue) exposure.

## What the video covers (Introduction / big picture)
- Understanding MS17-010 (EternalBlue): a critical SMBv1 RCE affecting unpatched Windows (notably Windows 7/Server 2008 R2).
- How to find and verify SMB exposure and potential MS17-010 vulnerability.
- Safe, non-intrusive checks with Nmap NSE and Metasploit auxiliary scanner.
- Confirming OS/architecture and SMB dialects before attempting exploitation (kept out-of-scope for vulnerability analysis).

## Flow (ordered)
1. Discover hosts with SMB (TCP/445) open.
2. Enumerate SMB/OS details and SMB dialect support.
3. Run Nmap’s smb-vuln-ms17-010 NSE script.
4. Validate with Metasploit’s auxiliary scanner.
5. Optionally confirm OS/arch via rpcclient and/or SMB protocol scripts.
6. Record results, stop before exploitation.

## Tools highlighted
- Nmap + NSE scripts:
  - smb-vuln-ms17-010
  - smb-os-discovery
  - smb-protocols
  - smb2-security-mode, smb2-capabilities
- Metasploit Framework:
  - auxiliary/scanner/smb/smb_ms17_010
  - exploit/windows/smb/ms17_010_eternalblue (for check only)
- Samba client utilities (optional):
  - smbclient
  - rpcclient

## Typical command walkthrough (detailed, copy-paste friendly)

Replace SUBNET and TARGET as needed.

1) Find hosts with SMB open
```
# Fast discovery of SMB (445) on a subnet
sudo nmap -p445 --open -sS -n -Pn -T4 SUBNET/24 -oG smb_hosts.gnmap

# Example
sudo nmap -p445 --open -sS -n -Pn -T4 192.168.56.0/24 -oG smb_hosts.gnmap

# List targets
grep "/open/tcp//microsoft-ds" smb_hosts.gnmap | awk '{print $2}'
```

2) Enumerate SMB/OS and dialects
```
# Basic SMB/OS info
sudo nmap -sV -p445 --script smb-os-discovery 192.168.56.101

# SMB dialects (check if SMBv1 is supported)
sudo nmap --script smb-protocols -p445 192.168.56.101

# SMB2 security/capabilities (optional context)
sudo nmap -p445 --script smb2-security-mode,smb2-capabilities 192.168.56.101
```

3) Check for MS17-010 with Nmap
```
# Single host
sudo nmap -p445 --script smb-vuln-ms17-010 192.168.56.101

# Entire subnet
sudo nmap -p445 --script smb-vuln-ms17-010 192.168.56.0/24 -oN ms17-010_nmap.txt
```

4) Validate with Metasploit (auxiliary scanner)
```
msfconsole -q
search ms17_010
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS 192.168.56.101
set RPORT 445
set THREADS 16
run
```
- Expected: “Host is likely VULNERABLE to MS17-010!” when vulnerable.

5) Optional: Metasploit exploit module “check” (no exploitation)
```
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.56.101
set RPORT 445
show targets
set TARGET 0
set VERIFY_ARCH true
set VERIFY_TARGET true
check
```
- Only use “check”; do not “run” during vulnerability analysis.

6) Optional: Get OS info with rpcclient and list shares with smbclient
```
# OS info (quick, unauthenticated)
rpcclient -U "" -N 192.168.56.101 -c srvinfo

# List shares (unauthenticated; may fail if restricted)
smbclient -L //192.168.56.101 -N
```

7) Notes on interpreting results
- If smb-protocols shows SMBv1: enabled and smb-vuln-ms17-010 reports VULNERABLE, that’s a strong indicator.
- If SMBv1 is disabled, MS17-010 is generally not exploitable.
- Prefer multiple checks (Nmap + Metasploit) to reduce false positives.

## Practical tips
- Use -Pn if ICMP is blocked; otherwise Nmap may skip live hosts.
- Keep scripts updated: sudo nmap --script-updatedb
- NSE results can be noisy; cross-verify with Metasploit’s scanner.
- Metasploit requires root for raw sockets in some environments; run with sudo if needed.
- EternalBlue is most reliable on Windows 7/Server 2008 R2 x64. Architecture matters for exploitation; confirm before attempting.
- Do not run the exploit during vulnerability analysis; exploitation may crash targets.
- Firewalls or IPS can alter results; consider scanning from inside the same network segment.

## Minimal cheat sheet (one-screen flow)
```
# 1) Find SMB
sudo nmap -p445 --open -sS -n -Pn -T4 SUBNET/24 -oG smb.gnmap
grep "/open/tcp//microsoft-ds" smb.gnmap | awk '{print $2}' > smb_hosts.txt

# 2) SMB/OS context
sudo nmap -sV -p445 --script smb-os-discovery $(cat smb_hosts.txt)

# 3) SMBv1 present?
sudo nmap --script smb-protocols -p445 TARGET

# 4) Nmap MS17-010 check
sudo nmap -p445 --script smb-vuln-ms17-010 TARGET

# 5) Metasploit validation
msfconsole -q -x "use auxiliary/scanner/smb/smb_ms17_010; set RHOSTS TARGET; run; exit"

# 6) Optional OS detail
rpcclient -U "" -N TARGET -c srvinfo
```

## Summary
This session focuses on safely identifying EternalBlue (MS17-010) exposure. The workflow: locate hosts with TCP/445 open, enumerate SMB/OS and SMBv1 support, run Nmap’s smb-vuln-ms17-010 script, and confirm with Metasploit’s smb_ms17_010 scanner. Stop at verification; exploitation is out of scope for vulnerability analysis and can destabilize targets.