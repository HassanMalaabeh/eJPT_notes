# 03 - Vulnerability Analysis: BlueKeep (CVE-2019-0708)

Note: No transcript was provided. The following is an inferred summary and a conservative, lab-safe workflow typically shown in eJPT-style training for BlueKeep vulnerability analysis. Commands focus on discovery and safe verification, not exploitation. Run only in authorized labs.

## What the video covers (Introduction / big picture)
- BlueKeep (CVE-2019-0708) is a critical, wormable RDP pre-auth RCE affecting older Windows (notably Windows 7/Server 2008/2008 R2 and older).
- Goal: Identify hosts exposing RDP (TCP/3389), fingerprint the OS/service, determine if BlueKeep is likely present, and report risk/remediation.
- Emphasis on safe checks:
  - Detect RDP and OS versions.
  - Check if NLA is required (mitigates pre-auth exploitation).
  - Use Metasploit auxiliary scanner and rdpscan for non-intrusive validation.
  - Document findings and advise patching.

## Flow (ordered)
1. Discover RDP on the target scope (find TCP/3389).
2. Fingerprint service/OS via Nmap (-sV/-O) and RDP NSE scripts.
3. Check NLA support/requirement and RDP security (NSE + RDP client).
4. Use Metasploit auxiliary scanner for BlueKeep (safe check).
5. Cross-validate with rdpscan (lightweight detector).
6. Correlate with SMB/OS discovery to confirm vulnerable OS families.
7. Document impact and remediation (apply Microsoft patches, enable NLA, restrict exposure).

## Tools highlighted
- Nmap (discovery, service detection, NSE scripts: rdp-enum-encryption, rdp-ntlm-info, smb-os-discovery)
- Metasploit Framework (auxiliary/scanner/rdp/cve_2019_0708_bluekeep)
- rdpscan (Robert Graham’s BlueKeep scanner)
- xfreerdp (to quickly check if NLA is required/handshake behavior)
- searchsploit (to locate advisories/PoCs for context—do not run exploits in production)

## Typical command walkthrough (detailed, copy-paste friendly)

Set handy vars (optional):
```bash
export SUBNET=10.10.10.0/24
export TARGET=10.10.10.10
export RPORT=3389
mkdir -p ~/bluekeep && cd ~/bluekeep
```

1) Discover RDP exposure
```bash
# Fast discovery of hosts with 3389 open
nmap -p $RPORT --open -n -Pn -v -oA rdp_discovery $SUBNET
```

2) Service and OS fingerprinting
```bash
# Version detection, default scripts, and OS guess for hosts with 3389 open
nmap -sS -sV -sC -O -p $RPORT -n -Pn -oA rdp_fingerprint $SUBNET
```

3) RDP-focused NSE enumeration
```bash
# Check RDP encryption, NLA support/requirement, and NTLM info
nmap -p $RPORT --script rdp-enum-encryption,rdp-ntlm-info -n -Pn -oN rdp_nse_$TARGET.txt $TARGET

# If SMB/445 is open, confirm OS precisely
nmap -p 445 --script smb-os-discovery -n -Pn -oN smb_os_$TARGET.txt $TARGET
```

4) Check NLA requirement with an RDP client (non-auth)
```bash
# Try a quick handshake; if NLA is required, you'll see an NLA-related failure message
xfreerdp /v:$TARGET /cert:ignore /log-level:INFO /timeout:3000
```

5) Metasploit safe check (BlueKeep auxiliary scanner)
```bash
msfconsole -q -x "
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep;
set RHOSTS $TARGET;
set RPORT $RPORT;
set THREADS 10;
set VERBOSE true;
run;
exit"
```
Notes:
- This is a non-exploit scanner; it won’t attempt RCE. Look for outputs indicating VULNERABLE, LIKELY VULNERABLE, NLA required, or SAFE.

6) Cross-validate with rdpscan
```bash
# Build rdpscan (requires git, make, gcc)
sudo apt-get update && sudo apt-get install -y git build-essential
git clone https://github.com/robertdavidgraham/rdpscan.git
cd rdpscan && make

# Scan a single host or a subnet
./rdpscan $TARGET
./rdpscan $SUBNET
```
Typical rdpscan outcomes:
- VULNERABLE (no NLA; affected OS/signature detected)
- SAFE (NLA required or patched)
- UNKNOWN (couldn’t determine—correlate with other evidence)

7) Correlate OS/version to likely exposure window
- BlueKeep impacted: Windows 7/Server 2008/2008 R2 (and older XP/2003 which received out-of-band patches).
- If your enumeration shows newer OS (e.g., Windows 10/Server 2016+), BlueKeep is not applicable.

8) Document and recommend remediation
- Apply Microsoft patches addressing CVE-2019-0708 (May 2019 updates; out-of-band for legacy OS).
- Enforce NLA, restrict RDP to VPN/jump hosts, and deploy network ACLs.
- Remove public exposure of 3389 where possible.

## Practical tips
- Prefer safe checks: auxiliary scanners and rdpscan won’t try to exploit.
- NLA required generally blocks pre-auth BlueKeep exploitation; still patch regardless.
- Combine evidence: RDP NSE results, Metasploit scanner, rdpscan, and SMB OS discovery for a confident assessment.
- Be mindful of false negatives behind firewalls/IPS; cross-validate and re-check with verbose logs.
- Always run with explicit authorization; log your commands and capture outputs for reporting.

## Minimal cheat sheet (one-screen flow)
```bash
# 1) Find RDP
nmap -p 3389 --open -n -Pn -oA rdp_discovery 10.10.10.0/24

# 2) Fingerprint RDP/OS
nmap -sV -sC -O -p 3389 -n -Pn -oA rdp_fingerprint 10.10.10.0/24

# 3) RDP NSE checks
nmap -p 3389 --script rdp-enum-encryption,rdp-ntlm-info -n -Pn -oN rdp_nse_10.10.10.10.txt 10.10.10.10

# 4) Metasploit BlueKeep safe scan
msfconsole -q -x "use auxiliary/scanner/rdp/cve_2019_0708_bluekeep; set RHOSTS 10.10.10.10; run; exit"

# 5) rdpscan cross-check
git clone https://github.com/robertdavidgraham/rdpscan.git && cd rdpscan && make
./rdpscan 10.10.10.10

# 6) Optional: verify NLA handshake
xfreerdp /v:10.10.10.10 /cert:ignore /timeout:3000
```

## Summary
- BlueKeep is a critical RDP pre-auth RCE (CVE-2019-0708) primarily affecting Windows 7/Server 2008/2008 R2 and older systems.
- A safe BlueKeep assessment workflow:
  - Identify RDP, fingerprint OS/service, and check NLA requirement.
  - Use Metasploit’s auxiliary BlueKeep scanner and rdpscan to validate.
  - Correlate with SMB OS discovery to confirm vulnerable OS families.
  - Recommend patching, enabling NLA, and restricting RDP exposure.
- With no transcript available, the above reflects a standard, exam-relevant, lab-safe methodology for BlueKeep vulnerability analysis.