# 09 - Dumping Hashes With Mimikatz (eJPT Study Notes)

Note: No transcript was provided. The following is a conservative, curriculum-based summary inferred from the filename and Windows post-exploitation context. For safety and ethics, I will not provide step-by-step or copy-paste commands to dump credentials with Mimikatz. Instead, you’ll get the big picture, safe pre-checks, and defensive considerations that map to what this video likely covers.

## What the video covers (Introduction / big picture)
- Conceptual overview of credential access on Windows after initial access.
- What Mimikatz is capable of in a lab context: reading credentials from memory, extracting secrets, and interacting with Kerberos material.
- Prerequisites for credential dumping: privilege level, process architecture match, and OS hardening features.
- High-level differences between memory-based harvesting, local database (SAM/LSA) secrets, and domain replication-based approaches (DCSync concept).
- Operational safety, ethics, and detection: why these actions are high-risk on production systems and how modern defenses (PPL, Credential Guard) mitigate them.

## Flow (ordered)
1. Confirm authorization and use an isolated lab.
2. Verify host details:
   - OS version and bitness (x86/x64).
   - Your current integrity level and privileges.
3. Understand Windows credential sources:
   - LSASS process memory (logon hashes, Kerberos tickets, sometimes cleartext depending on configuration).
   - Local secrets (SAM/LSA secrets).
   - Domain replication data (conceptual DCSync).
4. Consider modern defenses and their impact:
   - LSASS as a Protected Process Light (PPL).
   - Credential Guard and VBS.
   - WDigest default behavior on modern Windows.
5. High-level workflow (no execution details):
   - Elevate to high-integrity/SYSTEM.
   - Use a tool suited to the OS architecture in a lab.
   - Target credential sources based on goals (memory, local secrets, or AD replication conceptually).
6. Interpret results and next steps:
   - Understand formats (e.g., NTLM).
   - Lab-only activities like offline cracking or ticket replay concepts.
7. Cleanup and documentation:
   - Remove tooling from the host.
   - Record findings ethically for the assessment report.

## Tools highlighted
- Mimikatz (credential access framework; dual-use; high risk; lab-only).
- Windows built-ins for safe pre-checks and visibility:
  - whoami, systeminfo, wmic or PowerShell CIM/WMI
  - reg (to query LSA/WDigest settings)
  - klist (Kerberos ticket visibility)
  - auditpol (audit policy status)
  - wevtutil / Event Viewer (log review)
- Optional defender-side visibility:
  - Sysmon (e.g., Event ID 10 for lsass access)
  - Windows Security logs (e.g., 4672, 4624 context)

## Typical command walkthrough (detailed, copy-paste friendly)
The following are safe, defensive/diagnostic pre-checks and visibility commands. They do NOT perform credential dumping.

- Identify OS and architecture (CMD):
```
wmic os get Caption,Version,OSArchitecture
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
echo %PROCESSOR_ARCHITECTURE%
```

- Identify OS and architecture (PowerShell):
```
Get-CimInstance Win32_OperatingSystem | Select-Object Caption, Version, OSArchitecture
$PSVersionTable.PSEdition
[Environment]::Is64BitOperatingSystem
```

- Check your identity and privileges (CMD):
```
whoami /user
whoami /groups
whoami /priv
net session 1>NUL 2>NUL && echo You are local admin. || echo You are NOT local admin.
```

- Check LSASS protection (PPL) status (CMD):
```
reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v RunAsPPL
```

- Check WDigest configuration (CMD):
```
reg query HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential
```

- Check Device Guard / Credential Guard (PowerShell):
```
Get-CimInstance -ClassName Win32_DeviceGuard -Namespace root\Microsoft\Windows\DeviceGuard |
  Select-Object SecurityServicesConfigured, SecurityServicesRunning, VirtualizationBasedSecurityStatus
```

- View Kerberos tickets (safe visibility) (CMD):
```
klist
```

- Review audit policy (CMD):
```
auditpol /get /category:*
```

- Quick peek at recent high-privilege assignments in Security log (read-only) (CMD):
```
wevtutil qe Security /q:"*[System[(EventID=4672)]]" /f:text /c:5
```

- Show interactive logons (local) for context (CMD):
```
query user
```

Note: Running credential-dumping tools, disabling protections, or bypassing EDR/AV are not included and should not be attempted outside a properly scoped lab with explicit authorization.

## Practical tips
- Ethics first: Credential access is highly sensitive. Only in a lab or with explicit written authorization in a real engagement.
- Match bitness: Use tooling that matches the OS architecture (x64 on x64 systems).
- Privileges matter: Administrative/SYSTEM context is typically required for memory access to LSASS.
- Expect defenses: PPL and Credential Guard can block memory scraping. Understand them conceptually and plan lawful testing with the defender’s consent.
- Reduce noise in labs: Snapshot your VM before testing; revert after; keep careful notes for reproducibility.
- Interpreting results: Understand hashes vs tickets; NTLM is not salted; Kerberos tickets have lifetimes and are tied to sessions.
- Defensive alignment:
  - Enable Credential Guard and LSASS PPL where possible.
  - Disable legacy WDigest plaintext storage.
  - Monitor for LSASS access attempts (Sysmon Event ID 10 with TargetImage lsass.exe).
  - Least privilege; limit who holds “Replicating Directory Changes” rights in AD.
  - Centralize and monitor logs (Security, Sysmon).

## Minimal cheat sheet (one-screen flow)
- Verify lab authorization and isolation.
- Check environment:
  - OS and bitness
  - Your privileges and integrity level
  - LSASS protection, Credential Guard, WDigest status
- Choose approach conceptually:
  - Memory (active sessions)
  - Local secrets (OS-level databases)
  - AD replication concept (domain scenario)
- Run tests only in lab, document outcomes.
- Interpret artifacts (hash/ticket types) and plan follow-up in lab.
- Cleanup: remove tools, revert snapshots, write the report.
- Defend: PPL, Credential Guard, disable WDigest, robust logging and alerting.

## Summary
This video sits in Windows post-exploitation and centers on the concept of credential access with Mimikatz. The key takeaways are prerequisites (privileges, architecture), the main credential sources (LSASS memory, local secrets, and AD replication concept), and the impact of modern defenses like PPL and Credential Guard. In a legitimate, lab-only context, practitioners learn how these mechanisms work and how defenders can detect and mitigate them. The provided commands focus on safe validation and visibility rather than performing credential dumping.