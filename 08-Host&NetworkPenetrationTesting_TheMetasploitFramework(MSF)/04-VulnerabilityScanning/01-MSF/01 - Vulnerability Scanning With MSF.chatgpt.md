# Vulnerability Scanning With MSF (Metasploit) — eJPT Study Notes

Note: No transcript was provided; the following is inferred conservatively from the title and folder (01-MSF). Commands and modules are standard for eJPT-level Metasploit usage.

## What the video covers (Introduction / big picture)
- Using Metasploit Framework (MSF) to perform discovery and vulnerability scanning, not exploitation.
- Leveraging MSF’s database (PostgreSQL) to store hosts/services and drive targeted scans.
- Using auxiliary/scanner modules and the check action of certain exploit modules to confirm known CVEs.
- Building a repeatable workflow: enumerate → filter → scan → review vulns → export results.

## Flow (ordered)
1. Start the database and launch msfconsole.
2. Create/select a workspace for the engagement.
3. Discover hosts and services (db_nmap or import).
4. Filter services/ports to pick relevant scanners.
5. Search and select MSF scanner modules (and/or exploit modules with check).
6. Configure RHOSTS/RPORT/THREADS and run scans.
7. Review results (hosts, services, vulns, notes, loot) and export.
8. Iterate per service/CVE.

## Tools highlighted
- Metasploit Framework (msfconsole)
- MSF database integration (PostgreSQL)
- db_nmap (Nmap integration into MSF DB)
- Auxiliary scanner modules (auxiliary/scanner/*)
- Exploit modules’ check action (for safe vuln validation)
- Reporting commands: hosts, services, vulns, notes, creds, loot

## Typical command walkthrough (detailed, copy-paste friendly)

Preparation (system)
```bash
# Start DB (Kali-based)
sudo systemctl enable --now postgresql

# Initialize MSF DB (if needed)
msfdb init
```

Start msfconsole and set up workspace
```bash
msfconsole -q

# Inside msfconsole:
db_status
workspace -a ejpt_lab
workspace ejpt_lab

# Optional: log everything
spool msf_run.log
```

Discover hosts/services using db_nmap (results auto-imported)
```bash
# Adjust subnet to your lab
db_nmap -sS -sV -O -Pn -T4 10.10.10.0/24
hosts
services
```

Target selection helpers
```bash
# Set RHOSTS to all discovered hosts
hosts -R

# Set RHOSTS to hosts with a given port open (e.g., 445/SMB, 80/HTTP, 3389/RDP)
services -p 445 -u -R
services -p 80,443,8080 -u -R
services -p 3389 -u -R
```

General service version scanners
```bash
# SMB version
use auxiliary/scanner/smb/smb_version
set THREADS 32
run

# HTTP version
use auxiliary/scanner/http/http_version
services -p 80,443,8080 -u -R
set THREADS 32
run

# SSH version
use auxiliary/scanner/ssh/ssh_version
services -p 22 -u -R
set THREADS 32
run

# FTP version
use auxiliary/scanner/ftp/ftp_version
services -p 21 -u -R
set THREADS 32
run

# RDP scanner
use auxiliary/scanner/rdp/rdp_scanner
services -p 3389 -u -R
set THREADS 32
run
```

CVE-focused vulnerability scanners (examples)
```bash
# Search for scanners by service/CVE
search type:auxiliary scanner smb
search cve:2017 type:auxiliary smb
search cve:2019 type:auxiliary rdp
search heartbleed type:auxiliary

# SMB EternalBlue (MS17-010) check
use auxiliary/scanner/smb/smb_ms17_010
services -p 445 -u -R
set THREADS 32
run

# OpenSSL Heartbleed (CVE-2014-0160)
use auxiliary/scanner/ssl/openssl_heartbleed
services -p 443 -u -R
set THREADS 32
set RPORT 443
set VERBOSE false
run

# BlueKeep (CVE-2019-0708) detector (module name can vary by version)
search cve:2019 type:auxiliary rdp bluekeep
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
services -p 3389 -u -R
set THREADS 16
run
```

Using exploit modules’ check action safely
```bash
# EternalBlue exploit's check to validate vulnerability (no exploitation)
use exploit/windows/smb/ms17_010_eternalblue
services -p 445 -u -R
set THREADS 16
check
```

Feeding targets from files
```bash
# RHOSTS can read from a file (one IP/CIDR per line)
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS file:/tmp/targets.txt
set THREADS 32
run
```

Review, annotate, and export results
```bash
# Review database artifacts
hosts
services
vulns
notes
loot
creds

# Filter and export
services -p 445
vulns -o vulns.csv
hosts -c address,os_name,name,info -o hosts.csv
services -o services.csv

# Stop logging if enabled
spool off
```

Importing external scans (optional)
```bash
# If you ran nmap outside MSF with -oX scan.xml
db_import scan.xml
```

## Practical tips
- Always work inside a dedicated workspace to keep results organized.
- Use services -p <port> -u -R to target only relevant hosts for each scanner.
- THREADS 16–64 is often safe in labs; reduce if you see timeouts or fragile services.
- Prefer auxiliary/scanner modules and check actions to validate vulns without exploitation.
- db_nmap -sV -O -Pn -T4 is a good default for lab discovery; add -p- when you need full port coverage.
- Export vulns/hosts/services early and often for reporting; keep a spool log for traceability.
- Module names may vary slightly by MSF version—use search to confirm before use.
- Only scan systems you are authorized to test.

## Minimal cheat sheet (one-screen flow)
```bash
# Setup
sudo systemctl enable --now postgresql
msfconsole -q

# Workspace + discovery
workspace -a ejpt_lab
db_status
db_nmap -sS -sV -O -Pn -T4 10.10.10.0/24

# Review
hosts
services

# SMB version + MS17-010
use auxiliary/scanner/smb/smb_version
services -p 445 -u -R
set THREADS 32
run
use auxiliary/scanner/smb/smb_ms17_010
run

# HTTP/HTTPS version
use auxiliary/scanner/http/http_version
services -p 80,443,8080 -u -R
set THREADS 32
run

# Heartbleed
use auxiliary/scanner/ssl/openssl_heartbleed
services -p 443 -u -R
set THREADS 32
run

# RDP scan (and BlueKeep check if available)
use auxiliary/scanner/rdp/rdp_scanner
services -p 3389 -u -R
set THREADS 16
run
search cve:2019 type:auxiliary rdp bluekeep
# use ...bluekeep (if present), then run

# Export
vulns -o vulns.csv
hosts -c address,os_name,name,info -o hosts.csv
services -o services.csv
```

## Summary
- Metasploit is a capable vulnerability scanner when you leverage its auxiliary/scanner modules and integrated database.
- A solid eJPT workflow: discover with db_nmap, filter with services, search/select scanners by service/CVE, run with RHOSTS/THREADS set, then review via vulns/hosts/services and export results.
- Use check actions for safe validation and keep everything organized in workspaces with logs and exports.