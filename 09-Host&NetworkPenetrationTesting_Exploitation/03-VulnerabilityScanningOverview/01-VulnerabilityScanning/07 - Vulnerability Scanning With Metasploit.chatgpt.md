# 07 - Vulnerability Scanning With Metasploit (eJPT)

Note: No transcript was provided. The following summary is inferred conservatively from the filename and typical eJPT coverage of Metasploit-based vulnerability scanning.

## What the video covers (Introduction / big picture)
- How to use Metasploit Framework as a vulnerability scanning aid during network enumeration
- Building a pipeline: discover hosts/services → run targeted auxiliary scanners → verify known CVEs with “check” → review results in Metasploit’s database
- Integrating Nmap results into Metasploit (db_nmap/db_import)
- Using service-specific auxiliary scanners (SMB, RDP, FTP, SSH, HTTP/SSL)
- Optional: basic web scanning with Metasploit’s WMAP
- Recording and exporting findings (hosts, services, vulns)

## Flow (ordered)
1. Start database backend and launch Metasploit
2. Create/select a workspace to keep results organized
3. Discover live hosts and services (db_nmap or import existing Nmap XML)
4. Review hosts/services tables
5. Run targeted auxiliary scanners by service/port (SMB, RDP, FTP, SSH, HTTP/SSL)
6. Use exploit modules’ “check” action for known CVEs when available
7. Optional web vuln scan with WMAP
8. Review findings in vulns/notes/loot; export/report

## Tools highlighted
- Metasploit Framework (msfconsole)
  - Workspaces and database: hosts, services, vulns, notes, loot
  - db_nmap and db_import (Nmap integration)
  - Auxiliary scanner modules: auxiliary/scanner/*
  - Exploit modules’ check method for CVE presence
  - WMAP (Metasploit’s web scanner plugin)
- Nmap (via db_nmap or external run + db_import)

## Typical command walkthrough (detailed, copy-paste friendly)

Replace example targets like 10.10.10.0/24 and 10.10.10.5 with your lab/exam scope.

System prep (Kali/Debian-based):
```
sudo systemctl enable --now postgresql
sudo msfdb init
msfconsole -q
```

Inside msfconsole: create/select workspace and confirm DB
```
workspace -a vulnscan
workspace vulnscan
db_status
```

Option A: Discover live hosts (ping sweep) then enumerate services
```
db_nmap -sn 10.10.10.0/24
hosts
```

Option B: Direct service discovery (adjust flags for privilege)
- Privileged (root) TCP SYN:
```
db_nmap -sS -sV -O -T4 10.10.10.0/24
```
- Unprivileged TCP connect:
```
db_nmap -sT -sV -O -T4 10.10.10.0/24
```

Review enumerated data:
```
hosts
services
```

Set a reasonable thread count globally:
```
setg THREADS 20
```

SMB enumeration and MS17-010 check:
```
use auxiliary/scanner/smb/smb_version
services -p 445 -R
run

use auxiliary/scanner/smb/smb_ms17_010
services -p 445 -R
run
```

RDP BlueKeep (CVE-2019-0708) check:
```
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
services -p 3389 -R
run
```

FTP anonymous login check:
```
use auxiliary/scanner/ftp/anonymous
services -p 21 -R
run
```

SSH version grab (and quick weak-creds probe if desired):
```
use auxiliary/scanner/ssh/ssh_version
services -p 22 -R
run
```

HTTP/HTTPS quick fingerprinting:
```
use auxiliary/scanner/http/http_version
services -p 80 -R
run

use auxiliary/scanner/http/http_title
services -p 80 -R
run

use auxiliary/scanner/ssl/ssl_version
services -p 443 -R
run

use auxiliary/scanner/http/http_title
set RPORT 443
set SSL true
services -p 443 -R
run
```

Search for CVE-focused scanners/exploits and use “check” where supported:
```
search type:auxiliary cve:2017 port:445
search type:exploit cve:2017 port:445
```
Example “check” with EternalBlue:
```
use exploit/windows/smb/ms17_010_eternalblue
services -p 445 -R
check
```

View consolidated results and export:
```
vulns
notes
loot
hosts
services
db_export -f xml -a msf_export.xml
```

Optional: Import an existing Nmap XML instead of running db_nmap:
```
db_import /path/to/scan.xml
hosts
services
```

Optional: Basic web vuln scanning with WMAP (experimental; noisy):
```
load wmap
wmap_sites -a http://10.10.10.5
wmap_targets -t http://10.10.10.5
wmap_run -e
wmap_vulns -l
```

Logging session output:
```
spool /tmp/msf_vulnscan.log
# ... run your scans ...
spool off
```

## Practical tips
- Start broad, then get precise: use db_nmap to populate services, then run targeted auxiliary scanners per service.
- Use services -p <port> -R after selecting a module to auto-fill RHOSTS from the Metasploit DB.
- Prefer “check” in exploit modules to test for a CVE instead of firing exploits during recon.
- THREADS speeds things up but can trigger IDS/IPS; tune cautiously in production-like networks.
- If not running Metasploit as root, prefer -sT over -sS in db_nmap; OS detection (-O) may still work, but some probes require privileges.
- Keep scans bounded: scanning -p- on a /24 is slow/noisy; identify live hosts first (db_nmap -sn), then target those.
- For HTTPS modules, set SSL true and correct RPORT (usually 443).
- On eJPT, focus on high-signal checks: smb_ms17_010, BlueKeep, FTP anonymous, HTTP/SSL fingerprints, and version-based findings.
- Consolidate results with vulns and notes; export with db_export for your report.

## Minimal cheat sheet (one-screen flow)
```
sudo systemctl enable --now postgresql
sudo msfdb init
msfconsole -q
workspace -a vulnscan
db_status
db_nmap -sn 10.10.10.0/24
db_nmap -sT -sV -O -T4 10.10.10.0/24
hosts
services
setg THREADS 20

use auxiliary/scanner/smb/smb_version
services -p 445 -R
run
use auxiliary/scanner/smb/smb_ms17_010
services -p 445 -R
run

use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
services -p 3389 -R
run

use auxiliary/scanner/ftp/anonymous
services -p 21 -R
run

use auxiliary/scanner/http/http_version
services -p 80 -R
run
use auxiliary/scanner/ssl/ssl_version
services -p 443 -R
run

vulns
db_export -f xml -a msf_export.xml
```

## Summary
- The video demonstrates using Metasploit as a vulnerability scanning orchestrator: populate its DB with host/service data (db_nmap or db_import), then run targeted auxiliary scanners to identify weaknesses quickly.
- Emphasis is on common high-value checks (SMB/MS17-010, RDP/BlueKeep, FTP anonymous, HTTP/SSL fingerprinting) and using “check” where available to confirm CVEs with minimal risk.
- Results are managed via Metasploit’s hosts/services/vulns tables, with optional WMAP for web scanning and export/logging for reporting.