# 03 - Port Scanning & Enumeration - Linux (eJPT Study Notes)

Note: No transcript was provided. The following is a conservative, best-practice summary inferred from the filename and typical eJPT Linux exploitation workflow. Use only on systems you own or have explicit authorization (e.g., eJPT labs).

## What the video covers (Introduction / big picture)
- A practical methodology for discovering live Linux targets, identifying open ports, and enumerating services to build an attack plan.
- Fast and thorough scanning with nmap (and optional accelerators like masscan/rustscan).
- Targeted enumeration of common Linux services (SSH, FTP, HTTP/HTTPS, SMB/Samba, NFS, RPC, DNS, SNMP, databases).
- Saving outputs, parsing results, and prioritizing next steps.

## Flow (ordered)
1. Define scope and set a working folder per target.
2. Host discovery (ARP/ping sweep) to find live hosts.
3. Quick TCP scan (top ports) to get initial foothold.
4. Full TCP scan of all ports; extract open ports for focused enumeration.
5. Service/version detection and default NSE scripts on discovered ports.
6. UDP reconnaissance (top ports or targeted: DNS, SNMP, NTP).
7. Service-specific enumeration (FTP, SSH, HTTP/S, SMB, NFS, RPC, DNS, SNMP, databases, etc.).
8. Record findings, revisit with deeper scripts only where necessary, and iterate.

## Tools highlighted
- nmap: Core discovery, TCP/UDP scanning, service/version detection, NSE scripts, output files.
- masscan or rustscan (optional): Very fast initial port discovery; validate with nmap.
- netcat (nc), telnet, openssl s_client: Banner grabbing.
- curl, whatweb, nikto, gobuster/feroxbuster: Web enumeration.
- smbclient, enum4linux-ng: SMB/Samba enumeration.
- showmount, rpcinfo: NFS/RPC enumeration.
- snmpwalk, snmp-check/onesixtyone: SNMP enumeration.
- dig, nslookup: DNS enumeration.
- mysql, psql, redis-cli, rsync: Service clients for default/weak-config checks.
- sslscan, nmap ssl-* NSE: TLS/service security checks.

## Typical command walkthrough (detailed, copy-paste friendly)
Set a target variable and workspace:
```bash
# Replace with your target IP or hostname
TARGET=10.10.10.10
WORKDIR=recon/$TARGET
mkdir -p "$WORKDIR"/{scans,enum,loot} && cd "$WORKDIR"
```

1) Host discovery (adjust network)
```bash
# ARP/ping sweep (local subnet example)
nmap -sn -PR 10.10.10.0/24 -oA scans/arp_ping

# If ICMP is filtered but you know a target, skip host discovery later with -Pn
```

2) Quick TCP scan (top ports)
```bash
# Fast top-1000 TCP ports scan
nmap -Pn -n -T4 -F $TARGET -oA scans/tcp_fast
```

3) Full TCP scan (all ports)
```bash
# SYN scan (needs sudo); use -sT if not root
sudo nmap -Pn -n -T4 -sS -p- $TARGET -oA scans/tcp_allports

# Extract open TCP ports into a variable for reuse
OPEN_TCP=$(grep -oP '\d+/open/tcp' scans/tcp_allports.gnmap | cut -d/ -f1 | sort -un | tr '\n' ',' | sed 's/,$//')
echo "Open TCP ports: $OPEN_TCP"
```

4) Service/version detection + default scripts
```bash
# Safe, informative follow-up on open TCP ports
sudo nmap -Pn -n -T4 -sS -sV -sC -p $OPEN_TCP $TARGET -oA scans/tcp_enum

# (Optional) Aggressive (noisy): OS detect, traceroute, more NSE
# sudo nmap -Pn -n -T4 -A -p $OPEN_TCP $TARGET -oA scans/tcp_aggr
```

5) UDP reconnaissance
```bash
# Top UDP ports (slow; limit scope if time-limited)
sudo nmap -Pn -n -sU --top-ports 20 $TARGET -oA scans/udp_top20

# Target common UDP services directly if needed
sudo nmap -Pn -n -sU -p 53,67,68,69,123,137,161,500,514 $TARGET -oA scans/udp_common
```

6) Banner grabbing (quick checks)
```bash
# TCP banners
nc -nv -w 3 $TARGET 22
nc -nv -w 3 $TARGET 80

# TLS banner/cert info
openssl s_client -connect $TARGET:443 -servername $TARGET </dev/null 2>/dev/null | openssl x509 -noout -text
```

7) Service-specific enumeration (run only for ports you actually have)

FTP (21/tcp)
```bash
# NSE checks
nmap -p21 --script ftp-anon,ftp-bounce,ftp-syst -sV $TARGET -oN enum/ftp_nse.txt

# Try anonymous if present
ftp -inv $TARGET << 'EOF'
user anonymous anonymous@
ls -la
bye
EOF
```

SSH (22/tcp)
```bash
nmap -p22 --script ssh2-enum-algos,ssh-hostkey,ssh-auth-methods -sV $TARGET -oN enum/ssh_nse.txt
# Verbose client banner/algos
ssh -vvv -o PreferredAuthentications=none -o PubkeyAuthentication=no user@$TARGET 2>&1 | tee enum/ssh_vvv.txt
# If unknown user, replace 'user' with a likely username or omit to test connection only: ssh -vvv $TARGET
```

HTTP/HTTPS (80/443/tcp and other web ports: 8080, 8443, etc.)
```bash
# Identify tech stack quickly
whatweb http://$TARGET/ | tee enum/http_whatweb.txt
curl -I http://$TARGET/ | tee enum/http_headers.txt

# Basic content discovery (adjust wordlist, extensions)
gobuster dir -u http://$TARGET/ -w /usr/share/wordlists/dirb/common.txt -t 50 -x php,txt,html -o enum/http_gobuster.txt

# SSL/TLS info on HTTPS
sslscan --no-colour $TARGET:443 | tee enum/https_sslscan.txt
nmap -p443 --script ssl-cert,ssl-enum-ciphers,ssl-dh-params -sV $TARGET -oN enum/https_nse.txt

# Quick vuln-style web check (noisy, acceptable in labs)
nikto -host http://$TARGET/ -o enum/http_nikto.txt
```

SMB/Samba (139,445/tcp)
```bash
# Quick NSE
nmap -p139,445 --script smb-enum-shares,smb-enum-users,smb-os-discovery -sV $TARGET -oN enum/smb_nse.txt

# List shares (no auth)
smbclient -L //$TARGET/ -N | tee enum/smb_shares.txt

# Connect to a share if present (replace SHARE)
smbclient //$TARGET/SHARE -N -c 'ls; pwd'

# Extended enumeration
enum4linux-ng $TARGET | tee enum/enum4linux-ng.txt
```

RPC/NFS (111,2049)
```bash
# RPC programs
rpcinfo -p $TARGET | tee enum/rpcinfo.txt

# List NFS exports
showmount -e $TARGET | tee enum/nfs_exports.txt

# Mount an export (replace /export/path from showmount output)
sudo mkdir -p /mnt/nfs_$TARGET
sudo mount -t nfs -o rw,vers=3 $TARGET:/export/path /mnt/nfs_$TARGET
ls -la /mnt/nfs_$TARGET
# When done:
sudo umount /mnt/nfs_$TARGET
```

DNS (53/udp,tcp)
```bash
# Service/version
sudo nmap -sU -p53 -sV $TARGET -oN enum/dns_udp.txt

# Chaos class version (if allowed)
dig @${TARGET} version.bind CHAOS TXT +short | tee enum/dns_bindver.txt

# If a domain is known and hosted on target, try zone transfer (replace example.com)
dig @${TARGET} example.com AXFR | tee enum/dns_axfr.txt
```

SNMP (161/udp)
```bash
# Check if open
sudo nmap -sU -p161 -sV $TARGET -oN enum/snmp_udp.txt

# Common community string (public); try others only in authorized labs
snmpwalk -v2c -c public $TARGET 1.3.6.1.2.1.1 | tee enum/snmp_sysdescr.txt
# Useful trees (processes, users, network)
snmpwalk -v2c -c public $TARGET 1.3.6.1.2.1.25.1.6.0 | tee -a enum/snmp_misc.txt
snmpwalk -v2c -c public $TARGET 1.3.6.1.2.1.25.4.2.1.2 | tee -a enum/snmp_processes.txt
snmpwalk -v2c -c public $TARGET 1.3.6.1.4.1 | tee -a enum/snmp_enterprise.txt
```

Mail (25/587/tcp)
```bash
nmap -p25,587 --script smtp-commands,smtp-enum-users -sV $TARGET -oN enum/smtp_nse.txt
```

Databases (scan only if ports found)
```bash
# MySQL (3306)
nmap -p3306 --script mysql-info,mysql-empty-password,mysql-users -sV $TARGET -oN enum/mysql_nse.txt
# Try connecting (lab)
mysql -h $TARGET -u root -p

# PostgreSQL (5432)
nmap -p5432 --script pgsql-info -sV $TARGET -oN enum/pgsql_nse.txt
# Try connecting (lab)
psql -h $TARGET -U postgres -W

# Redis (6379)
nmap -p6379 --script redis-info -sV $TARGET -oN enum/redis_nse.txt
redis-cli -h $TARGET ping
```

Other common services (as discovered)
```bash
# RSync (873)
rsync ${TARGET}:: | tee enum/rsync_modules.txt
# List a module (replace MODULE)
rsync -av --list-only ${TARGET}::MODULE | tee enum/rsync_list_module.txt

# VNC (5900+)
nmap -p5900 --script vnc-info -sV $TARGET -oN enum/vnc_nse.txt
```

8) Save and summarize findings
```bash
# Consolidate open ports and versions
grep -E "open|Service Info" scans/tcp_enum.nmap | tee loot/summary_tcp.txt
[ -f scans/udp_top20.nmap ] && grep open scans/udp_top20.nmap | tee loot/summary_udp.txt
```

## Practical tips
- Prefer -sS (SYN) scans with sudo; fall back to -sT if not root.
- Use -Pn and -n to avoid failed pings and slow DNS lookups; add -T4 for speed in labs.
- Scan fast first (-F), then full (-p-) and enumerate only discovered ports (-sC -sV).
- Save all outputs (-oA/-oN) and parse .gnmap to avoid rescans.
- UDP is slow and noisy; target specific services first (53,161,123).
- For HTTP, always enumerate both content and tech stack (whatweb/curl + gobuster + nikto).
- For SMB/NFS, try anonymous/guest access first; mount NFS read-only in case of sensitive data.
- Re-scan after changes (e.g., service restarts, new creds) to discover new avenues.
- Keep notes of versions and codenames; map to potential known vulns later.
- Stay within scope and rate-limit on shared ranges to avoid disruption.

## Minimal cheat sheet (one-screen flow)
```bash
# Setup
TARGET=10.10.10.10; WD=recon/$TARGET; mkdir -p $WD/{scans,enum} && cd $WD

# Fast + full TCP
nmap -Pn -n -T4 -F $TARGET -oA scans/tcp_fast
sudo nmap -Pn -n -T4 -sS -p- $TARGET -oA scans/tcp_allports
OPEN_TCP=$(grep -oP '\d+/open/tcp' scans/tcp_allports.gnmap | cut -d/ -f1 | sort -un | tr '\n' ',' | sed 's/,$//')
sudo nmap -Pn -n -T4 -sS -sV -sC -p $OPEN_TCP $TARGET -oA scans/tcp_enum

# UDP (targeted)
sudo nmap -Pn -n -sU --top-ports 20 $TARGET -oA scans/udp_top20

# Web (if 80/443)
whatweb http://$TARGET/ | tee enum/http_whatweb.txt
gobuster dir -u http://$TARGET/ -w /usr/share/wordlists/dirb/common.txt -t 50 -x php,txt,html -o enum/http_gobuster.txt

# SMB (if 139/445)
nmap -p139,445 --script smb-enum-shares,smb-os-discovery -sV $TARGET -oN enum/smb_nse.txt
smbclient -L //$TARGET/ -N | tee enum/smb_shares.txt

# NFS (if 111/2049)
showmount -e $TARGET | tee enum/nfs_exports.txt

# SNMP (if 161/udp)
snmpwalk -v2c -c public $TARGET 1.3.6.1.2.1.1 | tee enum/snmp_sysdescr.txt

# DNS (if 53)
dig @${TARGET} version.bind CHAOS TXT +short | tee enum/dns_bindver.txt
```

## Summary
- Start with quick discovery and fast scans to identify live services without wasting time.
- Follow up with full-port coverage and targeted enumeration using nmap’s -sC -sV and relevant NSE scripts.
- Enumerate services methodically: web (whatweb/gobuster), SMB/NFS (smbclient/enum4linux-ng/showmount), DNS/SNMP (dig/snmpwalk), and databases via clients.
- Save and parse outputs to drive your attack plan, focusing on misconfigurations and default/anonymous access commonly found in Linux services.
- Always operate ethically and within authorized lab scope.