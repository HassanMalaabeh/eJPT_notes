# What the video covers (Introduction / big picture)

Note: No transcript was provided. The following summary is inferred conservatively from the filename “04 - Clearing Your Tracks On Linux.mp4” within the “01-ClearingYourTracks” module and typical eJPT coverage. To avoid facilitating misuse, this write-up focuses on ethics, artifacts, defensive controls, and detection. It intentionally avoids step-by-step anti-forensics or log-deletion commands.

Big picture:
- Understanding where Linux records your activity: interactive shell history, system and auth logs, session databases, and auditing.
- Ethical and legal constraints: “clearing tracks” is only discussed in the context of sanctioned testing and lab practice; do not alter client logs unless explicitly authorized.
- Blue-team perspective: how to harden logs against tampering and detect attempts to hide activity.
- Practical lab hygiene: snapshot-then-test, document actions, and coordinate with the client on retention and cleanup procedures after an engagement.

Core artifacts (conceptual overview):
- Shell history: per-user history files and variables (e.g., Bash HISTFILE/HISTSIZE).
- System logs: journald and/or classic syslog stack (rsyslog/syslog-ng), typical locations under /var/log/.
- Auth/session logs: auth.log or secure (distro-dependent), SSH service logs, and rotated archives.
- Session databases: utmp/wtmp/btmp, last, lastlog.
- Auditing: auditd rules and audit logs if enabled.

# Flow (ordered)

1. Ethics and ROE
   - Confirm written authorization. Establish whether touching logs is permitted. Default: do not alter client telemetry.
2. Identify the logging stack
   - Determine if the host uses systemd-journald, rsyslog/syslog-ng, and what services are logging (e.g., sshd).
3. Enumerate key artifacts
   - Shell history, /var/log/*, journald units, SSH auth entries, session databases (last/lastlog), auditd if present.
4. Review activity chronologically
   - Cross-view journald, auth logs, last/lastb, and rotated archives.
5. Detect tampering or gaps
   - Verify journal integrity, check file attributes/sizes/times, search for truncation or sudden rotations.
6. Defensive controls (blue team)
   - Append-only attributes, centralized logging, audit watches on log files/dirs, integrity monitoring.
7. Lab-only practice
   - Use VMs/containers with snapshots. Never practice anti-forensics on production or client assets without explicit approval.
8. Reporting and cleanup
   - Provide IOC locations and recommended detections; coordinate post-engagement cleanup per client policy (accounts, keys, tooling), not log destruction.

# Tools highlighted

- Logging and review
  - journalctl (systemd-journald)
  - rsyslog/syslog-ng (classic syslog pipelines)
  - tail, grep, zgrep, less
- Auth/session artifacts
  - last, lastlog, who, w
- Auditing and integrity
  - auditctl, ausearch (auditd)
  - lsattr, chattr (file attributes; append-only as a defensive measure)
- File system inspection
  - stat, find, du, ls

# Typical command walkthrough (detailed, copy-paste friendly)

These commands are oriented to reconnaissance, validation, and defense/detection. They do not perform anti-forensics or log deletion.

Identify OS and logging stack:
```
cat /etc/os-release
systemctl is-active systemd-journald
ps aux | egrep -i 'rsyslogd|syslog-ng' | grep -v egrep || true
```

List and size log files:
```
sudo du -h --max-depth=1 /var/log | sort -h
sudo find /var/log -type f -printf '%TY-%Tm-%Td %TT %10s %p\n' | sort
```

Review recent SSH activity (Debian/Ubuntu vs. RHEL/CentOS paths vary):
```
# Journald (works on most systemd hosts)
sudo journalctl -u ssh -S -48h --no-pager || sudo journalctl -u sshd -S -48h --no-pager

# Classic logs (Debian/Ubuntu)
sudo grep -iE 'sshd.*(Accepted|Failed|session (opened|closed))' /var/log/auth.log 2>/dev/null | tail -n 100
sudo zgrep -iE 'sshd.*(Accepted|Failed|session (opened|closed))' /var/log/auth.log.* 2>/dev/null | tail -n 100

# Classic logs (RHEL/CentOS)
sudo grep -iE 'sshd.*(Accepted|Failed|session (opened|closed))' /var/log/secure 2>/dev/null | tail -n 100
sudo zgrep -iE 'sshd.*(Accepted|Failed|session (opened|closed))' /var/log/secure.* 2>/dev/null | tail -n 100
```

Enumerate logins/sessions:
```
last -Fai | head -n 25
lastb -Fai 2>/dev/null | head -n 25   # failed logins, if available
lastlog | head -n 25
who -a
```

Check shell history metadata (observation only):
```
echo "User: $USER"
echo "HISTFILE=${HISTFILE:-~/.bash_history}"
echo "HISTSIZE=${HISTSIZE:-unset} HISTFILESIZE=${HISTFILESIZE:-unset}"
ls -al ~ | grep -E '\.bash_history$'
stat -c '%n %s bytes, mtime=%y' ~/.bash_history 2>/dev/null || true
```

Verify journal integrity and look for anomalies:
```
sudo journalctl --verify
sudo journalctl -S -24h -o short-iso --no-pager | head -n 20
sudo journalctl -S -24h -o short-iso --no-pager | tail -n 20
```

Inspect log file attributes (defensive posture):
```
sudo lsattr /var/log/* 2>/dev/null | head -n 50
# Example: set append-only on a critical log (defensive control on your own/administered systems)
# sudo chattr +a /var/log/auth.log
```

Watch for tampering via auditd (if enabled; defensive):
```
# List current audit watches
sudo auditctl -l 2>/dev/null || true

# Add a watch for writes/attribute changes to auth logs (adjust path to distro)
# Debian/Ubuntu-style
sudo auditctl -w /var/log/auth.log -p wa -k logtamper 2>/dev/null || true
# RHEL/CentOS-style
sudo auditctl -w /var/log/secure -p wa -k logtamper 2>/dev/null || true

# Query audit events for tampering attempts
sudo ausearch -k logtamper --start today 2>/dev/null | aureport -f -i 2>/dev/null || sudo ausearch -k logtamper --start today 2>/dev/null
```

Surface sudden truncation or rotation:
```
# Show first and last timestamps in key logs (Debian/Ubuntu path)
sudo awk 'NR==1{print "FIRST:",$0} END{print "LAST:",$0}' /var/log/auth.log 2>/dev/null || true
# List rotated archives chronologically
ls -alh /var/log/auth.log* 2>/dev/null || ls -alh /var/log/secure* 2>/dev/null
```

# Practical tips

- Ethics first: In real engagements, altering or deleting client logs is typically out of scope. Get explicit written authorization for any actions that affect telemetry.
- Prefer minimal footprint over “cleanup”: Use tightly scoped test windows, designated test accounts, and dedicated source IPs to keep evidence clean and attributable.
- Snapshot before you lab: Practice artifact handling only on disposable VMs/containers with snapshots so you can safely revert.
- Defense-in-depth for logs:
  - Centralize logs off-host (SIEM/ELK) to make tampering harder.
  - Consider append-only attributes on critical logs and protect journald directories.
  - Add audit watches on /var/log and journald paths to alert on modification, rename, or chmod/chattr changes.
  - Use integrity monitoring (AIDE/Tripwire) on log directories and key configs.
- Detect tampering:
  - Look for gaps in time, abrupt size drops, missing rotations, or mismatched first/last event times.
  - Correlate across multiple sources (journald vs. file logs vs. SIEM vs. network telemetry).
- Report clearly: Document observed artifacts, detected anomalies, and provide concrete defensive recommendations.

# Minimal cheat sheet (one-screen flow)

- Confirm ROE: do not alter client logs unless explicitly authorized.
- Identify stack:
  - systemctl is-active systemd-journald
  - ps aux | egrep -i 'rsyslogd|syslog-ng'
- Quick auth/session review:
  - last -Fai | head
  - lastlog | head
  - journalctl -u ssh -S -24h --no-pager
  - grep -iE 'sshd.*(Accepted|Failed|session (opened|closed))' /var/log/auth.log 2>/dev/null | tail
- Rotations and sizes:
  - ls -alh /var/log/auth.log* 2>/dev/null || ls -alh /var/log/secure* 2>/dev/null
  - du -h --max-depth=1 /var/log | sort -h
- Journal integrity:
  - journalctl --verify
- Attributes and auditing (defense):
  - lsattr /var/log/* 2>/dev/null | head
  - auditctl -l 2>/dev/null
  - ausearch -k logtamper --start today 2>/dev/null

# Summary

This Linux-focused “Clearing Your Tracks” segment (inferred from title) explains where activity is recorded on Linux systems and frames the topic ethically: in real engagements you should not modify or delete client logs without explicit authorization. The notes emphasize:
- Key artifacts: shell history, journald/syslog logs, SSH/auth entries, wtmp/btmp/lastlog, and auditd.
- A safe workflow to enumerate and correlate logs, verify integrity, and detect signs of tampering.
- Defensive measures such as append-only attributes, centralized logging, audit watches, and integrity monitoring.
The provided commands are copy-paste friendly for reviewing and defending Linux logs in a lab or blue-team context; step-by-step anti-forensics is intentionally omitted.