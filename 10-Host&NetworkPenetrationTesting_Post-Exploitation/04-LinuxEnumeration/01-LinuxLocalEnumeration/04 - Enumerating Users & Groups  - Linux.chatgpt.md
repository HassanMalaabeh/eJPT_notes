# What the video covers (Introduction / big picture)
Note: No transcript was provided. The following summary is inferred conservatively from the filename and the “01-LinuxLocalEnumeration” folder context.

This video focuses on Linux local enumeration of users and groups after gaining a foothold on a system. The goal is to:
- Identify your current user context and privileges
- Enumerate all users, classify human vs system accounts, and spot suspicious UID 0 accounts
- Enumerate groups and find privileged groups (sudo/wheel, docker/lxd, adm, etc.)
- Check sudo rights and sudoers configurations
- See who is logged in and when users last logged in
- Check environment indicators for LDAP/AD/SSO-integration (getent/NSS)
- Map findings to potential attack/privesc paths

# Flow (ordered)
1) Establish current identity and privileges (whoami, id)
2) Enumerate all users from NSS (getent passwd), not just /etc/passwd
3) Differentiate human vs system accounts (UID ranges, login shells)
4) Hunt for UID 0 duplicates and interactive shells
5) Enumerate groups globally and per user; identify privileged groups
6) Check sudo privileges (sudo -l) and sudoers files
7) See active sessions and historical logins (who, w, last, lastlog)
8) Inspect home directories and SSH dirs for targets
9) Check NSS/SSSD/Winbind for domain-backed accounts
10) Optional: Review SSH access restrictions in sshd_config

# Tools highlighted
- Core commands: whoami, id, groups, logname
- NSS-aware queries: getent passwd, getent group
- File reads: cat /etc/passwd, /etc/group, /etc/login.defs, /etc/ssh/sshd_config
- Text processing: awk, cut, grep, sort, uniq
- Session info: who, w, users, last, lastlog
- Privilege checks: sudo -l
- Optional/if installed: lslogins, realm (for domain info)
- Key files/paths: /etc/passwd, /etc/shadow, /etc/group, /etc/gshadow, /etc/sudoers, /etc/sudoers.d/, /etc/login.defs, /etc/nsswitch.conf, /home, /root

# Typical command walkthrough (detailed, copy-paste friendly)
Establish current context:
```
whoami
id
id -nG
groups
logname 2>/dev/null || echo "logname not available"
```

Understand UID/GID policy and shells:
```
grep -E '^(UID|GID)_(MIN|MAX)\b' /etc/login.defs 2>/dev/null || echo "login.defs not readable"
cat /etc/shells 2>/dev/null
```

Enumerate all users (NSS-aware) and classify:
```
# All users via NSS (includes LDAP/AD if configured)
getent passwd

# Usernames only
getent passwd | cut -d: -f1 | sort -u

# Likely human users (assuming UID_MIN from login.defs, fallback 1000)
UID_MIN=$(awk '/^UID_MIN/{print $2}' /etc/login.defs 2>/dev/null || echo 1000)
getent passwd | awk -F: -v umin="$UID_MIN" '$3>=umin {print $1 ":" $3 ":" $6 ":" $7}'

# Accounts with interactive shells (not nologin/false)
getent passwd | awk -F: '$7 !~ /(nologin|false)$/ {print $1 ":" $7}'

# Accounts with common interactive shells only
getent passwd | awk -F: '$7 ~ /(bash|zsh|ksh|fish|sh)$/ {print $1 ":" $7}'

# UID 0 (root-equivalent) accounts
awk -F: '($3==0){print $1 ":" $7}' /etc/passwd
```

Enumerate groups globally and for specific users:
```
# All groups (NSS-aware)
getent group

# Group names only
getent group | cut -d: -f1 | sort -u

# Current user's detailed groups
id
id -nG

# Members of common privileged groups if present
for g in sudo wheel adm docker lxd libvirt kvm plugdev disk video audio lpadmin sambashare www-data; do
  getent group "$g" 2>/dev/null
done
```

Sudo rights and sudoers (non-destructive):
```
# Non-interactive check first; fall back to prompt
sudo -n -l 2>/dev/null || sudo -l

# Show sudoers files if readable (often 0440, root:root)
ls -l /etc/sudoers /etc/sudoers.d 2>/dev/null
```

Active sessions and login history:
```
who
w
users
last -n 10
lastlog 2>/dev/null | head -n 20
```

Home directories and SSH footprints:
```
ls -la /home 2>/dev/null
ls -ld /home/* 2>/dev/null
stat -c '%A %U:%G %n' /home/* /root 2>/dev/null

# List per-user .ssh directories (for target discovery)
for uhome in $(getent passwd | awk -F: '$7 !~ /(nologin|false)$/ {print $6}'); do
  ls -la "$uhome/.ssh" 2>/dev/null
done
```

Domain/LDAP indicators (NSS/SSSD/Winbind):
```
grep -E '^(passwd|group):' /etc/nsswitch.conf 2>/dev/null
ps aux | grep -E 'sssd|winbind|ldap' | grep -v grep
realm list 2>/dev/null
```

SSH access restrictions (optional, if readable):
```
grep -E '^(Allow|Deny)(Users|Groups)\b' /etc/ssh/sshd_config 2>/dev/null
```

Shadow files (only if readable/root):
```
# Inspect shadow (privileged)
sudo cat /etc/shadow 2>/dev/null | head

# Prepare combined passwd+shadow (for offline analysis)
if command -v unshadow >/dev/null 2>&1; then
  sudo unshadow /etc/passwd /etc/shadow > /tmp/unshadowed.txt 2>/dev/null
fi
```

# Practical tips
- Prefer getent over directly parsing /etc/passwd or /etc/group; getent respects NSS and will include LDAP/AD users when applicable.
- Use /etc/login.defs to get the real UID_MIN/UID_MAX for the distro; don’t hardcode 1000 unless necessary. Some systems start human users at 500 or different values.
- Flag any additional UID 0 accounts immediately; they are root-equivalent and common privesc targets.
- Privileged groups commonly worth noting:
  - sudo or wheel: direct sudo potential
  - docker, lxd: container breakout/privesc vectors
  - adm: read system logs (sensitive info leakage)
  - libvirt, kvm: VM management privileges
  - disk: raw device access (dangerous)
- If sudo -n -l works, it means no password is required to list rules; if rules include NOPASSWD entries, note exact commands and wildcards.
- For domain-joined hosts, rely on getent and realm; local files likely won’t show all users.
- last and lastlog can help prioritize targets by activity; if noisy, filter by user or limit entries.
- Check shells: an account with /usr/sbin/nologin or /bin/false is typically non-interactive; target those with real shells first.
- Always capture home paths from passwd entries; not all human users live under /home.

# Minimal cheat sheet (one-screen flow)
```
whoami; id; id -nG
UID_MIN=$(awk '/^UID_MIN/{print $2}' /etc/login.defs 2>/dev/null || echo 1000)
getent passwd | awk -F: -v umin="$UID_MIN" '$3>=umin {print $1 ":" $3 ":" $6 ":" $7}'
getent passwd | awk -F: '$7 !~ /(nologin|false)$/ {print $1 ":" $7}'
awk -F: '($3==0){print $1 ":" $7}' /etc/passwd
getent group | cut -d: -f1 | sort -u | head
for g in sudo wheel docker lxd adm libvirt kvm plugdev disk video; do getent group "$g" 2>/dev/null; done
sudo -n -l 2>/dev/null || sudo -l
who; w; last -n 10
ls -ld /home/* 2>/dev/null
for uhome in $(getent passwd | awk -F: '$7 !~ /(nologin|false)$/ {print $6}'); do ls -la "$uhome/.ssh" 2>/dev/null; done
grep -E '^(passwd|group):' /etc/nsswitch.conf 2>/dev/null
ps aux | grep -E 'sssd|winbind|ldap' | grep -v grep
```

# Summary
This module demonstrates Linux user and group enumeration to understand identity, privilege boundaries, and potential attack paths. Start by confirming your user context, then enumerate users (prefer getent), highlight human/interactive accounts, and look for UID 0 anomalies. Enumerate groups globally and per user, prioritizing privileged groups like sudo/wheel and container-related groups. Use sudo -l to enumerate effective sudo rights. Review active and historical logins to identify targets of interest. Check NSS, SSSD, and realm indicators for domain-backed accounts. Inspect home directories and SSH footprints to map viable access points.