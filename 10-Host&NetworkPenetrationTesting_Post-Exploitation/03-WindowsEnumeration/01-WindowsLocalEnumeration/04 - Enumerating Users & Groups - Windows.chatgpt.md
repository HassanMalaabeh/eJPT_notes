# 04 - Enumerating Users & Groups - Windows

Note: No transcript was provided. The following summary and commands are inferred from the filename/context (01-WindowsLocalEnumeration/04 - Enumerating Users & Groups - Windows.mp4) and reflect standard eJPT-relevant Windows local enumeration for users and groups.

## What the video covers (Introduction / big picture)
- Identify who you are on a Windows host and what groups you belong to.
- Enumerate local users, local groups, and key group memberships that imply privilege (e.g., Administrators, RDP).
- Check currently logged-in users/sessions.
- Detect domain membership and, if domain-joined, enumerate domain users/groups using built-in tools.
- Map SIDs to accounts and correlate with profiles.
- Use both CMD and PowerShell for reliable offline/low-priv shells.

## Flow (ordered)
1. Confirm identity, groups, and privileges: whoami, environment/domain context.
2. Enumerate local users and accounts; find disabled/locked/admin-capable users.
3. Enumerate local groups; inspect sensitive groups’ membership.
4. Check who is logged in (local and remote sessions).
5. If domain-joined, enumerate domain users/groups with built-in tools.
6. Map SIDs to users and correlate with C:\Users profiles.
7. Capture quick artifacts and policy info (gpresult, net accounts).
8. Optional: Use Sysinternals for logged-on users visibility.

## Tools highlighted
- Built-in CMD: whoami, net, query user/quser/qwinsta, systeminfo, net config workstation, reg.
- PowerShell: Get-LocalUser/Group/GroupMember, CIM/WMI queries; optional AD cmdlets if present.
- WMI/WMIC: useraccount, group (wmic is deprecated but often available).
- Sysinternals (optional): PsLoggedOn.
- Domain-centric (if present): net user /domain, net group /domain, dsquery/dsget, gpresult.

## Typical command walkthrough (detailed, copy-paste friendly)

### 1) Identity, groups, privileges, and environment (CMD)
```cmd
whoami
whoami /groups
whoami /priv
whoami /all

echo %USERNAME%
echo %USERDOMAIN%
echo %COMPUTERNAME%
echo %USERDNSDOMAIN%
echo %LOGONSERVER%

systeminfo | findstr /B /C:"Domain"
net config workstation
```

### 2) Local users and groups (CMD)
```cmd
:: List local users
net user

:: Inspect a specific local user
net user <username>

:: List all local groups
net localgroup

:: Inspect sensitive local groups
net localgroup Administrators
net localgroup "Remote Desktop Users"
net localgroup "Remote Management Users"
net localgroup "Backup Operators"
net localgroup "Event Log Readers"
net localgroup "Hyper-V Administrators"
```

### 3) Logged-in users/sessions (CMD)
```cmd
query user
quser
qwinsta
```

### 4) Domain checks and enumeration (CMD; only if domain-joined)
```cmd
:: If these return data, you’re likely domain-joined
net user /domain
net group /domain
net group "Domain Admins" /domain
net group "Enterprise Admins" /domain

:: Show groups applied via policy
gpresult /R
```

### 5) Map SIDs to users; correlate with profiles (CMD + WMIC)
```cmd
:: Map local/domain users to SIDs
wmic useraccount get name,domain,sid,disabled

:: Map local groups to SIDs
wmic group get name,sid

:: Profiles present on disk
dir C:\Users

:: Profile SID mapping in registry (requires read access)
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList" /s
```

### 6) PowerShell equivalents and rich queries
```powershell
# Local users
Get-LocalUser | Select-Object Name,Enabled,Description,LastLogon

# Local groups
Get-LocalGroup | Select-Object Name,Description

# Members of sensitive groups
Get-LocalGroupMember -Group 'Administrators'
Get-LocalGroupMember -Group 'Remote Desktop Users'
Get-LocalGroupMember -Group 'Backup Operators'
Get-LocalGroupMember -Group 'Event Log Readers'
Get-LocalGroupMember -Group 'Remote Management Users'
Get-LocalGroupMember -Group 'Hyper-V Administrators'

# Principals with source (Local/AD) if available
Get-LocalGroupMember -Group 'Administrators' | Select-Object Name,ObjectClass,PrincipalSource

# Quick environment/domain hints
[System.Environment]::UserName
[System.Environment]::UserDomainName
(Get-CimInstance Win32_ComputerSystem).PartOfDomain
(Get-CimInstance Win32_ComputerSystem).Domain

# Logged-in interactive users (Terminal Services sessions)
quser  # or use CMD in PS: quser
```

One-liners suitable for constrained shells:
```cmd
powershell -NoP -Ep Bypass -C "Get-LocalUser | ft -a Name,Enabled,LastLogon"
powershell -NoP -Ep Bypass -C "Get-LocalGroup | ft -a Name,Description"
powershell -NoP -Ep Bypass -C "Get-LocalGroupMember -Group 'Administrators' | ft -a Name,ObjectClass,PrincipalSource"
powershell -NoP -Ep Bypass -C "$g='Remote Desktop Users','Backup Operators','Event Log Readers','Remote Management Users';foreach($x in $g){'$x';Get-LocalGroupMember -Group $x | ft -a Name,PrincipalSource}"
```

### 7) Optional: Sysinternals (if available)
```cmd
PsLoggedOn.exe          :: local logons
PsLoggedOn.exe \\host   :: remote host logons
```

## Practical tips
- Start with whoami /all to see groups and privileges (e.g., SeImpersonatePrivilege) that may enable escalation paths.
- Group names can be localized; when in doubt, identify by SID:
  - Administrators: S-1-5-32-544
  - Remote Desktop Users: S-1-5-32-555
- Non-admin users can usually enumerate local users/groups with net and Get-LocalGroupMember.
- If net user /domain fails, you’re likely not domain-joined or cannot reach a DC.
- gpresult /R shows security groups applied to the user/computer via GPO—useful to confirm domain context.
- Look for domain principals inside local Administrators group (e.g., DOMAIN\Domain Admins).
- Correlate C:\Users profiles with wmic useraccount SID mappings to spot dormant or privileged users.
- wmic is deprecated but still common; prefer PowerShell CIM cmdlets when possible.
- For remote shells with limited interactivity, rely on short, no-profile PowerShell one-liners.

## Minimal cheat sheet (one-screen flow)
```cmd
:: Identity, groups, privs
whoami /all

:: Local users + groups
net user
net localgroup
net localgroup Administrators
net localgroup "Remote Desktop Users"

:: Sessions
quser

:: Domain?
systeminfo | findstr /B /C:"Domain"
net user /domain
net group "Domain Admins" /domain

:: PowerShell quick hits
powershell -NoP -Ep Bypass -C "Get-LocalUser | ft -a Name,Enabled,LastLogon"
powershell -NoP -Ep Bypass -C "Get-LocalGroupMember -Group 'Administrators' | ft -a Name,PrincipalSource"
```

## Summary
This module focuses on systematically enumerating Windows users and groups to understand your current access and identify escalation or lateral movement paths. Begin with whoami /all, then enumerate local users/groups and inspect membership of high-value groups (Administrators, Remote Desktop Users, Backup Operators, etc.). Check active sessions, determine domain membership, and, if applicable, enumerate domain users/groups with built-in commands. Use PowerShell for richer queries and map SIDs to accounts for clarity.