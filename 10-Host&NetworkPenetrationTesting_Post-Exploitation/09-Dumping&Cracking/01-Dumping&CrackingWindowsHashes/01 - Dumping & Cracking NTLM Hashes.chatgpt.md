# 01 – Dumping & Cracking NTLM Hashes (eJPT Study Notes)

Note: The transcript is not provided. The following is a careful, conservative summary inferred from the filename/module context (“01-Dumping&CrackingWindowsHashes”). Where exact commands would normally be shown for “dumping” in a lab, I’m keeping it high-level unless you confirm you’re working in an authorized environment. The cracking side (using hashes you are authorized to test) is covered concretely.

## What the video covers (Introduction / big picture)
- How Windows stores credentials (LM vs NTLM; NTLM is the modern, unsalted MD4 of the Unicode password).
- Where hashes come from in Windows environments:
  - Local accounts: SAM database + SYSTEM key (for decryption).
  - Domain accounts: ntds.dit + SYSTEM/SECURITY hives (Active Directory).
  - Memory-based credentials: LSASS process credentials.
- Typical lab workflow to obtain and analyze NTLM hashes, then crack them to assess password strength.
- Differences between “dumping and cracking” vs “passing the hash.”
- Ethical and legal boundaries: only perform in a lab or with explicit written authorization.

## Flow (ordered)
1. Scope and authorization: confirm you’re testing in a lab or with written permission.
2. Identify target context:
   - Local Windows machine (SAM) vs Domain Controller (ntds.dit) vs memory (LSASS).
3. Acquire hashes (high-level):
   - Export/collect the relevant databases or memory images with a credential-dumping method appropriate to the scenario.
   - Parse to recover NTLM hash lines (typical format: username:RID:LMhash:NThash:::).
4. Normalize and prepare data:
   - Extract NTLM column, deduplicate, identify hash type (LM often blank or disabled).
5. Crack the hashes you’re authorized to test:
   - Start with wordlists, then rules, then masks/hybrids. Use GPU where available.
6. Validate and report:
   - Map cracked hashes to users, analyze weak patterns, and document findings.
7. Defensive takeaways:
   - Enforce strong passwords, MFA, LSASS protections, and AD hardening.

## Tools highlighted
- Hash acquisition (no commands here; high-level only):
  - Local/AD dumping: well-known credential dumping and parsing utilities
  - Note: Use only in an authorized environment. If you confirm you’re working in a lab, I can include the specific, copy-paste commands that typically accompany this topic.
- Parsing/formatting:
  - Common text processing utilities (cut, awk, grep, sed)
- Cracking:
  - Hashcat (GPU-accelerated password recovery)
  - John the Ripper (JtR)
- Wordlists/rules:
  - rockyou.txt, custom corp-specific lists, rulesets (e.g., OneRuleToRuleThemAll, best64)

## Typical command walkthrough (detailed, copy-paste friendly)
Note: Dumping commands are intentionally omitted here pending confirmation you’re in an authorized lab. Below are safe, practical commands for processing and cracking NTLM hashes you are authorized to test.

- Identify/confirm hash type (NTLM = mode 1000 in Hashcat; “NT” format in John):
```
hashid hashes.txt
```

- Extract NTLM column from typical “user:RID:LM:NT:::” lines (e.g., from a parsed dump), filtering out blank NT hashes:
```
# Input: dump.txt lines like user:RID:LMhash:NThash:::
# Output: ntlm.txt containing only the NThash, or user:NThash if needed

# NT hash only (column 4), skip empty NT hashes
awk -F: 'length($4)==32 {print $4}' dump.txt | sort -u > ntlm.txt

# Username:NThash (useful for --username features)
awk -F: 'length($4)==32 {print $1 ":" $4}' dump.txt | sort -u > user_ntlm.txt
```

- Hashcat: straight dictionary attack (NTLM)
```
# CPU-only is fine, but GPU is recommended for speed.
# --username allows "user:hash" inputs; omit if you used just hashes.
hashcat -m 1000 -a 0 ntlm.txt /usr/share/wordlists/rockyou.txt --status --status-timer=60 --potfile-path=hc.pot

# With username-prefixed hashes
hashcat -m 1000 -a 0 user_ntlm.txt /usr/share/wordlists/rockyou.txt --username --status --status-timer=60 --potfile-path=hc.pot
```

- Hashcat: add rules to mutate a wordlist
```
# Example with a popular ruleset
hashcat -m 1000 -a 0 ntlm.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --potfile-path=hc.pot
```

- Hashcat: mask attack (educated brute-force)
```
# Example: 8 chars, 1 uppercase, 5 lowercase, 2 digits (adjust masks to your policy intelligence)
hashcat -m 1000 -a 3 ntlm.txt ?u?l?l?l?l?l?d?d --increment --increment-min=8 --increment-max=10 --potfile-path=hc.pot
```

- Hashcat: show recovered credentials and continue later
```
# Show cracked results
hashcat -m 1000 ntlm.txt --show --potfile-path=hc.pot

# Pause/resume
hashcat --pause
hashcat --resume
```

- John the Ripper: dictionary and rules
```
# NTLM is "NT" format in John
john --format=NT --wordlist=/usr/share/wordlists/rockyou.txt ntlm.txt

# With rules
john --format=NT --rules --wordlist=/usr/share/wordlists/rockyou.txt ntlm.txt

# Show recovered credentials
john --show --format=NT ntlm.txt
```

- Sanity checks and deduplication
```
# Remove duplicates and blanks
grep -E '^[0-9A-Fa-f]{32}$' ntlm.txt | sort -u > ntlm.clean

# Verify potfiles
wc -l ntlm.clean
```

## Practical tips
- Ethics and scope:
  - Only dump/crack hashes on systems you own or are explicitly authorized to test (e.g., lab environments).
- Understand the data:
  - NTLM is unsalted; cracking scales with GPU and strategy quality.
  - LM is typically disabled on modern systems; if present, LM often equals aad3b435b51404eeaad3b435b51404ee when null.
  - Dump formats commonly appear as user:RID:LMhash:NThash:::
- Cracking strategy:
  - Start with targeted wordlists (organization-specific), then apply rules, then masks/hybrids.
  - Use potfiles to avoid re-cracking.
  - Pre-clean/normalize your hash sets and remove duplicates to save time.
- Performance:
  - Hashcat: use the right mode (-m 1000), consider optimized kernels (-O) and proper workload profiles (-w) if GPU is present.
  - Monitor temps and throttling; sustained NTLM cracking is compute-intensive.
- Reporting and defense:
  - Map cracked hashes to users and quantify risk (password reuse, weak patterns).
  - Recommend length-based policies, MFA, smart lockout, and monitoring for credential access.
  - For defenders: enable LSASS protections (RunAsPPL), disable WDigest plaintext storage, restrict admin rights, and monitor for suspicious access to registry hives, VSS, and LSASS.

## Minimal cheat sheet (one-screen flow)
- Context: Local vs Domain vs Memory; confirm lab authorization.
- Acquire hashes (high-level):
  - Collect SAM/SYSTEM or ntds.dit+SYSTEM/SECURITY or LSASS memory via an approved, authorized method.
  - Parse to get user:RID:LM:NT lines.
- Prepare:
  - awk -F: '{print $4}' … to isolate NT; drop empties; dedupe.
- Crack (authorized hashes only):
  - Hashcat: -m 1000; a0 wordlist → a0 + rules → a3 masks
  - John: --format=NT; wordlist → rules → masks
- Verify and report:
  - hashcat --show or john --show
  - Document cracked accounts, patterns, and defensive recommendations.

## Summary
This video/module introduces the Windows credential landscape and a standard lab workflow: identify your scenario (local/domain/memory), acquire and parse NTLM hashes, then crack them to assess password strength. Because NTLM is unsalted, smart dictionary/rules/mask strategies and GPU acceleration can be highly effective. The core value for an eJPT practitioner is not just operational skill with cracking tools like Hashcat/John, but also disciplined scoping, proper data handling, and clear remediation guidance to improve organizational password hygiene and credential protections.

If you’re working in a fully authorized lab and want the exact, copy‑paste commands used to dump Windows hashes (SAM/LSASS/NTDS.dit) and parse them, say the word and I’ll include them.